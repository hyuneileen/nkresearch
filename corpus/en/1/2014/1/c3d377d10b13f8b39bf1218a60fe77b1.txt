Journal of Kim Il Sung University (Natural Science) Vol. 3 No. 1 Juche103(2014) Systematic Design Method of Disturbance Observer based on Pseudo Loop Factorization Yun Jong Nam Abstract This paper presents a design method for Q-filter based on H∞ norm optimization. First, the cost function for optimization is defined by considering performance and structive restrictions such as relative order and internal model order of the Q-filter. Then, it is transformed to a pseudo loop shaping problem, and then being facterized so as to overcome the structive restrictions so ∞H   that the original design problem can be solved according to the solving algorithm of standard control problem.  Key words high-performance robust motion control, disturbance observer, standard ∞H control problem, low-pass filter, freedom control system.  Introduction  The great leader Comrade Kim Il Sung said as follows. “Developing the electronics and automation industries is an important task in modernizing the national economy.”(“KIM IL SUNG WORKS” Vol. 35 P. 311) The disturbance observer (DOB) has widely been applied to high performance robust motion control because of its high disturbance rejection ability and simple structure[1, 2]. Since the system's performances highly depends on the Q-filter in the DOB, design of the filter has been essential in controller design and analysis, which has attracted much more effort in academic society.[3－8] Especially, it was recognized that the higher order's Q-filter can provide the better performances of rejecting disturbance and noise, thus, Butterworth, Chebyshev or binomial coefficient typed high order low-pass filters(LPFs) have been commonly used [5]. However, such typical LPFs were originally developed with the purpose of effective signal reproduction, whereas the mission of Q-filter in DOB is to reject disturbance and sensor noise, keeping robustness against parameter variations. Thus they are not suitable to obtain optimal performances in control system. On the other hands, it was shown that H∞ norms of sensitivity functions of disturbance compensation system can sufficiently reflect the performance of attenuating disturbance and noise as well as the robust stability against model perturbations[6－8]. To systematically design a Q-filter that optimizes its norm cost function is, however, difficult due to structural restrictions such as relative order condition. Thus, most of the design algorithms with H∞ norm cost functions employed numerical computation methods such as linear matrix inequality [7, 8]. In this paper, we present a analytic design method for DOB based on H∞ norm optimization. － 15 － Journal of Kim Il Sung University (Natural Science) No. 1 Juche103(2014) 1. Design Problem of DOB DOB based control system of 2-DOF structure is depicted in Fig. 1 and the equivalent form in Fig. 2, where u, d, y, dˆ , ξ are command input, external disturbance, output, disturbance estimate, and sensor noise, respectively.  represent the plant to be controlled and a nominal plant model respectively. and )(sQ is low-pass filter. )(sPn )(sP Fig. 1. DOB based control system Fig. 2. Equivalent form of the control system There exist two types of disturbance, external disturbance acting on the plant and internal disturbance due to modeling error in the control system of Fig. 1, which disturbances are considered as equivalent disturbance. DOB estimates the equivalent disturbance, and feeds back it as a cancellation signal, as shown in Fig. 1. A low-pass filter is introduced to avoid realization of non-proper inverse plant model and filter the sensor noise. Hence, the design of DOB is reduced to the design of the low-pass filter )(sQ . The behavior of the DOB loop in Fig. 1 can be analyzed by looking at the transfer functions from u, d and ξ to the output y. y = + u PP n ( P QPP − n n sGusG )( ξ − )( − ) y ξ yu PQ QPP − n )( dsG ) yd + ( − P n = ξ − PP n ( + 1( Q − QPP − n ) ) P n d = (1) Assume that the nominal model of the plant is correct (i.e., − )( sQusPy )( ξ − = sP )( n= )) ). Then (1) is simplified as sP )(          (2) n − 1)( Note that sQ )( −= 1)( )(sQ should go to zero in order to reject noise ξ as much as possible, whereas )(sQ should  should also be small in order to attenuate disturbance d, implying that sQC be 1. These two conditions are conflicting. In control applications, disturbances normally happen )(sQ  at low frequencies, whereas sensor noise takes effects at high frequencies. This suggests that should be a low-pass filter, and can be designed by frequency weighted minimization. ( dsQ ( sP n Remainder of the paper discuses an analytic design method of DOB satisfying the design conditions and restrictions. 2. Criteria Function for Designing DOB In order to define criteria function for optimal design of DOB, it should be resolved how reflecting the restrictions such as robust stability and relative order condition and the optimality such as sensitivity performances which is related with disturbance and noise attenuation. － 16 － Systematic Design Method of Disturbance Observer based on Pseudo Loop Factorization 2.1. Robust stability From (2), it follows that in order to guarantee the closed-loop stability in the condition of )(sQ should be stable, that is nominal stability The system also should hold the n= sP )( , sP )( stability in the condition of plant model variation, i.e., robust stability. Suppose that the model uncertainty can be treated as following multiplicative perturbation sP )( = IsP ( )( n Δ+ ( s )) (3) where )(sΔ is model variation and assumed to be stable. Disturbance observer loop is robustly stable by small gain theorem if )(sQ satisfies jQj ) )) ( ωωσ (( Δ < 1 , ≤ ω0 ∞≤ . But detailed )(sΔ is unknown, thus using a stable upper function )(sWT , above robust stability condition is transformed as This is one of restrictions in the design of the low-pass filter )(sQ . sQsWT )( )( < 1 ∞ .              (4) 2.2. Order and relative order conditions Disturbance observer consists of the inverse nominal plant model difficult to realize since it is non-proper. From Fig. 2, it is clear that order larger than or equal to the relative order of the nominal model − )(1 sPn that is normally )(sQ should have a relative  in order to enable )(sPn practical implementation of the DOB, and this is also a critical structural restriction to the filter's design process. 2.3. Internal model order condition In order to attenuate perfectly a certain disturbance, the controller K pre )(s have the corresponding form. If the disturbance rejected for example, from the internal model principle [9], it follows that the controller td )( tp q L = + + + p p 1 − t 0 q q 1 − q or )(sQ should , to be perfectly K pre )(s /1 +qs 1 . Thus, q is an important design requirement of the should include q+1 integrating actions low-pass filter )(sQ . 2.4. Sensitivity analysis From Fig. 2, the sensitivity function of the DOB inner loop are easily derived [10] S DOB )(s and complementary sensitivity function TDOB )(s This results in sQs )( )( = The sensitivity and complementary sensitivity functions TDOB DOB = C S DOB = Q − P 1( ) − n ( ) PPQP + n n and S sQs )( )( , DOB T (5) = PQ ( PPQP n n ) + − for nominal condition )(s and )(s Sclo Tclo n= )( sP sP )( of the whole . closed-loop system in Fig. 2 is [7]. S clo = Q C CP + n 1 = S + DOB CP n 1 , T clo = QCP + n CP 1 + n = TCP n 1 + + CP n DOB (6) － 17 － Journal of Kim Il Sung University (Natural Science) No. 1 Juche103(2014) From (5) and (6), it is shown that in order to achieve disturbance suppression, robustness against  as much as model uncertainties, and noise rejection, it is desirable to reduce )(sQ and )(sQC possible. But since sum of them is 1, it is impossible to reduce them simultaneously over all )(sQ close to 1. frequencies. Therefore, it is desirable to keep the low frequency response of Similarly, for sensor noise rejection, the magnitude of the high frequency response of )(sQ should be selected to be small as possible. It concludes that  should be minimal in low frequencies (control band), whereas )(sQ should be minimal in high frequencies (model uncertainty band and )(sQC noise band). where ∞ ( On the basis of above mentioned design restrictions and performances, we can now define the cost function of DOB by the H∞ norm as γmax , min sQ )( Ω∈ k RH sQ )( ∞∈ ⋅ sW C ( 1)( −⋅ sQsW )( )( ⋅ Q γ ⎡ ⎢ ⎣ sQ )( ) ⎤ ⎥ ⎦ (7) < 1 =Ω k { |)( sFsF )( = /)( sDsN ( ), deg )( sD − deg )( sN ( ) ) ≥ }k (8) is the set of transfer functions that satisfies the relative order condition k. Weighting function )(sWC reflects the frequency band of disturbance to be rejected and its inverse represents the desired  reflects frequency band of sensor noise sensitivity at low frequencies. In the same way, )(sWQ and the upper bound of model uncertainties, and its inverse represents the desired complementary )(sQ is determined by k as well as the order of sensitivity at high frequencies. The order of )(sWC )(sWQ and . (7) is a weighted mixed sensitivity problem in which the trade off between two conflicting  is resolved by minimizing each in respective frequency domain minimizations of indicated by )(sWC )(sQ and  and 1 )(sWQ )( sQ− . By maximizing γfrom theorem of the cost function, the optimal )(sQ can be obtained, which is robust to model uncertainty and has the best performance of disturbance and noise rejection. However, this H∞ norm optimization problem is difficult to solve analitically due to restrictions such as relative order. In the next section, a method for solving problem (7) in the framework of standard H∞ control problem is discussed. 3. Q-Filter Optimization Standard H∞ control method provides generalized design tools for a variety of control problems in which the design requirements are described by H∞ norm constraint, and for the standard problem the systematic solving algorithms such as DGKF method were developed [11]. However, problem (7) can not be solved by the standard solving algorithm due to extra restrictions that are unacceptable in the framework of the standard scheme. This section presents a method of transforming the problem (7) to standard problem without restrictions on structure and orders. 3.1. Transforming into standard H∞ problem Define a scalar pseudo loop function ~ )( sL ~ sL relatied with ( ) 1 − 1)( sQ )( sQ − :)( = )(sQ as            (9) － 18 － Systematic Design Method of Disturbance Observer based on Pseudo Loop Factorization ~ sL )( Then the sensitivity and complementary sensitivity functions of the control system are        (10) ~ sL )( 1)( ~ sL )( ~ sL sQ )( sQ )( −= = + − ) 1 , sQC ( 1 += ( 1)( − ) 1 can be regarded as the open loop transfer function of a pseudo loop system (it, in fact, is equivalent to the open loop transfer function of the inner loop in Fig. 2 under the model match )(sQ  condition). It is clear that if and only if its stable closed-loop transfer function Ω∈)( ~ sL k satisfies sQ Ω∈)( k i.e., the relative order of is the same as )(sQ . ~ sL )( Considering (9), the problem (7) can be written as γmax , min ~ L Ω∈ ~ L Π∈ k sW C ( 1)( +⋅ ~ sLsW )( ⋅ ~ sL )( ( 1)( + Q 1 − ) ~ sL )( ⋅ ⎡ γ ⎢ ⎢ ⎣ ⎤ ⎥ ⎥ ⎦ 1 − ) ( ) ∞ (11) < 1 where Π is the set of open loop transfer functions that make the corresponding closed-loop transfer )(sQ  function stable. From (11), the optimal open loop transfer function is computed by (10). However, the problem still contains the restriction is solved and then ~* sL )( . Ω∈)( ~ sL k To overcome this restriction, facterize into pseudo plant and pseudo controller ~ sL )( ~ sP )( ~ sK )( as follows: ~ sL )( ~ )( sKsP )( ⋅ satisfies the following conditions: = ~ ~ sP )( (12) is bounded on the open half-left plane (dose not have any unstable poles); dose not have any zeros except infinite zeros; Assumption Pseudo plant a) b) ~ sP )( ~ sP )( ~ sP )( ~ sP c) satisfies We can simply select Ω∈)( ~ sP )( Note that the pseudo plant k . relative order of restriction on )(sPn is ~ sL )( ) β s /( = α + ~ is independent of real plant )( sP . The way to factorize ~ sL )( ~ sL )( Π∩Ω∈ k . k for arbitrary real number 0>α and 0>β . )(sP and only preserves the is also independent of )(sP and the only ~ sK )( ⋅ 1 − ~ : γ )( ⎡ ⎢ ⎢ ⎣ min ~ K Π∈ γmax , ~ ) sKsP )( )( ~ ( sKsP )( 1)( )( Substitute (12) into (11), then we have following optimization problem with respect to ( sW 1)( +⋅ C ~ ~ sKsPsW )( ⋅ Q ~ sP )( ∞ of H∞ norm optimization problem (13) satisfies the  be the optimal solution of (13). The optimal loop function Theorem Assume that the plant ~ * sK )( is independent of the selection of Assumption Let ~ ~ * sL sKsP )( )( ⋅ Proof: Let PΣ be a set of pseudo plants that satisfy Assumption. Assume that pseudo plant with which the corresponding optimal pseudo controller problem (13) minimal. Then makes the norm in  and from loop shaping theory, and uniquely determined. (13) has k stable poles ~ * sK )( ~ sP )( Σ∈)( is a ~ sP ~ sP )( ⎤ ⎥ ⎥ ⎦ )( = ~ ) < + ~ 1 − 1 P * k ), (* ipi ,1 L= it is clear that the optimal solution of the problem (13) includes k zeros equal to these ~* sK )( poles as － 19 － Journal of Kim Il Sung University (Natural Science) No. 1 Juche103(2014) ~ * sK )( = ~ sK )( 0 ⋅ ( s + . * ip ) k ∏ i 1 = Since ~ * sL )( = * ~ )( ~ sKsP )( ⋅ ~ sP 1 = ~ sK )( 0 , ~ 0 sK )( is optimal open loop function. ~ p ≠ , and k ), (~ ipi L= ,1 Consider any another Σ∈)( P whose poles are * p (entirely or partially different). Then, from (13), it is clear that controller  )~ ip ~ * sK )( 1 ~ sK )( 0 = + s ( ⋅ k ∏ i 1 = ~ 1 sP )( can minimize the norm of problem (13) for and internal stability is always satisfied since ~ 0 sK )( is also a optimal unstable zero-pole cancelling between controller and plant never appear. open loop function for have any affect on minimizing the norm of the problem (13), resulting in . This means that selection of satisfying Assumption does not . (Proof end) ~ * sL )( = ~ sK )( 0 Factorization of according to (12) and Assumption ensures that the optimal solution ~* sL )( of the problem (13) satisfies the condition Π∩Ω∈ k be an optimal solution of order n and relative order k for any . Lemma 1 Let ~ sP Σ∈)( P for (13). Then transfer function ~ * sL )( = ~ sKsP )( ⋅ )( ~ * of order n and relative order k ~* )( sL ~ 1 sP )( ~ sL )( ~ sK )( ~ sP )( is the optimal loop function that gives smallest norm value of (11) among other transfer functions of the same order construction. Σ∈)( , two H∞ norm optimization problems (11) and (13) are perfectly Lemma 2 For any ~ sP P equivalent i.e. min L Ω∈ L Π∈ k min K Π∈ ~ ( sL ⋅ sW C 1()( +⋅ ~ ( )( sLsW ⋅ 1)( + Q 1 − )) ~ ( sL ⎡ γ ⎢ ⎢ ⎣ ⎤ ⎥ ⎥ ⎦ 1 − )) ∞ ⎡ ⎢ ⎢ ⎣ ⋅ γ 1()( sW C ~ ( sKsPsW ⋅ +⋅ ~ )( )( Q 1 − ~ ~ )( ( sKsP ~ ( )( sKsP 1)( )) ~ + 1 − )) ⎤ ⎥ ⎥ ⎦ ∞ < ,1 max γ (14) < ,1 max γ and ~ * sL )( = ~ ~ sKsP )( )( * (15) where ~* sL )( and ~ * sK )( are the optimal solutions of problem (11) and (13), respectively. The proofs of the Lemma 1 and Lemma 2 are similar to that of Theorem. Equation (13) is a weighted mixed sensitivity problem without relative order restriction and can be solved by solving framework of standard H∞ control problem. Above theorem and Lemmas show that the H∞ norm optimization problem with relative order restriction can be transformed to standard H∞ control problem (13) without order restriction by pseudo loop shaping problem, so that it can be analytically solved. The order of does not exceed the one of the augmented plant of standard problem that consists of weighting functions )(sWC the same as that of ~* satisfies sL Ω∈)( k ~ * sK )( because ~ * sK )( and )(sWQ ~ )( sP is proper, thus since all the poles of and pseudo plant is cancelled by some zeros of Ω∈)(* sQ . k ~ )( sP . The order of ~ * sK )( is ~* sL )( ~* sL . )( ~ * sK )( － 20 － Systematic Design Method of Disturbance Observer based on Pseudo Loop Factorization 3.2. Design procedure of optimal Q-filter of DOB From above discussions, Q-filter can be designed in the following procedures: Step 1 Determine the weighting functions that reflect the design specifications such as frequency response demands and internal model order etc. (as seen later) )(sWC )(sWQ and Step 2 Select an arbitrary Step 3 According to the solving framework of standard H∞ control problem, solve the optimal that reflects relative order condition k of Q-filter. Σ∈)( P ~ sP solution ~ * sK )( of the norm optimization problem (13). ~* sL )( . )(* sQ )(* sQ and ~ * sK )( and then compute the optimal Q-filter Step 4 According to (15), obtain DGKF method [11] based on two Ricatti equation solutions was used to solve the standard problem of Step 3. Note that  have the same order which depends on augmented plant's order i.e., order sum of weighting functions and pseudo plant. More exactly, as suboptimal solution approaches optimal that by γ-maximization, at least one of state modes of the controller is vanished. As a result, the order of optimal solution is at least 1 order lower than the augmented plant [12].  4. Design Examples Consider a Q-filter of order 3 and relative order 2 the form of which is most frequently employed , in practical servo control systems. The order specifications of the filter design are k which is the highest possible order. . Let 1=m 3=n −= 1= , . Similarly, define weighting function )(sWC simply such that its frequency response is tangent of such that its frequency response is tangent )(sQC )(sWQ ∞→s . Therefore, we can simply take weighting functions as at of 0→s )(sQ at 2= mn Define weighting function = mq ⋅= γ sW )( sWQ )( C is used to specify filter's cut-off frequency. Select a pseudo plant (16) sW )( C , α/ γ /( + = = s 2) λ 2s 0001 and .0=λ where =α satisfying Assumption for given relative order as /(1)( = ~ sP 667 δ+ 2) s (17) where 3=δ was arbitrarily selected by Theorem and Lemma 1. The augmented plant of standard problem (13) and its state space representation are as sG )( γ = (18) ⎡ γ ⎢ ⎢ ⎢ ⎣ ⋅ sW )( C 0 I ⎡ ⎢ ⎢ ⎢ γ ⎢ ⎢ ⎢ ⎣ A C 0 C C ⋅ 0 0 ~ sPsW )( )( ~ γ ⋅− C )( sPsW )( ~ sP )( Q − − CB PC A P 0 C Q C P B C 0 0 0 I ⎤ ⎥ ⎥ ⎥ ⎦ 0 B P 0 D Q 0 ⎤ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎦ A C 1 C 2 ⎡ ⎢ ⎢ ⎢ ⎣ B 1 D 11 D 21 B 2 D 12 D 22 ⎤ ⎥ ⎥ ⎥ ⎦ = (19) where [AC, BC, CC, 0] and [AP, BP, CP, 0] are the state space representations of ~ respectively, and [AP, BP, CQ, DQ] is the state space representations of WQ(s) sP )( )(sWC and ~ sP )( . From (16) and － 21 － Journal of Kim Il Sung University (Natural Science) No. 1 Juche103(2014) (17), it is clear that the augmented plant's order is 4, and therefore the optimal controller's order  maxγγ → . We can use the function hinfopt of MATLAB Robust Control Toolbox to solve is 3 as , resultant this problem and realize optimization through γ -maximization. At  and final optimal Q-filter are obtained as solution max ≈γ 203. 150 ~* sKλ )( ~ * )( sK λ = ~ K * λ 0, ⋅ 1 2 s = (7.666 + .8 444 )( s + )3 2 s 2 s ( s + )48.37 (20) * )( sQ = ~ * )( sL ~ * )( sL + 1 ~ ~ * sPsK )( )( λ ~ ~ * sPsK )( )( λ + = 1 = 3 s s + 5632 7.666 2 + 48.37 s + 7.666 s + 5 632 (21) It is clear that the result satisfies the given order and relative order demands. The frequency  are shown in Fig. 3 and 4 which , and magnitude responses of , , − − )(* sQ )(1 sWC )(1 sWQ )(* sQC show that the all norm restriction demands in (7) are satisfied. sQb )( = (3 s σ 1) + 2 3 s ( σ ) + (3 s σ ) + (3 s σ 1) + (22) Fig. 3. Frequency magnitude responses of )(* sQ (1), )(1 sWQ − (2) and )(sQb (3) Fig. 4. Frequency magnitude responses of * sQ− )( (1), (2), (3) 1 1 )(1 sWC − sQb− )( In order to compare with previous traditional DOB's Q-filter, consider a binomial coefficient model filter [5, 10]. Select the time constant σ to be )(* sQ so that its roll-off frequency response coincides , meaning that two noise rejection performances are equal. The high frequency responses  are shown in Fig. (3). Through simple computations, we can know and .0=σ 065 )(sQb |) | < jQ ( b ω |) , ≥ Hωω 70= rad/s. This shows that noise rejection performance of )(* sQ with of )(* sQ 1 − jW ( Q ω | is better than )(sQb at this frequency band. Under this condition, we can verify 1 − * jQ ( ) ω 1 b−< jQ ( ) ω at < Lωω 10= rad/s as shown in Fig. 4 and the magnitude error at sufficiently low frequency is approximately 6 dB, showing that attenuation performance stronger 2.2 times than disturbances at has the low frequency disturbances  and  in design of in disturbance suppression performance get lager as the order . If we focus on noises at Hωω≥ )(* sQ )(sQb Lωω< － 22 － Systematic Design Method of Disturbance Observer based on Pseudo Loop Factorization of the observer get higher. For example, in Q-filter, )(* sQ is better than )(sQb and many practical cases are similar to this case. These differences the case of order 5 and relative order 1( i.e., n  reaches 22.3 dB, meaning = 5, m = 4), the magnitude difference between and * sQ− )( sQb− )( 1 1 that former's disturbance attenuation performance at low frequencies is higher 13 times than latter's. Conclusion  In this paper, a systematic and straightforward design method of disturbance observer based on H∞ norm optimization has been presented. The pseudo factorization of loop transfer function of DOB system makes it possible for the Q-filter design problem with structural restrictions to be transformed into standard H∞ control problem without any restriction. The numerical example showed effectiveness and validity of the proposed method and that various design specifications can be implemented by suitable selection of weighting functions under the condition of keeping the order structure.  References [1] W. S. Huang et al.; IEEE Trans. Ind. Electron., 57, 1, 420, 2010. [2] H. Tanaka et al.; In Proc. IEEE 10th Int. Workshop Adv. Motion Control, 3, 601, 2008. [3] K. Natori et al.; IEEE Trans. Ind. Electron., 57, 3, 1050, 2010. [4] N. Iiyama et al.; In Proc. IEEE 10th Int. Workshop Adv. Motion Control, 3, 687 2008. [5] T. Umeno et al.; IEEE Trans. Ind. Electron., 38, 5, 363, 1991. [6] T. Mita et al.; IEEE Trans. Ind. Electron., 45, 3, 488, 1998. [7] C. C. Wang et al.; In Proc. American Control Conference, 6, 3764, 2004. [8] K. Thum et al.; IET Control Theory and Applications, 3, 12, 1591 2009. [9] B. A. Francis et al.; Automatica, 12, 5, 457, 1976. [10] E. Schrijver et al.; ASME J. Dynamic System, Measurement, and Control, 124, 539, 2002. [11] J. C. Doyle et al.; IEEE Trans. Auto. Control, 34, 8, 831, 1989. [12] K. Glover et al.; SIAM J. Control and Optimazation, 29, 2, 283, 1991. － 23 －