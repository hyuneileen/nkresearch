김일성종합대학학보 정보과학 주체108(2019)년 제65권  제2호 HPS FPGA에 의한 SoC체계설계의 한가지 방법 김 운 봉 FPGA를 리용하여 매몰형체계를 설계할 때 지난 시기에는 Nios II쏘프트처리기를 리 용하여 하드웨어체계와 쏘프트웨어체계를 구축하고 이에 기초하여 주변장치를 조종하였 다.[1, 2] 현재 HPS를 갖춘 FPGA가 출현하면서 보다 쉽고 효률적인 체계를 구축할수 있게 되 였다. HPS FPGA를 리용하여 체계를 설계하는것은 지난 시기의 Nios II쏘프트처리기를 리 용하여 설계하는것에 비하여 더 복잡하다. 그것은 FPGA가 HPS를 내장하고있는것과 관련 된다. HPS FPGA를 리용하여 체계를 설계하는것은 개별적인 매몰형처리기들을 쓰는것보다 기판공간이나 전력소비, 가격을 감소시킬수 있으며 체계를 장치와 프로그람부분으로 구별 하고 프로그람적으로 임의의 표준대면부의 추가 및 쏘프트웨어갱신을 통하여 성능개선과 가격저하를 진행할수 있는 커다란 우점을 가지고있다. 론문에서는 HPS FPGA인 Cyclon V SE FPGA를 리용하여 주변장치를 구동하는 SoC체 계를 구축하는 문제를 설정하고 해결하였다. Cyclon V SE FPGA는 dual-core ARM Cotex-A9 MPCore처리기와 여러가지 주변장치대면 부들과 다중포구기억기조종기를 내장하고있다. HPS에 의하여 주변장치 PIO대면부를 비롯한 FPGA자원들을 조종하는 SoC체계는 크 게 두 부분으로 구성된다. 하나는 HPS에 의한 FPGA의 주변장치대면부조종하드웨어설계이다. 이 설계는 FPGA 통합개발도구 Quartus II와 체계통합개발도구 Qsys를 리용하여 진행한다. 다른 하나는 HPS에 의한 FPGA의 주변장치대면부를 조종하기 위한 응용프로그람설 계이다. 이 설계는 Altera SoC EDS개발도구를 리용하여 진행한다. 여기서는 FPGA와 결합된 LED와 표시소자를 조종하는 SoC체계의 하드웨어를 Qsys개 발도구를 리용하여 설계하는 방법을 고찰한다. 이 체계는 HPS와 FPGA자원사이의 통신을 통하여 LED나 표시소자와 같은 요구되는 임의의 장치들을 조종하는 전형적인 체계이다. 이러한 SoC하드웨어체계의 주변장치대면부설계는 Quartus체계가 지원하는 MegaWizard의 PIO IP Core성분들을 리용하여 진행한다. 한편 HPS와 FPGA는 고성능모선대면부를 통하여 결합되여있으므로 서로 호출할수 있으며 따라서 HPS는 모선대면부를 통해 FPGA의 주변장치들인 LED와 표시소자를 조종 한다. HPS에 의한 LED와 표시소자조종구성도를 그림 1에 보여주었다. 그림 1에서 보는바와 같이 모선대면부를 통하여 전송되는 자료는 Avalon-MM종대면 부를 가진 PIO대면부에 전달되며 해당 단자들을 통하여 LED와 표시소자를 조종한다. － 92 － 종합대학학보 정보과학 주체108(2019)년 제65권 제2호 이것은 PIO대면부를 가진 LED와 표시소자를 조종하는 Nios II처리기를 리용한 체계 와 류사하다. 그림 1. HPS에 의한 LED와 표시소자조종구성도 우에서 고찰한 SoC체계설계는 다음과 같이 진행한다. ① 우선 하드웨어는 Qsys로 설계하고 콤파일하여 얻어진 .sof화일을 FPGA에 내리적 재하여 FPGA를 구성한다. 그리고 Quartus II쓰기프로그람을 리용하여 JTAG대면부로 .sof화 일을 내리적재하여 SoC체계의 하드웨어를 구축한다. 이때 얻어진 .sopcinfo화일은 SoC체 계의 하드웨어구성정보를 반영한 화일로서 체계의 프로그람작성을 위한 머리부화일을 생 성할 때 리용된다. ② 다음으로 SoC체계에서 실행될 프로그람을 작성한다. 프로그람작성에서는 먼저 HPS머리부화일을 작성한다. Nios II체계설계에서는 eclipse개 .sopcinfo화일정보에 기초하여 머리부화일을 자동생성하지만 SoC체계에서는 발환경이 Linux쉘배치화일을 리용하여 머리부화일을 수동적으로 작성한다. 다음으로 PIO주변장치의 물리주소를 응용프로그람에서 호출할수 있는 가상주소로 넘 겨야 한다. 그것은 모선대면부가 HPS의 한 주변장치로서 Linux에서 실행되는 프로그람은 HPS주변장치의 물리주소를 호출할수 없기때문이다. 따라서 주변장치를 호출하기 전에 물 리주소를 사용자공간으로 넘겨야 한다.  주소넘기기과정은 다음과 같다. ㄱ) open지령을 리용하여 기억장치를 호출한다. ㄴ) mmap지령을 리용하여 HPS물리주소를 가상주소로 넘긴다. ㄷ) 주변장치의 가상주소에 2개의 옵세트주소들을 가산한다. 여기서 첫번째 옵세트주 소는 HPS기초주소가 할당된 모선대면부의 옵세트주소이며 두번째 옵세트주소는 PIO주변 장치대면부의 옵세트주소이다. 이 가상주소를 리용하여 응용프로그람에서는 PIO주변장치등록기들을 호출하는데 이 등록기들의 비트수는 32bit이다. 다음으로 main함수에서 부분스레드를 창조하는데 이것은 다중스레드쏘프트웨어를 지 원하는 Linux의 부분스레드창조함수 pthread_creat를 리용하여 창조한다. 이때 main함수의 부분스레드는 LED를, main함수의 기본스레드는 표시소자를 조종한다. 이와 같이 설계된 SoC체계의 장치와 프로그람을 FPGA에 적재한다. 먼저 프로그람을 HPS FPGA에 의한 SoC체계설계의 한가지 방법 － 93 － 부트SD카드에 복사한다. 이 프로그람복사는 PC와 FPGA장치의 micro USB접속구를 통하여 진행한다. 이를 위 해 UART말단을 구성해야 하는데 말단은 PuTTY를 리용하여 실현한다. 다음 설계된 SoC체계의 장치구성자료를 Cyclon V SE SoC FPGA에 내리적재한다. 구성 자료를 내리적재하는 방법에는 HPS조종기를 리용하는 방법과 리용하지 않는 방법이 있 다. 여기서는 HPS조종기를 리용하지 않는 방법으로 내리적재를 진행한다. HPS조종기를 리용하지 않는 경우 FPGA구성은 FPGA내부조종기에 의해 JTAG방식으로 진행한다. HPS 조종기를 리용하지 않는 경우 프로그람내리적재 및 실행흐름은 그림 2와 같다. 그림 2. 프로그람내리적재 및 실행흐름 실행흐름결과 프로그람내리적재 및 실행흐름에 따라 설계된 SoC체계의 장치구성자료 가 FPGA에 내리적재되고 작성된 프로그람이 실행되여 주변장치들인 LED와 표시소자를 조종한다. Cyclon V SE FPGA를 리용하여 주변장치를 구동하는 SoC체계를 구축하는 문제를 설정 하고 해결하였다. Cyclon V SE FPGA는 HPS와 함께 일반FPGA자원을 가지고있으므로 FPGA자원으로 주 변장치를 구동하기 위한 대면부를 구성하고 HPS에 의한 FPGA주변장치를 조종하는 SoC 체계의 장치와 프로그람을 설계하고 실현하였다. 맺 는 말 참 고 문 헌 [1] G. Vijay et al.; International Journal of Advancements in Technology, 3, 4, 1, 2012. [2] 林振营 等; 现代电子技术, 6, 79, 2007. 주체108(2019)년 2월 5일 원고접수 － 94 － 종합대학학보 정보과학 주체108(2019)년 제65권 제2호 A Method of SoC System Design by HPS FPGA Kim Un Bong In this paper composed an interface for driving peripherals by using HPS equipped in FPGA with no Nios II soft processor, designed SoC system controlling peripherals and realized. Key words: FPGA, embedded system