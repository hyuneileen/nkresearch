김일성종합대학학보 정보과학 주체108(2019)년 제65권  제1호 화상합성에서 시각적특성에 기초한 조명방향검출의 한가지 방법 서효선, 천정수 화상합성기술[1]은 필요한 대상을 다른 화상에 합성하는 기술로서 화상편집과 영상편 집, 영화제작을 비롯하여 화상처리와 증강현실에서 중요한 문제로 제기되고있다. 화상합 성을 정확히 하기 위해서는 화상의 조명조건을 검출하고 조절하여 합성한 화상의 밝기를 일치시켜야 한다. 화상에서 대상에 비쳐진 조명의 방향을 검출하는 문제[2]는 유일한 풀 이를 가지지 않는다. 론문에서는 조명의 물리적인 제약과 함께 사람의 시각적특성을 리용하여 조명방향을 검출하는 방법을 제안하였다. １．선행연구와 문제설정 선행연구[2]에서는 1개 조명의 방향을 검출하기 위하여 대상표면의 국부적인 분석을 진행하고 그림자를 리용하여 조명방향을 검출하는 방법을 제안하였다. 선행연구[1]에서는 람베르트구면을 리용하여 다중조명방향을 검출하는 방법을 제안하였으며 선행연구[2]에서 는 람베르트와 반사구를 결합하여 조명방향을 검출하는 방법을 제안하였다. 선행방법들은 조명방향을 검출하는데서 물리적인 제한만을 주고 시각적특성에 대해 서는 고려하지 않았다. ２．조명조건에 대한 시각적고찰 일반적으로 사람의 시각체계는 화상들에서 조명방향과 세기를 정확하게 분석한다. 시 각체계의 이러한 특성을 리용하면 화상에서 조명방향과 세기를 쉽게 구할수 있다. 사람의 시각체계는 화상에서 대상의 조명방향을 검출할 때 대상이 대역적인 불룩도 를 가진다는것을 가정하고 조명방향을 검출하며 그림자가 생기는 화상에 대해서도 그림 자의 정보를 리용하여 조명의 방향을 검출한다. 그러나 자연화상들에서 여러가지 반사빛의 영향으로 대상에 비쳐진 조명의 방향을 검출하는것이 어려울 때도 있지만 시각체계는 이러한 복잡성을 무시하므로 복잡한 환경 에서 조명의 방향과 세기를 정확하게 분석하지 못하는 제한성을 가지고있다. 또한 시각체 계는 밝기변화와 멀고 가까운것에 민감하며 조명조건을 느낄 때 문양과 같은 고주파성분 의 영향에 대해서는 무시한다. 시각체계의 이러한 특성을 고찰한데 기초하여 화상에서 대상의 조명방향을 검출하기 위하여 우연적인 위치와 방향을 가지는 같은 대상의 모임들가운데서 국부적으로 변하는 대상표면밝기변화의 인식과정을 정점각과 방위각을 변화시키면서 실험적으로 확인하였다. － 50 － 종합대학학보 정보과학 주체108(2019)년 제65권 제1호 실험을 통하여 시각체계는 조명방향을 정점각과 방위각을 리용하여 추정할수 있으며 정점각에서보다 방위각에서 추정하는것이 더 좋다는것을 확증하였다. ３．시각적특성에 기초한 조명의 방향검출 조명의 방향검출에서 방위각과 정점각을 계산하기 위한 공간자리표계를 그림 1에 보 여주었다. Z θ X φ Y 그림 1. 방위각과 정점각을 계산하기 위한 공간자리표계 그림 1에서 보여준것처럼 화상평면을 는 방향 즉 오른손자리표계가 성립되도록 X 축을 설정하였다. 이때 방위각은 에서 Y 축과 이루는 각(그림 1에서 ϕ)이고 정점각은 ZY − 평면으로 하고 화상평면에서 앞으로 나오 ZY − 평면 YX − 평면에서 X 축과 이루는 각(그 림 1에서 θ)이다. 조명의 방위각을 추정하기 위하여 대상의 륜곽을 따라 세기변화를 분석하고 륜곽법 선과 표준확산빛모형을 리용하며 정점각과 상대세기를 추정하기 위해 대상이 대역적인 불룩기하체라고 가정한다. 륜곽의 법선이 화상평면에 놓이고 N 개의 조명이 지향적인 혹은 멀리에서 오는 빛이 에 라고 가정하자. 그러면 매개 조명은 알려지지 않은 밝기 N jL 와 단위방향 j L=ω ,1 , , j 의하여 유일하게 특징지어진다. 이제 in 가 륜곽우의 화소점의 법선이고 v iL 는 화소점 iP 에서 대상의 알려진 밝기라 고 하면 람베르트확산반사빛모형에 의하여 다음과 같이 표시할수 있다. v i L ∑ N Ω= 1 j = L j ij (1) Ω=Ω ij ( n i , ω j ) = ,0 n i ⋅ ω j < 0 d nK i i ⋅ ω j , n i ⋅ ω j ≥ 0 ⎧ ⎪ ⎨ ⎪⎩ 여기서 iK 는 화소 i 의 확산반사곁수이다. d 법선 in 는 ZY − 평면에 놓이며 극자리표계로 표시하면 다음과 같다. 화상합성에서 시각적특성에 기초한 조명방향검출의 한가지 방법 － 51 － 여러개의 조명을 리용하는 경우 조명빛의 방위각 in = ,0[ sin( n φ i Tn )] φ i 2 ≤ ), 0, cos( n i jφ 을 추정하기 위하여 k －평균클 }{ iθ 를 추정하기 위하여 륜곽에서 내부에로의 빛의 (2) ≤ πφ l 라스터알고리듬을 리용한다. 정점각 방향에서 밝기를 분석한다. 화소의 밝기는 여러개의 조명빛에 의하여 비추어진 결과이므로 조명의 방향도함수 는 그 방향으로 정렬되는 개별적인 조명빛에 대한 그림자를 가리킨다. 만일 방향 v L∇⋅ω j 도함수가 륜곽에서 정수이면 빛은 대상에서 카메라로 향하는데 이 경우 밝기는 증가한다. n 를 지적하며 대상이 자체로 막히거나 이 점 jP 에서 곡면법선은 빛의 방향 Pθθ = hi j hi ( ) j 다른 빛의 영향을 받을수 있기때문에 그다음의 모든 화소들은 무시한다. 륜곽에서 방향도함수가 부수이면 뒤쪽의 조명을 가리키는데 이때 밝기는 감소된다. 의 부호가 변하든가 혹 jP 이며 방향도함수 이때의 화소점은 첫번째 자체음영점 v L∇⋅ω lo j 은 그 밝기 정점각 vL 값은 령으로 표시된다.  }{ iθ 와 밝기 각을 다음과 같이 표시한다. v ijL 에 대응하는 점들의 모임 { hi ijP } 혹은 { lo ijP 를 검출하고 정점 } θ j = (3) v L θ ij ij v L ij ∑ ∑ i i 매개 조명에 대한 빛의 세기는 다음과 같다. I j ∝ ∑ Ω v / L j ( n i j i , ω                            (4) ) ４．실험결과와 분석 론문에서 제안한 방법의 정확성을 확증하기 위하여 조명을 제정된 방향에서 주고 정 점각과 방위각을 계산하였다. 실험에 리용한 화상을 그림 2에 보여주었다. 화상 1 화상 2 화상 3 그림 2. 실험에 리용한 화상 각이한 조명조건에서의 오차분석결과를 표에 보여주었다. 절대오차는 실지 조명방향과 알고리듬으로 구한 조명방향의 차의 절대값으로 계산하 였다. 이때 조명방향은 구체적으로 방위각과 정점각으로 표현된다. 표에서 보여준것처럼 실험에 리용한 화상들에 대하여 절대오차를 비교해보면 선행 － 52 － 종합대학학보 정보과학 주체108(2019)년 제65권 제1호 방법들에 비하여 론문에서 제기한 방법의 절대오차가 더 작다는것을 알수 있다. 표. 각이한 조명조건에서의 오차분석결과 실험대상 실험방법 조명 1 조명 2 실지 조명방향 방위각 정점각 방위각 정점각 165.00 －40.00 －15.00 162.25 －54.03 제안된 방법으로 구한 조명방향 10.71 14.03 2.75 10.71 40.00 35.31 제안된 방법의 절대오차 선행연구[2]방법의 절대오차 실지 조명방향 20.71 6.09 90.00 －70.00 제안된 방법으로 구한 조명방향 94.54 －65.70 4.69 4.58 24.03 4.54 5.03 제안된 방법의 절대오차 선행연구[2]방법의 절대오차 실지 조명방향 180.00 제안된 방법으로 구한 조명방향 172.50 7.50 제안된 방법의 절대오차 선행연구[2]방법의 절대오차 12.50 4.3 4.5 0.00 9.48 9.48 14.48 0.00 0.00 0.00 1.45 0.00 6.31 6.31 11.31 화상 1 화상 2 화상 3 사람의 시각적특성을 리용하여 화상에서 대상의 조명방향을 추정하는 방법을 제안하 였다. 이 방법은 조명의 물리적인 특성만을 리용한 방법에 비하여 조명방향을 비교적 정 확히 검출하였다. 맺 는 말 참 고 문 헌 [1] Pablo Carballeira, Fernando Jaureguizar; Signal Processing: Image Communication, 41, 128, 2016. [2] Jorge Lopez-Moreno; Computers & Graphics, 34 698, 2010. 주체107(2018)년 11월 5일 원고접수 A Method of the Light Direction Detection Based on the Visual Character in the Image Composition So Hyo Son, Chon Jong Su In this paper we present a method of estimating the light direction of an object from an image using the visual character of a person. Key words: image composition, matting, light condition