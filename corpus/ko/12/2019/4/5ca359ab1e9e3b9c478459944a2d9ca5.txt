김일성종합대학학보 정보과학 주체108(2019)년 제65권  제4호 STM32에 기초한 온도측정체계설계의 한가지 방법 리광식, 리충식 현재 생산현장들에서 응용되고있는 온도수감부들인 열저항이나 열전대는 측정결과가 상사량으로서 그것을 처리하는 과정에 측정정밀도가 떨어지게 된다. 그리하여 전용측정장 치를 리용하든가 여러가지 회로들로 측정회로를 구성하여 리용한다.[2] 론문에서는 ARM Cortex-M3핵심의 극소형조종기소편 STM32를 리용하여 여러점온도 측정체계를 설계하고 그 하드웨어설계의 원리도를 제기하였다. 또한 온도측정부분, 경보 회로 및 상위와의 통신부분의 설계를 진행하고 련관된 쏘프트웨어를 작성하였다. １．체계의 총체적인 구성 체계는 STM32F103VET6을 처리기로 하고 8개의 DS18B20을 온도측정부분으로 하여 여러점측정을 실현한다. 7쪼각표시장치로 표시를 실현하고 건반으로 서로 다른 측정점사 이의 절환을 실현한다. RS232를 리용하여 상위와의 통신 및 표시를 실현하며 설정한 온도 값을 초과할 때 체계는 경보를 발생한다. 체계의 총체적인 구성도는 그림 1과 같다. 그림 1. 총체적인 구성도 ２．체계의 하드웨어설계 ① 온도측정부분 DS18B20은 수자화된 단일모선규약의 온도수감부이다. 극소형처리기의 1개 I/O포구만 을 리용할뿐아니라 어떠한 외부요소도 필요없으며 직접 온도를 수자신호로 변환하여 수 자방식으로 직렬로 출력하므로 수감부와 처리기사이의 결합부가 대단히 간단하다. 전통적인 열저항 등의 온도수감부에 비하여 크기가 작고 동작전압범위가 넓으며 측 정온도범위는 －55～+125℃이고 －10～+85℃에서는 정확도가 ±0.5℃이다. 그 설정분해능 과 사용자가 설정한 경보온도는 EEPROM에 기억되므로 전원이 차단된 후에도 여전히 보 존된다.[1, 3] － 68 － 종합대학학보 정보과학 주체108(2019)년 제65권 제4호 이 체계는 8통로의 여러점온도를 측정한다.(그림 2) 그림 2. 8개의 DS18B20과 STM32의 련결도 ② 처리기 STM32는 실시간성능, 전력조종, 선진적인 구조설계 및 높은 성능대가격비의 특성을 가지고있다. 이 체계의 처리기는 Cortex-M3에 기초한 STM32F193VET6으로서 LQFP100패 키쥐형식을 리용한다. 100개의 핀을 가지고있으며 수정편발진입력, 전원입력, Boot입력을 제외한 나머지 80개 핀이 모두 GPIO(GPIOA～GPIOE)이며 동작주파수는 최대 72MHz이고 512B의 프로그람기억공간을 가지고있다.[4] ③ 수자표시 온도측정체계의 표시부는 7쪼각 LED표시장치이다. 표시장치의 위치선택은 GPIOC0～ GPIO7포구를 리용하여 진행하며 8개의 음극공통LED표시장치의 토막선택신호 a～g, dp는 GPIOC8～GPIO15포구의 출력을 리용하여 조종한다. STM32의 GPIO구동능력이 부족하므로 STM32와 표시장치사이에 구동회로를 추가하 여야 하는데 전용구동소편을 리용하거나 끌어올림저항을 리용하는 방법을 사용할수 있다. 이 체계에서는 2개의 74HC573을 리용하는데 이 소자는 출력전류가 비교적 크며 원가도 낮고 회로결합부도 간단하다. ④ 건반 건반으로는 4×4행렬건반을 리용하는데 이것을 통하여 1～8통로의 온도측정점의 선 택, 경보재설정 등 온도측정체계와 관련한 일련의 설정을 진행한다. ⑤ 경보회로 측정점의 온도가 설정한 온도값을 초과하지 않을 때 GPIOD8은 낮은 준위신호를 출 력하여 고성기가 동작하지 못하게 한다. 만일 설정한 온도값을 초과할 때에는 높은 준위 신호를 출력하여 고성기가 경보신호를 울리게 한다. ⑥ 상위와의 통신 통신결합부의 설계는 체계에 매우 중요한 부분으로 된다. 상위와의 통신을 실현하기 위하여 RS－232직렬통신결합부를 리용하였다. ３．체계쏘프트웨어설계 설계요구에 따라 체계쏘프트웨어는 주로 온도의 측정 및 기억, 경보, LED표시 및 직 렬포구를 통한 상위와의 통신을 진행한다. STM32에 기초한 온도측정체계설계의 한가지 방법 － 69 － ① 초기화 우선 GPIO포구배치초기화를 진행한다. GPIOA0을 온도측정통로로 배치하고 GPIOA2, GPIOA3, GPIOA9 및 GPIOA10을 직렬포구의 입출력으로 배치한다. GPIOC0～GPIO7은 표시장치 의 조종신호출력으로 설정한다. GPIOC8～GPIOC15는 표시장치의 토막선택신호로 하며 GPIOD8 은 고성기를 조종한다. GPIOD0～GPIOD7은 건반과 련결한 후 건반이 눌려졌는가, 중단프로그람 으로 들어가겠는가, 어느 건반이 눌려졌는가를 판단하고 대응하는 프로그람을 호출한다. ② 자료의 측정 DS18B20의 단일모선에 의한 수자식전송은 체계의 잡음저항능력이 높고 직접 측정된 온도값을 읽을수 있으므로 체계가 다시 려파처리를 할 필요가 없다. 분해능은 각각 0.5, 0.25, 0.125 및 0.0625℃로서 높은 정밀도의 온도측정을 실현할수 있다. ③ PID알고리듬을 가진 온도초과경보 경보의 정확성을 위하여 수자PID알고리듬을 추가하였다. 이 알고리듬은 간단하고 사 용하기가 편리하며 적응성이 강하고 모형에 대한 의존성이 작은것 등의 우점을 가지고있 다. 체계가 리용하는 증분형PID알고리듬의 공식은 다음과 같다. uu =Δ i ed 2 i ed 0 i ed 1 i u i + + = − 1 − 1 − − 2 여기서 d 0 = K 1 + ⎛ ⎜⎜ ⎝ T T i + T d T ⎞ ⎟⎟ , ⎠ d 1 −= K + ⎛ 1 ⎜ ⎝ 2 T d T ⎞ , ⎟ ⎠ d 2 = K T d T 이며 T는 표본화주기이다. 초기화시 기억기의 고정단위에 조절파라메터 d d 1 , d 2 를 넣고 오차초기값을 e i = e i 1 − = e i − 2 = , 0 0 으로 설정하여야 한다. 있다. 쏘프트웨어적으로 GPIOD8의 출력준위를 조절하여 경보회로동작의 목적을 달성할수 ④ 온도측정결과표시 자원을 절약하기 위하여 동적표시를 리용한다. ⑤ 직렬통신 이 쏘프트웨어는 또한 직렬포구를 통한 PC와의 통신프로그람을 포함한다. 측정한 온 도를 1s간격으로 직렬포구를 통하여 상위(여기서는 PC)로 전송한다. STM32의 펌웨어함수를 리용하여 직렬포구의 파라메터(실례로 보드속도는 115 200bps, 자료길이 8bit, 검사비트없음, 정지비트 1)를 설정하며 직렬통신선을 리용하여 PC와의 직 렬통신을 실현한다. 맺 는 말 설계한 여러점온도측정체계는 잡음억제 및 정밀도가 비교적 높고 조작이 간단하며 실용성이 강하고 확장하기 쉬우며 배치가 간단하고 원가가 적은것 등의 우점들을 가지고 있다. － 70 － 종합대학학보 정보과학 주체108(2019)년 제65권 제4호 참 고 문 헌 [1] Zhang Hai Feng; Procedia Engineering, 15, 246, 2011. [2] 严义; 单片机试验与实践交城(1), 航空航天大学出版社, 193～202, 2006. [3] 郭佑民; 兰州交通大学学报, 31, 4, 91, 2012. [4] 喻金钱 ;  STM32系列ARM Cortex - M3核微控制器开发与应用[M], 清华大学出版社, 112～116, 2011. Design of Temperature Measurement System Based on STM32 주체108(2019)년 8월 5일 원고접수 Ri Kwang Sik, Ri Chung Sik A method of designing multi-point temperature measurement system is introduced in paper, which is based on a high performance ARM Cortex-M3 microcontroller STM32. Since DS18B20 and STM32 microcontroller is highly integrated, the hardware structure is simplified. Key words: multi-point temperature measurement, DS18B20, STM32