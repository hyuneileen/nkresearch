김일성종합대학학보 정보과학 주체110(2021)년 제67권  제2호 초점손실을 리용한 클라스불균형문제해결의 한가지 방법 홍윤일, 홍광철 경애하는 동지께서는 다음과 같이 말씀하시였다.  《첨단과학기술분야에서 세계적경쟁력을 가진 기술들을 개발하기 위한 투쟁을 힘있게 벌려야 합니다.》 인공지능기술은 첨단과학기술분야를 개척하고 선도해나가는데서 핵심적인 역할을 하 고있으며 특히 화상처리기술의 도입은 인민경제와 사회생활의 많은 분야에서 절실한 요 구로 나서고있다. 대상검출은 입력되는 화상에서 주목하는 대상의 령역(위치와 크기)을 추출하는 문제 로서 화상처리에서 많이 응용되고있는 분야의 하나이다. 론문에서는 초점손실함수를 리용하여 대상검출에서 문제점으로 제기되고있는 전경－ 배경클라스불균형문제해결방법을 제안하였다. １．클라스불균형문제 대상검출에서 리용되는 분류기들은 입력화상의 가능한 모든 위치와 크기에서 쪼각화 상들을 추출하고 추출된 쪼각화상들을 입력하여 결과를 출력한다. 쪼각화상을 추출하기 위해 지난 시기에 창문주사방식을 많이 리용하였는데 1개 화상에서 보통 수십만개의 쪼 각화상이 생겨나며 그중에서 실지대상이 포함된 쪼각화상은 불과 몇개 정도이다. 이것은 대상검출을 위한 분류기들이 취급하는 표본모임에서 배경과 전경사이의 불균형이 매우 크다는것을 보여주고있다. 전통적인 대상검출방법(Boosting, DPM)들은 물론 최근의 심층신경망을 리용한 대상검 출방법(YOLO[1])들도 학습과정에 클라스불균형문제와 직면하게 된다. 이 검출기들은 1개 화 상에서 개의 후보들을 처리하게 되는데 불과 몇개 후보만이 실지대상으로 된다. 4 10~ 10 5 불균형문제는 분류기를 학습하는데서도 나타나는데 두가지 문제가 제기된다.  첫째로, 대부분의 표본들이 학습개선에 도움을 주지 못하는 분류가 쉬운 부의 표본 인것으로 하여 학습과정이 비효률적이다. 둘째로, 쉬운 부의 표본들이 학습을 주도하여 모형을 퇴화시킬수 있다는것이다.  론문에서는 클라스불균형을 해결하기 위한 한가지 방도로서 새로운 초점손실함수를 도입하고 그 효과성을 검증하였다. ２．초점손실함수에 의한 클라스불균형문제해결 클라스불균형문제를 해결하기 위한 많은 방법들이 제안되였다. 대상검출분야에서 현 재 가장 높은 정확도를 가진 검출기들은 R-CNN이라고 하는 2단방법에 기초한다. － 70 － 종합대학학보 정보과학 주체110(2021)년 제67권 제2호  2단방법이란 대상검출이 크게 2개의 단계로 나누어져 수행되는 방법을 말한다.  1단계에서는 입력되는 화상에서 추출되는 수많은 쪼각화상중에서 소수(보통 몇천개) 의 령역(직4각형)을 후보로 선택하여 2단계에 넘긴다. 2단계에서는 성능이 높은 분류기를 후보들에 적용하여 최종적으로 대상들의 위치와 크기를 결정한다. 2단계에서 사용되는 분류기들은 1단계를 통과하여 나온 소수의 후보들만 대상하는것 으로 하여 이러한 류형의 방법들에서는 클라스불균형문제가 제기되지 않는다. 그러나 이 것은 계산원가가 높은 심층신경망을 모든 후보들에서 실행하는것으로 하여 대상검출시간 이 긴 결함을 가지고있다. 대조적으로 가능한 대상위치들의 규칙적이고 밀집된 표본화에 적용되는 1단검출기들 은 더 빠르고 더 간단하지만 지금까지 2단검출기들의 정확도에 도달하지 못하고있다. 그 원인의 하나가 극단한 전경－배경클라스불균형이 분류기를 학습하는 과정에 영향을 주고 있기때문이다. 교차엔트로피손실과 초점손실을 그림에 보여주었다. (CE p t ) −= log( p t ) (FL p t ) 1( −−= γ ) p t log( p t ) 실 손 5 4 3 2 1 0=γ 5.0=γ 1=γ 2=γ 5=γ 분류가 쉬운 표본 0 0.2 0.4 tp 0.6 0.8 1 그림. 교차엔트로피손실과 초점손실 전경－배경클라스불균형을 해결하기 위한 방도의 하나로 교차엔트로피손실함수계산 인 표본에는 무게인자 α−1 를 도입하는 1= − =y 1 인 표본에는 무게인자 ]1,0[∈α , y 두값분류에 대한 교차엔트로피(CE: Cross Entropy)손실에 기초하여 초점손실을 론의하 에 α－평형방법이 있다. 자. 즉 교차엔트로피를 ,(CE ) = yp ⎧ ⎨ ⎩ }1,1{ −∈y 1 = ), yp log( ), yp 1 log( − − − 은 표본들의 클라스표식을 의미하고 −= (1) 1 ]1,0[∈p 과 같이 표시할수 있다. 여기서 은 표식 =y 1을 가진 클라스에 대한 모형의 평가확률이다. 표기를 편리하게 하기 위해 를 도입한다. 즉 tp pt = , yp ⎧ ⎨ 1 − ⎩ 1 = , yp −= 1 (2) 이다. 교차엔트로피를 다음과 같이 간단히 표시할수 있다. 초점손실을 리용한 클라스불균형문제해결의 한가지 방법  (CE ) t CE손실을 그림의 제일 웃선을 통하여 알수 있다. 그림에서 보여준것처럼 CE손실의 들이 작지 않은 크기의 손실을 초 (3) ,(CE log( )5.0 yp −= = p p ) ( ) t >>tp － 71 － 한가지 주목할만 한것은 쉽게 분류되는 표본 래한다는것이다. 분류가 쉬운 표본들의 손실이 아무리 작다고 하여도 그 수가 대단히 많기때문에 그 것을 합치면 이 작은 손실값들은 정의 클라스에서 산생되는 손실보다 클수 있다. 여러 클라스경우에도 이 문제는 마찬가지로 나타나기때문에 간단히 2값분류문제에 대하여서만 론의하기로 한다. 표기의 편리성을 위하여 의 정의와 류사하게 를 정의하고 CE손실을 tp α−= t 와 같이 수정한다. 이러한 방법에 기초하여 클라스불균형을 취급하기 위한 이전수법들보 다 더 효과적인 새로운 손실함수를 론의한다. (4) (CE log( p p ) t t 손실함수는 동적으로 척도화(scale)된 교차엔트로피손실이다. 여기서 척도인자는 클라 스에서의 믿음도가 증가하면 령으로 감소하도록 설계한다. 직관적으로 이 척도인자는 훈 련과정에 분류가 쉬운 표본들이 손실함수에 기여하는 무게를 자동적으로 낮추고 모형을 분류가 어려운 표본에 빨리 집중할수 있도록 한다. tα 초점손실은 학습과정에 전경과 배경클라스들사이에 극단한 불균형이 있는 1단대상검 출방법에 적용한다. 쉽게 분류된 부의 표본들은 손실의 대부분을 포함하며 경사도를 지 배한다. 가 정의/부의 표본들의 중요성을 나타내지만 그것은 쉬운 표본(분류가 쉬운 표본)과 힘든 표본(분류가 어려운 표본)들사이를 구별하지 못한다. 이로부터 를 리용하 는것 대신에 쉬운 표본들에 무게를 감소시키고 힘든 부의 표본들에 학습의 초점을 집중 하도록 손실함수를 갱신한다. tα 초점집중파라메터 0≥γ 을 가지고 교차엔트로피손실에 변조인자 1( tp− γ) 를 추가한 tα ) 다. 즉 (FL p t 의 여러값들에 대한 초점손실을 보여주었다. log( −= 1( − p p ) ) t t γ ) (5) 이다. 그림에서 ]5,0[∈γ 초점손실의 성질은 다음과 같다.  첫째로, 표본이 잘못 분류되고 가 작을 때 변조인자는 거의 1이고 손실에는 영향 tp (분류가 쉬운 표본)이면 인자는 0에 가까우며 따라서 분류가 쉬 을 주지 않는다. 1→tp 운 표본들에 대한 손실은 작아지게 된다. 둘째로, 그림의 아래선들에서 초점파라메터 γ 는 쉬운 표본들의 무게감소비률을 원 0=γ 일 때 FL은 CE와 동등하며 γ 가 증가됨에 따라 변조인자의 효과 활하게 조절한다. 도 마찬가지로 증가한다. 2=γ 일 때의 효과가 제일 좋다는것을 실험을 통하여 확증하였다. 직관적으로 변조 인자는 분류가 쉬운 표본들의 손실기여를 감소시키고 표본에서 낮은 손실을 기여하는 범 위를 확장한다.  실례로 9 로 분류된 표본은 CE와 비교할 때 100배 낮은 손실을 2=γ 인 경우 .0=tp 가지며 968.0≈tp 로 분류된 표본은 1 000배 낮은 손실을 가진다. 론문에서는 실제로 초점손실에 α－평형방법도 적용한다. (FL p ) −= t 1( α − t p t γ ) log( p ) (6) t － 72 － 종합대학학보 정보과학 주체110(2021)년 제67권 제2호 ３．성 능 평 가 론문에서 제안한 초점손실함수를 YOLO에 도입하고 최근의 2단검출방법, 1단검출방 법들과 비교하였다. Fast R-CNN방법[2]은 2단검출방법으로서 R-CNN을 갱신한 우수한 대상검출방법이다. YOLO[1]는 1단검출방법으로서 최근에 대상검출방법들에서 많이 리용되는 방법이다. 시험자료모임에서의 성능평가를 표에 보여주었다. 표．시험자료모임에서의 성능평가 검출기 선행방법[1] 선행방법[2] 제안한 방법 mAP/% 54.0 59.7 61.1 맺 는 말 참 고 문 헌 표에서 보여준것처럼 제안한 초점손실을 리용하는 방법이 시험자료모임에 대한 검출 정확성의 측면에서 우수한 방법이라는것을 실험을 통하여 확증하였다. 초점손실함수를 리용하여 대상검출에서 문제점으로 제기되고있는 전경－배경클라스 불균형문제해결방법을 제안하고 실험을 통하여 그 효과성을 확증하였다. [1] J. Redmon et al.; Computer Vision and Pattern Recognition, 1, 2, 6517, 2017. [2] R. B. Girshick; CoRR, abs/1504.08083, 2, 5, 2015. A Method of Addressing Class Imbalance Using Focal Loss 주체110(2021)년 2월 5일 원고접수 Hong Yun Il, Hong Kwang Chol In this paper, we propose a new loss function to address foreground-background class imbalance, which is a difficult issue arising in methods of detecting object in one-stage detector. Keywords: loss, class imbalance, object detection