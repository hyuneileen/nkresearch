김일성종합대학학보 정보과학 주체110(2021)년 제67권  제2호 콤퓨터단층촬영화상에서 ３차원 U-Net중첩신경망에 의한 페결절검출방법 김영주, 오수련 오늘날 인공지능기술을 의학화상처리에 적용하여 CT화상들을 분석함으로써 의사의 오진을 줄이고 진단을 지원하는 방법과 체계에 대한 연구가 활발히 진행되고있다. Faster R-CNN을 리용한 페결절검출방법[1]과 2차원U-Net중첩신경망을 리용한 페결절 검출방법[2]에서는 학습성능이 낮은 결함이 나타났으며 또한 3차원중첩신경망[3]과 3차원 U-Net망[4]을 리용한 페결절검출방법에서는 페결절검출에서 높은 성능을 보여주었지만 계산량이 많은것으로 하여 많은 기억용량을 요구하고 학습시간이 오랜 결함이 나타났다. 론문에서는 CT화상에서 3～10mm정도의 작은 결절들을 검출하기 위하여 3차원 U-Net중첩신경망에 기초한 페결절검출방법을 제안하였다. 제안된 망에서는 선행한 2차원 U-Net망과는 달리 단층화상들에서 결절의 3차원적인 공간정보를 고려하기때문에 페결절 검출정확도를 보다 높일수 있으며 적은 학습자료를 가지고도 2차원중첩신경망에 비하여 좋은 결과를 얻을수 있다. 론문에서는 또한 잉여모듈을 구현하여 그라디엔트소실문제를 해결하고 계산량을 줄이며 보다 깊은 신경망을 리용함으로써 학습성능을 개선하도록 하 였다. １．CT화상의 전처리 초기 CT화상에는 페조직과 관련이 없는 령역들도 존재하는데 페결절검출정확도를 높 이기 위해 이러한 령역들을 제거한다. CT화상의 바깥변두리의 화소값은 －1 000이다. 먼저 －400의 화소값을 턱값으로 하여 두값화상을 얻는다. 다음 형태학적인 처리(Morphological Operation)방법을 리용하여 경계령역을 제거한다.  그다음 련결령역들의 면적을 계산하여 가장 큰 2개의 령역을 얻고 기타 작은 령역들 은 제거한다. 얻어진 2개의 큰 령역들에서 구멍채우기(hole filling)방법을 리용하여 페령역 에 있는 잡음을 제거함으로써 페령역의 두값화상을 추출한다. 마지막으로 실지 CT화상에 대하여 앞에서 추출한 페조직령역을 찾아 페령역을 토막 화한다. ２．U-Net망의 구조 론문에서 제안한 망은 선행연구[2]에서 언급한 U-Net망을 개조하여 그림 1에 보여준 것처럼 19개의 중첩층을 포함한 총 45개의 층으로 구성되여있다. 망의 입력은 자료모임 에 존재하는 결절의 최대크기가 98 × 86인것을 고려하여 128 × 128크기의 단층화상쪼각 5개 로 설정한다. 우선 망을 3차원적으로 개조하여 단층화상들에서 결절의 3차원공간정보를 보충함으 로써 학습정확도를 높이도록 한다. 콤퓨터단층촬영화상에서 3차원 U-Net중첩신경망에 의한 페결절검출방법 － 57 － 2차원 U-Net망에서 입력층에 들어오는 입력화상의 크기는 128 × 128로서 2차원이지만 3차원 U-Net망의 입력층에 들어오는 입력화상은 128 × 128 × 5로서 3차원이다. 다음으로 잉여모듈[5]을 도입하여 계산량을 줄이고 선행한 U-Net(19층)보다 깊은 신 경망(45층)을 리용하였다. 심층신경망에서는 역전파과정에 출력층에서 입력층으로 가면서 무게값에 따라 그라디엔트소실문제가 생긴다. 이것은 학습의 성능저하에 큰 영향을 미친 다. 잉여모듈을 구현하면 이러한 그라디엔트소실문제를 해결할수 있다. 1 32 32 32 32 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 입력 64 64 64 64 5 × 4 6 × 4 6 5 × 4 6 × 4 6 5 × 4 6 × 4 6 5 × 4 6 × 4 6 5 × 4 6 × 4 6 128128128128 5 × 2 3 × 2 3 5 × 2 3 × 2 3 5 × 2 3 × 2 3 5 × 2 3 × 2 3 5 × 2 3 × 2 3 중첩층(3×3×1), ReLU 따내기 및 복사 최대플링층(2×2×1) 웃방향중첩층(3×3×1) 중첩층(1×1×1) 묶음정규화층 64 32 32 32 32 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 5 × 8 2 1 × 8 2 1 128   5 5 × × 4 4 6 6 × × 4 4 6 6 64 64 64 5 × 4 6 × 4 6 5 × 4 6 × 4 6 5 × 4 6 × 4 6 출력 256 128128128  5 × 2 3 × 2 3 5 × 2 3 × 2 3 5 × 2 3 × 2 3 5 × 2 3 × 2 3 5 × 2 3 × 2 3 256 256256256 512 256 256 256 5 × 6 1 × 6 1 5 × 6 1 × 6 1 5 × 6 1 × 6 1 5 × 6 1 × 6 1 5 × 6 1 × 6 1 5 × 8 × 8 5 × 6 1 × 6 1 5 × 8 × 8 51 51 51 5 × 8 × 8 5 × 8 × 8 5 × 8 × 8 5 × 6 1 × 6 1 5 × 6 1 × 6 1 5 × 6 1 × 6 1 5 × 6 1 × 6 1 ３．실험 및 결과분석 그림 1. 페결절검출을 위하여 론문에서 제안한 U-Net망의 구조 우리는 표준적인 페결절학습자료기지인 LIDC-IDRI[4]자료모임에서 1 000명의 환자들에 대 하여 1 245개의 결절표식자료를 리용하여 실험을 진행하였다. 화상의 크기는 512 pixel× 512pixel 이다. 결절이 포함되여있는 화상자료모임을 8:1:1의 비률에 따라 학습자료와 검사자료, 시험자료로 나눈다. 실험에서는 《RAM 16G》의 장치를 리용하였다. GPU의 RAM용량을 고려하여 학습묶음 의 크기를 3으로 설정하였다. 결정하였다. 손실함수[2]는 예측된 결절의 마스크와 실지 결절의 마스크사이의 오차를 계산하여 , YXS ( 1) −= |2 | X YX I | | Y + | | + + k k 여기서 X는 예측한 결절마스크, Y는 실지결절마스크, k는 0아닌 상수이다. 초기학습률은 310− 으로 설정하고 10단계(epoch)에 한번씩 1/10배 하였다. 페결절검출모형의 성능을 평가하기 위한 정확도는 예측결과와 해당한 결과에 따르는 － 58 － 종합대학학보 정보과학 주체110(2021)년 제67권 제2호 실지 결절사이의 겹침도를 가지고 결정한다.[4] 겹침도가 클수록 정확도가 큰 값을 가지 며 해당 모형의 성능이 높다는것을 말해준다. 론문에서 제안한 망의 파라메터수와 학습시간을 선행한 방법[1－4]들과 비교하였 다.(표 1) 표 １．학습파라메터수와 학습시간의 비교 모형 파라메터(×106)/개 학습단계/회 학습정확도/% 학습시간/h Faster R-CNN[1] 2차원U-Net[2] 3차원CNN[3] 3차원U-Net[4] 제안된 망 0.94 0.78 3.76 3.59 1.28 85.7 86.5 87.4 90.3 93.7 8 8 36 32 14 20 20 20 20 20 표 1을 통하여 알수 있는것처럼 3차원중첩신경망을 리용할 때 2차원의 경우보다 학 습파라메터수는 더 많아지며 학습시간도 오래 걸린다. 또한 같은 3차원중첩신경망이지만 론문에서 제안한 망을 리용하면 선행한 3차원 CNN이나 3차원 U-Net의 경우보다 학습파 라메터수가 적고 학습시간도 짧다는것을 알수 있다. 론문에서 제안한 망의 학습안정성을 선행한 방법[1－4]들과 비교하였다.(그림 2) 제안된 망 U-Net(2차원) Faster R-CNN CNN(3차원) U-Net(3차원) 1.00 0.85 0.70 차 오 0.55 0.40 0.25 0 20 40 60 80 100 120 학습단계/회 그림 2. 선행문헌과의 손실함수비교 그림 2에서 보여준것처럼 론문에서 제안한 망의 손실함수그라프가 다른 망의 손실함 수그라프에 비해 보다 안정성을 가지고 수렴한다는것을 알수 있다. 론문에서 제안한 방법과 선행한 방법[1－4]들과의 페결절검출정확도를 비교하였 다.(표 2) 표 2에서 보는것처럼 3차원중첩신경망을 리용하는것이 2차원의 경우보다 페결 절검출의 정확도가 높으며 론문에서 제안한 3차원 U-Net를 리용한 방법이 선행한 방법들보다 페결절검출에서 정확도가 높다. 표 1과 2를 종합하면 2차원중첩신경망에 비해 3차원중첩신경망의 학습파라메터수 2 2 3 3 3 맺 는 말 참 고 문 헌 콤퓨터단층촬영화상에서 3차원 U-Net중첩신경망에 의한 페결절검출방법 － 59 － 가 더 많고 학습시간도 오래 걸리지만 학습성능과 페결절검출정확도는 더 높다는것을 알 수 있다. 특히 론문에서 제안한 망을 리용하면 2차원의 경우보다 학습시간은 1.5～1.8배 걸리지만 페결절검출정확도는 13%이상 높일수 있다. 또한 론문에서 제안한 방법은 선행 한 3차원신경망의 경우보다 학습시간을 거의 1/3로 줄이면서도 높은 검출정확도(4%높음.) 를 얻는다. 표 ２．페결절검출정확도의 비교 방 법 모형의 차원 검출정확도/% Faster R-CNN[1] 2차원 U-Net[2] 3차원 CNN[3] 3차원 U-Net[4] 제안된 망 71.3 73.6 82.1 85.4 86.6 개선된 3차원 U-Net망에 기초한 페결절검출방법을 제안하고 실험을 통하여 그 효과 성을 검증하였다. [1] H. Xie; Pattern Recognition, 63, 476, 2017. [2] H. Liu et al.; Medical Image Analysis, 18, 2, 208, 2017. [3] J. Zhang; IEEE Transactions on Medical Imaging, 25, 4, 2016. [4] J. Xiao et al.; Computers in Biology and Mediciane, 14, 6, 702, 2018. [5] G. Tong et al.; Medical Image Analysis, 18, 2, 374, 2014. 주체110(2021)년 2월 5일 원고접수 Lung Nodule Detection Method by Using Three-Dimensional U-Net CNN in CT Scans Kim Yong Ju, O Su Ryon In this paper, we proposed lung nodule detection method based on improved three-dimensional U-Net and tested the efficiency. Our model used three-dimensional spatial information of the lung nodules in CT scans and introduced residual module to improve train performance. Keywords: lung, nodule, detection, deep learning