김일성종합대학학보 정보과학 주체110(2021)년 제67권  제3호 유연한 대기렬조종모형에 기초한 실시간적인 환자자료교환의 한가지 방법 김금철, 김훈 경애하는 동지께서는 다음과 같이 말씀하시였다. 《우리는 가까운 앞날에 전반적인 과학기술분야에서 세계를 디디고 올라설수 있다는 배심을 가지고 첨단돌파의 기적들을 련이어 창조하여야 합니다.》 환자자료를 기록하고 교환하는데서 실시간적이면서도 유연한 봉사를 제공하는것은 전반적인 의료봉사체계를 운영하는데서 매우 중요하다. 어떤 자료를 입력하면 그 결과가 실시간적으로 상대방에게 현시되여야 하며 자료전달방법도 유연하여야 한다.[1－3] 론문에서는 병원에서 대기렬조종모형에 기초한 대기렬봉사기를 구성하여 환자접수와 자료교환을 실시간적으로 하기 위한 방법을 제안하였다. １．대기렬조종모형과 대기렬봉사기구성 기존의 병원정보체계에서는 대기환자들에 대한 목록처리를 실시간적으로 진행하지 못하였다. 프로그람적으로 자료기지에 기록한 자료를 refresh하여 목록에 현시하였기때문에 실시간성이 보장되지 못하고 해당 간호원이나 의사들이 주기적으로 refresh조작을 진행 하였기때문에 불편한 점이 있었다.[2] 이러한 현상을 극복하기 위하여 소케트통신에 기초한 대기렬봉사기체계를 구성하였다. 대기렬봉사기는 대기렬전송원리를 다양하게 실현하는 봉사기이다. 대기렬을 리용한 전송원리를 그림 1에 보여주었다. 여기서 P는 송신자(Publisher)이고 C는 수신자(Consumer)로 볼수 있다. P P 대기렬 ㄱ) 대기렬 ㄴ) C 1C 2C 그림 1. 대기렬을 리용한 전송원리 ㄱ) 1:1전송, ㄴ) 1:2전송 하나의 대기렬을 리용하여 여러 수신자에게 동시에 자료를 전송할수 있다.  송신자가 보내는 통보문은 대기렬에 들어가고 수신자에게 소케트통신으로 전송하게 하면 우에서 언급한 약점을 극복할수 있을뿐아니라 여러가지 목적에 원활하게 사용할수 있다. 이러한 방식을 실현하기 위한 대기렬조종모형은 그림 2와 같다. 유연한 대기렬조종모형에 기초한 실시간적인 환자자료교환의 한가지 방법 － 33 － 송신자 송신 교환기 경로조종 대기렬 수신 수신자 그림 2. 대기렬조종모형 대기렬조종모형은 4개의 구성요소를 가지고있다. ① 송신자(Publisher) 송신자는 특정한 자료속성들을 규정하여 기초자료로 리용한다. 이 기초자료의 일부는 중개자로 리용되고 나머지는 자료를 수신하는 응용프로그람들에서만 리용된다. 망통신과 응용프로그람의 실행과정에 자료처리에서 오유가 발생할수 있으므로 대기렬 조종을 진행하는 대기렬봉사기는 수신자가 자료를 수신할 때 수신자가 자동적으로 혹은 개발자가 선택한 방법으로 자료의 중개를 통지하는 자료수신기능을 가지고있다. 자료수신기능을 리용할 때 중개자는 자료가 수신되였다는 통지가 오면 대기렬에서 자료를 완전히 지운다. ② 교환기(Exchange) 교환기는 자료들을 대기렬에로 송신하는 교환기이다. 교환기에서는 정의된 경로조종값(Routing Key)에 의하여 자료를 해당한 대기렬들에 송신한다. 전송한다. 교환기에는 4가지 종류가 있다. ㄱ) 직접교환기(Direct Exchange): 자료의 경로조종값에 기초하여 자료를 대기렬에로 직접교환기에서 경로조종은 다음과 같이 진행된다. · 대기렬은 하나의 경로조종열쇠값 K를 가지고 교환기에 련결되여있다. · 경로조종열쇠값 R를 가진 새로운 자료가 직접교환기에 도착하면 교환기는 자료를 K = R인 대기렬에로 경로를 조종한다. 단일방송에 적합하다. 그림 3에 직접교환기의 경로조종방법을 보여주었다. 직접교환기에 의한 경로조종은 :routing_key => “images.archive” archiver1 :routing_key => “images.archive” archiver2 :routing_key => “images.crop” cropper i m a g e s :routing_key => “images.resize” resizer 그림 3. 직접교환기의 경로조종방법 － 34 － 종합대학학보 정보과학 주체110(2021)년 제67권 제3호 ㄴ) 방송교환기(Fanout Exchange): 자료가 들어오면 교환기에 련결되여있는 모든 대기 렬들에 자료를 방송전송한다.(그림 4) 이때 경로조종값은 필요되지 않는다. 만일 n개의 대기렬들이 교환기에 련결되여있다면 교환기는 자료가 들어올 때 그 자 료를 n개의 모든 대기렬들에 전송한다. 교환기 경로조종 경로조종 경로조종 대기렬 대기렬 대기렬 대기렬 그림 4. 방송교환기의 경로조종방법 ㄷ) 다중전송교환기(Topic Exchange): 자료를 자료경로조종값과 교환기에 련결되여있는 대기렬들의 형식에 기초하여 자료를 1개 또는 그 이상의 대기렬들에로 전송한다. 다중전송교환기는 매우 다양한 경우들에 사용하며 보통 자료의 다중전송에 리용할수 있다. ㄹ) 머리부교환기(Headers Exchange): 경로조종값보다 다양한 다중속성들을 머리부에 가지고있는 자료들을 전송하는데 사용한다. 머리부교환기는 경로조종값대신에 경로조종에 쓰이는 속성들을 자료의 머리부에서 얻는다. ③ 대기렬(Queues) 대기렬봉사기에서 사용하는 대기렬은 매우 단순한 구조를 가지며 교환기와 여러 속성들을 공유한다. 그러나 대기렬은 그 속성들외에도 names(대기렬이름), duarable(생명주기), exclusive(배타성), auto-delete(자동삭제), arguments(인수)와 같은 많은 추가속성들을 가지고있다. ④ 수신자(Consumer) 대기렬에 들어있는 자료들은 수신자에 의해 수신 혹은 삭제된다. 실천에서는 기정 방법으로 자료수신응용프로그람들이 수신서명을 진행하는 자료수신방법과 특정한 경우 에만 리용하는 Polling방식자료수신방법을 사용한다. ２．대기렬봉사기를 리용한 환자자료교환방법 대기렬조종모형을 프로그람적으로 실현한것이 대기렬봉사기이다.  환자등록관리체계에서는 다중전송교환기(Topic Exchange)를 리용하여 림상과 간호 초소들사이에 자료교환을 진행한다. 그것을 위하여 매 과들과 간호초소들에 각각 하나의 대기렬을 대입하고 그것에 따르는 경로조종값(Routing Key)을 규정하여 자료교환을 실현 하였다. 자료교환흐름은 다음과 같다.(그림 5) 접수과에서 환자를 접수하면 봉사기는 접수하는 과의 id를 이름으로 가지는 대기렬 (Queue)과 이 대기렬이 결합되는 다중전송교환기를 생성하고 대기렬과 다중전송교환기를 유연한 대기렬조종모형에 기초한 실시간적인 환자자료교환의 한가지 방법 － 35 － 열쇠값(Routing Key)으로 결합한다. 환자 다중전송교환기 대기렬 해당 과, 간호초소 그림 5. 대기렬봉사기를 리용한 자료교환 다음 그 교환기와 열쇠값을 가지고 환자의 자료를 대기렬에 전송한다. amqpTemplate.convertAndSend(getExchange, outingKey, Message) 자료를 수신하려는 간호초소에서는 자기 과의 id를 이름으로 가지는 대기렬(Queue)에 대하여 리스너(Listenenr)를 동작시키고있다가 대기렬에 자료가 전송되는 즉시 그것을 수신(Consumer)하여 의뢰기에 소케트(socket)로 전송하여 실시간통신을 진행한다. 따라서 현재체계에 가입하고있는 해당 과의 의사 혹은 간호원들은 대기렬봉사기와 웨브소케트통신방식에 의하여 실시간적으로 환자자료를 교환하고 열람하게 되였다. 대기렬조종모형에 기초한 대기렬봉사기를 구성하여 환자자료교환을 실시간적으로 하 기 위한 방법을 제안하고 실현하였다. 맺 는 말 참 고 문 헌 [1] Brian E. Dixon; Health Information Exchange, Elsevier, 151～200, 2016. [2] William Liu et al.; JMIR Medical Informatics/JMIR Med. Inform., 6, 2, 1, 2018. [3] Raenu Kolandaisamy et al.; International Journal on Computer Science and Technology, 1, 47, 2015. 주체110(2021)년 5월 5일 원고접수 A Method of Real-Time Patient Data Exchange Based on the Flexible Queue Control Model Kim Kum Chol, Kim Hun In this paper, we propose a method of the real-time patient data exchange based on the flexible queue control model. Keywords: message queue server, patient data exchange