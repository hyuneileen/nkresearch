김일성종합대학학보 정보과학 주체110(2021)년 제67권  제3호 로보트축구경기체계에서 대역카메라의 교정에 대한 연구 백강혁, 림철민 위대한 령도자 동지께서는 다음과 같이 교시하시였다. 《여러가지 로보트를 개발하고 받아들이는데서 나서는 과학기술적문제도 풀어야 하겠 습니다.》(《선집》 증보판 제11권 138페지) 로보트축구경기체계에서 대역카메라화상의 이지러짐을 교정하는 문제는 화상처리의 정확도를 높이고 화상처리시간을 단축하는데서 중요한 의의를 가진다. 론문에서는 로보트축구경기장의 특징정보를 리용하여 대역카메라화상의 이지러짐을 교정하는 한가지 방법을 제안하고 실험을 통하여 제안한 방법의 효과성을 검증하였다. １．문 제 설 정 로보트축구[2]는 정해진 크기의 축구경기장에서 일정한 대수의 축구로보트들로 구성 된 두 팀이 상대팀의 꼴문에 공을 차넣는 지능적인 운동조종경기로서 다중에이젼트체계, 로보트조종, 수감기융합, 통신, 화상처리, 기계전자공학, 인공지능 등 여러 분야의 첨단기 술의 종합체이다. 로보트축구경기체계는 로보트장치부분체계, 화상처리부분체계, 결심채택부분체계, 무 선통신부분체계의 4개 부분체계들로 구성되여있다. 화상처리부분체계에서 해결하여야 하는 문제들로는 로보트색패턴의 설계, 카메라교정, 화상처리시간단축, 카메라지연보상 등을 들수 있다. 이중에서 카메라교정(camera calibration)문 제는 실자리표계에서의 3차원점들을 화상평면의 대응하는 2차원점으로 투영하는 변환관 계를 결정하는 문제로서 경기장에서의 로보트의 자세와 공의 위치를 정확히 추정하기 위 한 관건적인 문제의 하나이다. 그림 1에 로보트축구경기체계에서 리용하는 HIKVision카메라로 얻은 경기장화상을 보여주었다. 그림 1. 로보트축구경기체계에서 리용하는 HIKVision카메라로 얻은 경기장화상 － 68 － 종합대학학보 정보과학 주체110(2021)년 제67권 제3호 그림 1에서 알수 있는바와 같이 화상은 통형(barrel-shaped)의 이지러짐이 심하며 반 드시 교정을 하여야 한다. 카메라교정에서는 카메라의 외부 및 내부파라메터들을 결정해야 한다. 여기서 외부 파라메터는 카메라의 자세를 정의하는 파라메터이며 내부파라메터는 카메라광학체계에서 의 화상생성과정을 반영하는 파라메터이다.[1] 로보트축구에서 리용하는 대역카메라는 경기장의 천정에 고정되여있으며 경기장에 관한 상대적위치가 고정되므로 카메라교정에 경기장의 특징점들을 리용할수 있다. 이로부터 론문에서는 로보트축구경기장의 특징정보들을 리용하여 대역카메라의 교정 을 진행하는 한가지 방법을 제안하고 실험을 통하여 효과성을 검증하였다. ２．경기장의 특징정보를 리용한 카메라교정 １）카메라화상생성과정의 수학적모형화 카메라교정을 위하여 경기장자리표를 카메라에 의해 생성된 화상자리표에로 넘기는 변환관계를 얻는것이 필요하다.[3] 여기서 p는 경기장의 점 카메라의 외부 및 내부파라메터들이다. p ( π= c n wP 가 투영변환 π 에 의해 넘어가는 화상자리표, (cid:34)                            (1) P c , w 1 c 1, c(cid:34) 들은 n ) , , , 그림 2에 바늘구멍(pin-hole)카메라에 의한 원근투영(perspective projection)을 보여주었 wP 와 p 및 투영중심은 한 직선상에 놓이지만 이 다. 그림 2에서 이지러짐이 없으면 점 지러짐이 있음으로 하여 점 p는 다른 위치에 놓이게 된다. r yd 0r v p u 0c f xd c wz cx cy cz wx TR + wP wy 그림 2. 바늘구멍카메라에 의한 원근투영 대역자리표계(WCS: World Coordinate System)의 점 와 카메라자리표계(CCS: Camera Coordinate System)에서의 점 사이에는 다음의 관계식이 성립한다. P w = ( x w , y w , z w T ) P c = ( x c , y c , z c ) T x c y c z c 1 ⎛ ⎜ ⎜ ⎜ ⎜ ⎝ ⎞ ⎟ ⎟ ⎟ ⎟ ⎠ ⎛ = ⎜ ⎝ R T 0 1 ⎞ ⎟ ⎠ ⎛ ⎜ ⎜ ⎜ ⎜ ⎝ w x w y z w 1 ⎞ ⎟ ⎟ ⎟ ⎟ ⎠ P c = RP w +  또는 T (2) 여기서 T = t ( , x t y , t z 정의되는 회전행렬이다. 로보트축구경기체계에서 대역카메라의 교정에 대한 연구  = 는 병진벡토르이고 R R α β γ ) , 는 3개의 회전각 ( T ) , － 69 － ,α β γ 에 의해 , R ( ) α β γ , , = R z ( ) ) ) γ β α R ( ( R x y = R와 T의 6개 파라메터 ( , α β γ , , t x y z 들을 카메라의 외부파라메터 또는 카메라의 s s c s s s c s c c β γ α β γ α γ α β γ α γ ⎛ ⎜ c s c c β γ α β γ α γ α β γ α γ ⎜ ⎜ s β −⎝ t , + − c c α β − + s c α β c s c c s s s s s c ) t , ⎞ ⎟ ⎟ ⎟ ⎠ (3) 자세라고 한다. 넘기는것이다. 투영의 다음단계는 cP 를 화상평면자리표계(IPCS: Image Plane Coordinate System)에로 u ⎛ ⎞ ⎜ ⎟ v ⎝ ⎠ = f z c ⎛ ⎜ ⎝ x c y c ⎞ ⎟ ⎠ 또는 u ⎛ ⎞ ⎜ ⎟ v ⎜ ⎟ ⎜ ⎟ 1 ⎝ ⎠ = 1 z c 0 f 0 f 0 0 ⎛ ⎜ ⎜ ⎜ ⎝ T 0 0 0 0 1 0 ⎛ ⎞⎜ ⎟⎜ ⎟⎜ ⎟⎜ ⎠ ⎝ x c y c z c 1 ⎞ ⎟ ⎟ ⎟ ⎟ ⎠ (4) 여기서 화상이지러짐에 의하여 본래의 자리표 u v 가 외곡된 자리표 ( , ) u v(cid:4) ( , (cid:4) 로 넘어간다. ) T (cid:4) u ⎛ ⎞ ⎜ ⎟ (cid:4) v ⎝ ⎠ = 2 2 2 u ⎛ ⎞ ⎜ ⎟ v ⎝ ⎠ (5) u 1 4 ( κ 파라메터 κ 는 방사이지러짐의 크기로서 그 값이 정수이면 실패형(pincushion-shaped), + − + 1 v ) 부수이면 통형(barrel-type)의 이지러짐이 생긴다. 이 모형의 우점은 이지러짐교정이 다음과 같이 해석적으로 간단히 표시된다는것이다. u ⎛ ⎞ ⎜ ⎟ v ⎝ ⎠ = 1 2 (cid:4) ( u κ 1 + (cid:4) u ⎛ ⎞ ⎜ ⎟ (cid:4) v ⎝ ⎠ + (cid:4) v 2 ) (6) 최종적으로 점 u v(cid:4) ( , (cid:4) 는 화소자리표계(PCS: Pixel Coordinate System)의 점으로 넘어 ) T 간다. ⎛ ⎜ ⎜ ⎜ ⎜ ⎜ ⎝ yd 는 척도화인자로서 렌즈의 화소당 간격(pitch)이며 점 주점(principal point)인 동시에 방사이지러짐의 중심이다. 6개의 파라메터 c ⎛ ⎞ ⎜ ⎟ r ⎝ ⎠ 여기서 xd 와 ⎞ ⎟ ⎟ ⎟ ⎟ ⎟ ⎠ c 0 r 0 + = + (cid:4) u d x (cid:4) v d y 은 카메라의 내부파라메터이다. (7) ( c 0 , r 는 화상의 0 ) T ( f , , κ d , d , y x c 0 , r 0 ) 이렇게 투영변환관계가 밝혀진 조건에서 카메라교정은 카메라의 내부 및 외부파라메 f 들을 모두 결정하는 문제에 귀착된다. , α β γ , ( , κ d d ) ) t t t , , , , , , , , x y c 0 r 0 x y z 터 ( ２）경기장의 특징점들을 리용한 카메라교정 로보트축구경기장의 규격이 정해져있으며 대역카메라와 경기장의 상대적위치가 고정 된 조건에서 그림 3과 같이 31개 특징점들의 경기장자리표를 결정할수 있다. 이 특징점들의 경기장에서의 자리표를 ,2,1 (cid:34) )31, , 화상에서 대응하는 점들의 =iiP ( － 70 － 종합대학학보 정보과학 주체110(2021)년 제67권 제3호 자리표를 =iip ( ,2,1 (cid:34) )31, 라고 하면 카메라교정문제는 다음의 최량화문제에 귀착된다. f ∑c ( ) = 31 i 1 = p i − ( π , P c i ) 2 → min (8) 여기서 c 는 카메라의 외부 및 내부파라메터들로 이루어진 벡토르이다. 이 최량화문제는 화상처리전용서고 OpenCV의 전용함수[4]를 리용하거나 Matlab의 Computer Vision System도구함의 cameraCalibrator함수[5]를 리용하여 수값적으로 풀수 있다. 그림 3. 카메라교정에 리용되는 31개 특징점들의 경기장자리표 ３．결 과 분 석 Matlab의 cameraCalibrator함수를 리용하여 얻은 대역카메라의 외부 및 내부파라메터 들은 다음과 같다. t = 120.59cm, t y = 89.32cm, t z x = 276.56cm, α = 1.306 10 rad, × β = − 1.445 10 rad, × γ = − 1.130 10 rad, × 2 − 2 − f = 4.00 1 10 cm, × κ = − 0.336 3, d x = 1.275 7 10 cm, × d = 1.268 3 10 cm, × y c 0 = 640.2, r 0 = 359.6 3 − − 2 3 − 3 − 이때의 대역카메라의 교정결과를 그림 4에 보여주었다.  그림 4에서 《o》로 표시한것은 특징점들의 실제경기장에서의 자리표이고 《*》로 표시 한것은 화상에서 얻은 특징점들의 자리표를 거꿀투영변환하여 경기장자리표계로 넘긴 점 들의 자리표이다. 그림 4로부터 카메라교정결과 경기장의 특징점들을 비교적 정확하게 측정한다는것을 카메라교정이후 경기장자리표의 추정정밀도는 0.5cm미만이다. 알수 있다. 로보트축구경기체계에서 대역카메라의 교정에 대한 연구 － 71 － 180 150 120 90 60 30 0 0 20 60 120 180 220 240 그림 4. 대역카메라의 교정결과 운동장의 특징정보를 리용한 카메라교정방법을 제안하고 제안된 방법에 의한 카메라 교정을 진행하여 그 효과성을 검증하였다. 맺 는 말 참 고 문 헌 [1] 최춘화, 현수철; 콤퓨터시각기하, 종합대학출판사, 142～190, 주체99(2010). [2] S. Nadarajah, K. Sundaraj; Artificial Intelligence Review, 40, 271, 2013. [3] J. Beyerer et al.; Machine Vision-Automated Visual Inspection: Theory, Practice and Applications, Springer, 99～106, 2015. [4] K. Dawson-Howe; A Practical Introduction to Computer Vision with OpenCV, Wiley, 71～82, 2014.  [5] P. Corke; Robotics, Vision and Control: Fundamental Algorithms in Matlab, Springer, 613～639, 2017． 주체110(2021)년 5월 5일 원고접수 A Study on the Calibration of the Global Camera in the Robot Soccer Game System Paek Kang Hyok, Rim Chol Min The global camera calibration in the robot soccer game system has critical importance in the image processing process. In this paper, we propose a camera calibration approach by using the characteristic information of the playground. Keywords: robot soccer, camera calibration