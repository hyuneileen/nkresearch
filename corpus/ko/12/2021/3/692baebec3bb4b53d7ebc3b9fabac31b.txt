김일성종합대학학보 정보과학 주체110(2021)년 제67권  제3호 ２중발성환경에서 결합상관곁수를 리용한 음향반향제거 리철의, 엄철남 경애하는 동지께서는 다음과 같이 말씀하시였다. 《과학기술이 급속히 발전하고 그 갱신주기가 짧아지고있는 오늘의 현실적요구에 맞 게 최신과학기술을 더 빨리 체득하고 그에 정통하기 위하여 피타게 노력하여야 합니다.》 화상회의체계에서 반향을 제거하는 문제는 회의에서 송수신되는 음성의 질을 보장 하기 위한 중요한 요구로 나선다. 론문에서는 근단음성과 원단음성이 동시에 존재하는 2중발성환경에서 반향을 효과적 으로 제거하기 위한 한가지 방법을 제안하였다. １．문 제 설 정 통신기술이 급속히 발전하면서 화상회의체계와 같은 음성통신체계들에서 음질을 보다 높이는 문제가 중요하게 제기되고있지만 회의과정에 발생하는 반향을 제거하고 음질을 보장하는것은 결코 쉬운 문제가 아니다. 이로부터 통신체계들에서는 효과적인 반향 제거기술을 필수적으로 요구하고있다. 그림 1에 반향제거체계의 구성도[1, 2]를 보여주었다. )(nx )(ˆ nw )(nw )(ˆ ny )(ny - + )(ne )(nd + + )(nv 그림 1. 반향제거체계의 구성도 그림 1에서 원단신호 )(nv 은 마이크로부터 가까운 거리에 위치한 근단발성자로부터 발성되는 목적하는 신호이다. (근단신호) )(nw 을 통과하면서 반향 )(ny 을 만든다. )(nx 은 경로 두 신호 )(ny 과 )(nv 의 합신호 )(nd 에 포함되여있는 반향신호 )(nd 은 마이크의 입력신호로 된다. 반향제거방법의 )(nv 을 )(ny 을 제거하여 근단신호 목적은 이 합신호 얻는것이다. 반향제거에 리용되는 적응려파기는 반향이 생기는 경로 )(ˆ nw 을 근사적으로 모형화 )(ne 을 하는 기능을 수행하며 계산한다. 이 오차신호에는 나머지반향신호와 함께 근단신호도 포함되게 되며 이 값은 )(nd 에서 이 적응려파기의 출력 )(ˆ ny 을 덜어 오차신호 2중발성환경에서 결합상관곁수를 리용한 음향반향제거 － 57 － 려파기곁수들을 갱신하는데 리용된다. =nv 0)( 근단발성자가 없을 때 즉 일 때에는 적응려파기가 수렴하게 되며 반향이 발생하는 경로를 정확히 추정하여 반향을 충분히 제거할수 있다. 그러나 근단신호와 원단 신호가 동시에 반향제거체계에 입력되는 경우 근단신호 )(nv 은 적응려파기에 비상관성 잡음신호로 작용하여 적응려파기가 발산하게 만든다. 따라서 근단신호의 존재를 효과적으로 검출하는것은 반향제거에서 실지 중요한 역할을 한다. 이 문제를 2중발성검출(DTD: Double-Talk Detection)문제[1]라고 한다. 화상회의에서 반향신호를 효과적으로 제거하자면 2중발성검출기술과 적응반향제거 기술을 효과적으로 결합하여 리용하여야 한다. 2중발성검출방법들에는 근단신호와 원단신호사이의 진폭비교를 리용하는 게이겔 (Geigel)방법과 신호포락에 기초한 방법, 간섭성에 기초한 방법 등이 있다. 가장 일반적인 게이겔 2중발성검출방법에서는 원단신호 )(nx 에서 길이가 L 인 신호의 최대값과 마이크입력신호 )(nd 사이의 진폭준위비교를 진행한다. 결정변수는 다음과 같다. max{ ,)( nx ( nx − ,)1 (cid:34) , ( Lnx +− })1 ξ )( nG = )( nd (1) 2중발성상태는 T G 추가적인 잡음에 민감하며 반향준위는 대체로 6dB이하이다. 일 때 나타난다. 여기서 n <)(ξ G GT 는 턱값이다. 게이겔방법은 론문에서는 분할블로크주파수령역적응려파알고리듬과 개선된 2중발성검출알고리듬을 제안하였다. 여기서는 결합상관곁수를 받아들여 당시의 음성상태 즉 2중발성환경인가 아닌가를 판단하고 주파수령역에서의 적응려파처리를 진행함으로써 2중발성환경에서 반향 제거알고리듬의 성능을 향상시켰다. ２．분할블로크주파수령역적응려파 음성통신체계들에서 반향제거의 성능을 높이자면 반향 특히 지연이 긴 반향신호를 제거하여야 한다. 그러나 이미 나온 최소평균두제곱(LMS: Least Mean Square)적응려파알고리듬은 그 계산량이 려파기길이에 비례하고 수렴속도가 느린 결함이 있다. 이로부터 론문에서는 분할블로크주파수령역적응려파알고리듬을 적용하여 지연이 긴 반향신호를 제거하였다. 분할블로크주파수령역적응려파방법에서는 입력신호를 블로크단위로 고속푸리에변환 하여 주파수령역에서 처리하므로 계산량이 보다 적으면서도 잘 수렴하게 된다. [알고리듬 １] 분할블로크주파수령역적응려파알고리듬 입력: 원단신호 )(nx 출력: 려파곁수 Wˆ  걸음 １ 임의로 초기화한 N 차원려파기 , 마이크입력신호 )(nd 나눈다. 즉 매 부분은 P 개의 려파기곁수들을 포함한다. 0w 을 시간령역에서 PN / 개의 부분으로 w 0 i = [ iPw ( 0 ,) (cid:34) , iw (( 0 + )1 P − T ,])1 i = ,1,0 (cid:34) , − 1 (2) N P 다음 매 i0w 에 령채우기를 진행하여 차원수를 PMM ≥ 으로 만든 다음 고속푸리 ) ( － 58 － 종합대학학보 정보과학 주체110(2021)년 제67권 제3호  에변환을 리용하여 주파수령역에로 변환한다. W F = i 0 ⎡ ⎢ ⎣ 0 w 0 i − PM ⎤ ⎥ ⎦ (3) 여기서 F 는 M 차고속푸리에변환(FFT)행렬을 나타낸다. 걸음 ２ 시간령역의 원단신호 )(nx 을 길이가 L 인 블로크단위로 토막화한다. , mx 여기서 m 은 블로크번호, 파라메터 L 은 블로크길이이다. mLx ([ mx (( )]1 )1 (cid:34) ), L − + = , T m = ,2,1,0 (cid:34) (4) 걸음 ３ 블로크신호 mx 을 포함하여 앞서 입력된 N개 점에 해당한 원단신호를 M개 단위로 분할하고 매 부분들을 고속푸리에변환에 의하여 주파수령역으로 변환한다. + [( mx )1 − − X mi = diag ⎧ ⎪ F ⎨ ⎪ ⎩ ⎡ ⎢ ⎢ ⎢ ⎣ MiPL (cid:35) ] ⎤ ⎥ ⎥ ⎥ ⎦ ⎫ ⎪ , ⎬ ⎪ ⎭ [( mx + )1 iPL − − ]1 i = ,1,0 (cid:34) , − 1 (5) N P 걸음 ４ 주파수령역에서 려파기를 적용한 후 매 토막의 결과신호들을 모두 더하여 합신호를 계산한다. 다음 합신호에 거꿀푸리에변환을 적용하여 신호 (ˆ my 을 추정한다. 이때 선형중첩연 산의 결과에서 뒤로부터 L 개의 점들에 해당한 신호가 원단신호의 m 번째 블로크신호속 에 들어있는 반향신호 myˆ 으로 된다. ) ˆ y m = 0 ⎛ ⎜⎜ ⎝ LM − 0 − 1 0 I ⎞ ⎟⎟ F ⎠ PN / ∑ i = 0 − 1 H XW mi mi (6) L 여기서 웃첨수 H 는 에르미트연산자이다. 걸음 ５ myˆ 을 마이크입력신호 d ([ = d m me 을 얻는다. mL + ),1 (cid:34) , Lmd ( ( T)]1)1 −+ 에서 덜어 오차신호 ˆ− y 걸음 ６ 주파수령역에서 려파기갱신의 걸음값을 계산하고 오차신호 me 에 따라 적응 (7) = d e m m m 려파기곁수들을 갱신한다. ˆ W 1 im + ˆ W = mi + G FF 1 − Π m H EX mi , im = ,1,0 (cid:34) , − 1 (8) N P Π m = 1 − T XX mi ⎛ ⎜ μ ⎜ ⎝ PN / ∑ i = 0 + I γ M mi , E m = F 0 ⎡ ⎢ ⎣ LM − e m ⎤ ⎥ ⎦ , G = I P 0 ⎡ ⎢ ⎣ 0 0 PM − ⎤ ⎥ ⎦ (9) 1 − ⎞ ⎟ ⎟ ⎠ 여기서 μ는 려파기의 수렴속도와 안정성에 영향을 주는 걸음크기파라메터이며 γ 는 자 료넘침을 피하기 위하여 첨부한 매우 작은 상수이다. ３．결합상관곁수에 기초한 반향제거 화상회의체계에서는 2중발성검출기술을 리용하여 당시의 음성상태를 검출하고 근단 음성이 있는 구간에서는 려파기의 갱신을 중지하는 방법으로 반향제거를 위한 적응려파 기의 수렴성을 담보한다.[1] 론문에서는 신호들사이의 상관곁수를 리용하여 단일발성과 2중발성상태를 식별하는 2중발성환경에서 결합상관곁수를 리용한 음향반향제거 － 59 － 한가지 방법을 제안하였다. 2중발성검출알고리듬에서는 분할블로크주파수령역적응려파기의 출력을 리용하여 주 파수령역에서 원단블로크신호, 근단블로크신호와 오차블로크신호사이의 교차상관값으로 부터 결합상관곁수를 계산한다. 이 곁수는 당시의 음성상태를 표현하며 오차신호를 평활 화하는 파라메터로 적용되여 최종출력신호를 얻는다. [알고리듬 ２] 결합상관곁수에 기초한 반향제거알고리듬 입력: 근단블로크신호 md , 원단블로크신호 출력: 반향이 제거된 mef 걸음 １ 근단블로크신호 md , 원단블로크신호 mx 트르밀도를 각각 계산하고 평활화를 진행한다. mx 과 오차블로크신호 me 의 전력스펙 d S m x S m e S m ⎧ ⎪ ⎨ ⎪ ⎩ = = = d S λ m x S λ m e S λ m 1 − 1 − 1 − 1( −+ 1( −+ 1( −+ ) λ ) λ d x ) λ e H m H m H m ⋅ ⋅ d m x m ⋅ e m (10) 여기서 d mS , x mS 과 걸음 ２ 원단블로크신호 e mS 은 각각 전력스펙트르밀도이고 λ는 평활화곁수이다. mx 과 근단블로크신호 md 의 호상전력스펙트르밀도 xd mS 와 mS 를 각각 계산한다. ed 오차블로크신호 me 과 근단블로크신호 md 의 호상전력스펙트르밀도 xd m ed m * = = S λ S λ xd x ⎧ S ⋅ ⎪ 1 m m − ⎨ ed e ⎪⎩ S ⋅ 1 m m − mx 과 근단블로크신호 1( −+ 1( −+ 걸음 ３ 원단블로크신호 (11) (m ) , 오차블로 ) ( ( S S ) * ) ) λ ) λ d S m d S m md 의 상관곁수 Cohxd Cohed 을 각각 계산한다.  (m xd m x S m ed S m e S m xd m d ) m ed ) m d * m S S ( ( ) * ⋅ ⋅ S S ) ( ( * * ⋅ ⋅ ⎧ Coh ⎪ ⎪ ⎨ ⎪ ⎪ ⎩ Coh ( m ) = xd ( m ) = ed (12) 크신호 me 과 근단블로크신호 md 의 상관곁수 S Cohed 중에서 최소값을 결합상관곁수 CohP 로 선택한다. 이 걸음 ４ 여기서 *은 공액복소수를 표시한다. (m Cohxd 과 곁수는 현재음성상태의 검출정확도를 최대화한다. ( 1min( Coh m m − 1 = − ( ) ( ) ) P Coh 걸음 ５ 제거함수를 다음과 같이 얻는다. Pm ) = (mβ 은 제거정도를 나타내는 곁수이다. Supp ) ( 여기서 m ), Coh ed xd ( m )) (13) Coh m ( m ) () β (14) 걸음 ６ 오차블로크신호 me 에 제거함수 Supp 을 적용하여 최종출력신호벡토르 (m ) mef 을 얻는다. Supp 이상의 과정으로부터 제거함수는 결합상관곁수 CohP 에 의존하며 이 곁수값은 각이 한 음성상태에서 오차신호의 제거정도를 특징짓는다는것을 알수 있다. 즉 원단발성자와 근단발성자가 동시에 말할 때 즉 2중발성환경에서는 제거정도를 줄여 될수록 근단신호들 (15) m = me (m ef ) － 60 － 종합대학학보 정보과학 주체110(2021)년 제67권 제3호  을 유지하며 근단발성자가 말을 안할 때에는 제거정도를 크게 하여 환경에 존재하는 반 향신호들을 가능한껏 제거한다. ４．실험 및 결과분석 제안된 알고리듬의 성능을 평가하기 위하여 Matlab를 리용하여 모의실험을 진행하 실험에 리용된 시험자료는 조선어음성화일로서 표본화주파수는 16kHz이고 음성지속 였다. 시간은 약 45s이다. 음성신호들의 시간령역에서의 파형을 그림 2에 보여주었다. 1 1 2 2 3 3 5 6 7 5 6 7 4 시간/s ㄱ) 4 시간/s ㄴ) 4 시간/s ㄷ) 1 2 3 5 6 7 ㄱ) 근단신호 )(nv , ㄴ) 마이크입력신호 )(nd , ㄷ) 반향이 제거된 최종출력신호 )(nef 그림 2. 음성신호들의 시간령역에서의 파형 그림 2의 ㄴ)에서 굵은 선은 가까운 근단신호를 표시하는 검출변수를 나타내므로 그 것을 마이크입력신호에 중첩하여 표시한다. 그림 2로부터 개선된 알고리듬이 마이크입력신호에서 근단신호를 잘 보존하면서도 그속에 섞여있는 반향신호를 충분히 제거한다는것을 알수 있다. 다음으로 주관적인 음질평가를 진행하였는데 그 결과는 2중발성환경에서 반향제거체 계의 출력신호가 끊기거나 단어손실이 없이 음질이 개선된다는것을 보여준다. 반향제거알고리듬의 성능을 평가하기 위하여 이전의 NLMS, FLMS방법[1, 2]들과 제 안된 알고리듬을 비교하였다. 불일치도[2]는 다음과 같이 정의된다. / z H 폭 진 / z H 폭 진 -1 0 1 0 1 0 -1 0 1 0 / z H 폭 진 -1 0 2중발성환경에서 결합상관곁수를 리용한 음향반향제거 － 61 － MIS ( dB ) = 10 log 10 (16) w ( m ) − ) (ˆ w m 2 w ( m ) 2 ⎤ ⎥ ⎥ ⎦ ⎡ ⎢ ⎢ ⎣ ) 여기서 (ˆ mw 은 추정된 적응려파기이며 ) (mw 은 실지반향경로이다. 2중발성검출알고리듬으로서 가장 일반적으로 리용되는 게이겔알고리듬과 제안된 결 합상관곁수에 기초한 2중발성검출알고리듬을 비교하였다.(그림 3) 비교를 진행하기 위하 여 적응려파기의 반복수를 40 000으로 설정하고 15 000～20 000개의 표본을 가지는 3개의 음성신호자료를 리용하였다. 마이크입력신호 근단음성신호 DTD를 리용하지 않은 경우 게이겔방법 제안된 2중발성검출방법 50dB 0.5 15dB 2.5 1 1.5 2 반복수/번 3 3.5 4 그림 3. 게이겔알고리듬과 제안된 결합상관곁수에 기초한 2중발성검출알고리듬의 성능비교 그림 3을 통하여 제안된 결합상관곁수에 기초한 2중발성검출알고리듬을 리용한 반향 제거성능이 2중발성검출기를 리용하지 않거나 게이겔알고리듬을 리용할 때보다 불일치도 값이 훨씬 작으면서 수렴속도가 빠르다는것을 알수 있다. 분할블로크주파수령역적응려파알고리듬과 제안된 결합상관곁수에 기초한 2중발성검 출알고리듬을 리용하여 음향반향제거체계를 구성하였으며 제안된 방법이 2중발성환경에 서 음향반향을 효과적으로 제거하면서 높은 음질을 보장한다는것을 검증하였다. 맺 는 말 참 고 문 헌 [1] M. Fukui et al.; IEEE Transactions on Consumer Electronics, 60, 3, 468, 2014. [2] Y. Huang et al.; IEEE International Conference on Acoustics, Speech and Signal Processing, 596, 주체110(2021)년 5월 5일 원고접수 2 0 -2 -4 -6 -8 B d / 도 치 일 불 -10 -12 -14 -16 0 2017. － 62 － 종합대학학보 정보과학 주체110(2021)년 제67권 제3호   Acoustic Echo Cancellation Using Joint Correlation Coefficient in Double-Talk Situation Ri Chol Ui, Om Chol Nam In this paper, an improved double-talk detector algorithm is proposed to promote the performance of echo cancellation in the presence of speech issued from near-end speaker in video conference system. Keywords: acoustic echo cancellation, double-talk detection