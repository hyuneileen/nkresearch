김일성종합대학학보 수 학 주체110(2021)년 제67권 제2호 심층밀집신경망을 리용한 페장X-ray화상의  한가지 질병증후분석방법 리철영, 최일수 위대한 령도자 동지께서는 다음과 같이 교시하시였다. 《과학과 기술이 매우 빨리 발전하고있는 오늘의 현실은 기초과학을 발전시킬것 을 더욱 절실하게 요구하고있습니다.》(《선집》 증보판 제11권 138페지) 론문에서는 한가지 대표적인 심층신경망인 밀집신경망(DenseNet)의 구조를 변형하여 질병증후의 위치정보를 보존하는 새로운 망을 구성하고 그것을 리용한 한가지 질병증후 분석방법을 제기하고 실험을 통하여 효과성을 검증하였다. 선행연구[1]에서는 대표적인 페장X-ray화상자료모임 ChestX-ray14에서 AlexNet, GoogleNet, VGGNet, ResNet를 학습시킨 결과 ResNet-50에서 가장 높은 0.738의 AUROC값 을 얻어냈으며 심층신경망이 페장X-ray화상질병증후분석에서 비교적 높은 성능을 낸다는 것을 실험적으로 론증하였다. 선행연구[2]에서는 페장X-ray화상처리를 위한 심층신경망으로 한가지 밀집신경망인 DenseNet-121을 리용하였으며 질병증후표식사이의 상관을 추출하는 순환신경망을 제안하 였다. 론문에서는 일반적인 천연색화상분류에 리용하는 DenseNet-121을 흑백색화상을 분 류하도록 간소화하였다. 론문에서는 이 두가지 망을 결합하여 페장X-ray화상의 질병증후 진단을 진행함으로써 0.802의 AUROC값을 얻었다. 선행연구[3]에서는 흑백화상인 페장X-ray화상을 RGB화상으로 변환하여 DenseNet- 121[4]을 리용한 전이학습(transfer learning)을 진행하고 ChestX-ray14자료모임에서 실험을 진행하였다. 선행한 방법들에서는 심층신경망을 리용하여 추출되는 7×7크기의 특성지도들에 전 역평균선택연산을 진행하고 질병증후의 가지수에 따르는 전결합층을 리용하여 출력벡토 르를 얻어낸다. 하지만 이 방법은 질병증후분석과 같이 분류대상의 위치가 분산되여있는 경우에는 오히려 분류성능에 영향을 주게 된다. 론문에서는 밀집신경망 DenseNet-121[4]에서 전결합층대신 합성적층을 리용하여 합성 적층으로만 이루어진 망으로 구조를 변경함으로써 질병증후의 위치정보를 보존하는 모형 을 제안하고 실험을 통하여 그 효과성을 검증하였다. 밀집신경망은 여러개의 중첩층들이 밀집련결되여있는 4개의 밀집블로크들을 통과하 여 얻은 특성지도들을 리용하여 화상의 분류를 진행한다. 일반적으로 모형의 입력화상은 224×224화소크기의 RGB화상이다. 페장X-ray화상은 8bit흑백화상이다. 론문에서는 DenseNet-121을 리용한 전이학습을 위 하여 페장X-ray화상을 RGB화상으로 변환하고 훈련을 위한 화상전처리를 진행한다. ① 우선 화상을 256×256화소크기로 척도변환을 진행하고 RGB화상으로 화상을 변환 하고 색정규화를 진행한다.[3] ② 또한 다음의 자료증식을 리용한다. ㄱ) 따내기 － 42 － 종합대학학보 수학 주체110(2021)년 제67권 제2호 f crop : x jsi , + + t ′ x i , , j i , j = ,1 ts , n { ∈∈ N 0| n ≤≤ }32 a × 256 256 : X ∈ R j , ′ x i , j : X ∈′ R 224 × 224 ,224 x , i ㄴ) 수평뒤집기 j − 론문에서는 밀집신경망에서 특징추출부분을 동결시킨 후 새롭게 제안한 합성적층을 224 flip − h j , f : x i ′ x i , a , i , j = ,1 224 5~10세대만큼 훈련시킨 후 동결을 해제하고 전체 모형에 대한 훈련을 진행한다. 이때 마지막 합성적층은 다음과 같은 평균과 표준편차를 가지는 정규분포에 따르는 우연량으로 초기화를 진행한다. inn 은 층의 입력련결개수, outn 는 층의 출력련결개수이다. ,0 = σ n + in n out /(2 μ = ) 적층 (2)(그림)를 리용하여 질병증후분석을 진행하였다. ① 1×1합성적층 론문에서는 다음으로 종전의 밀집신경망의 전결합층을 리용한 분류대신 다음의 합성 con v : y 11 × i , kj , = , ′ lkj , , ′ × w ′ kk , , k = 1,1 024 1 024 x i ∑ k =′ 1 3 × 224 × 224 입력화상 전면페장 ⇒ 분석화상추출 ⇒ ⇒ 합성적층 ⇒ 특성지도 ⇒ (1) 1 024 × 1 024 X − ray 화상 ⇒ ⇒ ⇒ 합성적층 ⇒ (2) ⇒ 선택층 ⇒ 밀집블로크 1 024 ×× 77 (1, 2, 3, 4) 특성지도 14 ×× 77 특성지도 ⇒ 특성벡토르 ⇒ 시그모이드층 ⇒ 결과예측벡토르 그림. 론문에서 제안한 모형 ② 3×3합성적층 v con : y 33 × i , kj , = l −+ ,2 mj −+ ,2 k ′ kkml , , , ′ × w , k = 14,1 3 3 1 ∑∑ ∑ l m k 1 = 1 = =′ 1 024 x i x 는 입력, y 는 출력, w 는 무게행렬, 의 원소, iy , 는 출력의 k 번째 특성지도의 i 행 j 렬의 원소, kj , 특성지도에서 출력의 k 번째 특성지도에로의 합성적층무게의 l 행 m 렬의 원소이다. 여기서 선택층으로는 다음과 같은 전역최대선택층을 리용하였다. ix , 는 입력의 k 번째 특성지도의 i 행 j 렬 kj , 입력의 k′ 번째 ′ 는 kkmlw , , , 질병증후의 예측확률은 다음의 시그모이드함수에 의해 계산된다. GMP : y k = max j , i x i , , kj i σ) )( p ( = x ) = k 1 exp( 1 + − x k ) , k = 14,1 그리고 출력이 매 질병증후에 대해 그것이 존재하는가 안하는가 하는 2진분류문제이 므로 오차함수로는 2진교차엔트로피를 쓴다.[3] 심층밀집신경망을 리용한 페장X-ray화상의 한가지 질병증후분석방법 － 43 － J )( θ −= )( i [ y log( )( i ) p ) 1( −+ y ) log( 1 − )( i )( i ) p )] 1 m m ∑ i 1 = 경사하강법을 리용하여 학습을 진행한다. 화상분류문제에서는 일반적으로 분류를 진행할 대상의 위치를 정확하게 얻는것이 중 요하게 제기되지 않는다. 그러나 론문에서 연구를 진행한 X-ray화상의 질병증후분석에서 는 매 질병증후의 존재성과 함께 해당 위치를 얻는것도 중요한 문제로 제기된다. 일반적인 화상분류문제와 다르게 페장X-ray화상에서의 질병증후분석문제에서는 1개 의 화상에 여러가지의 질병증후들이 동시에 나타나게 된다. 또한 질병증후의 위치가 흩어져있으며 위치정보가 질병증후분석에 중요한 작용을 한 다. 그러므로 일반적인 화상분류문제의 분류기를 리용하면 페장X-ray화상의 특징추출과 정에 얻어진 위치정보의 손실을 가져오게 되며 이것은 질병증후분석에 영향을 주게 된다. 론문에서는 전결합층을 리용하지 않고 2개의 중첩층과 최대선택층을 리용하여 페장 X-ray화상에서 질병증후의 위치정보를 보존하면서 질병증후분석을 진행하고 실험을 통하 여 효과성을 검증한다. 페장X-ray화상자료모임 ChestX-ray14[1]는 3만여명의 서로 다른 환자들의 페장X-ray화 상 11만 2천여장으로 구성되여있다. 이 자료모임에서 표식자료는 화상에 따르는 전자병 력서의 설명문에 대한 자연언어처리과정을 통하여 그 정확도와 재현률이 약 90%로서 F1 점수가 0.9이다. ChestX-ray14자료모임에서의 성능평가를 표 1에 보여준다. 표 １．ChestX-ray14자료모임에서의 성능평가 훈련화상수 검증화상수 모형 선행연구[1]의 모형 선행연구[2]의 모형 선행연구[3]의 모형 제안한 모형 78 468 78 468 78 468 78 468 33 652 33 652 33 652 33 652 평균AUROC 0.738 0.802 0.840 0.848 여기서 평가지표는 매 질병에 따르는 AUROC(Area Under Receiver Operating Characteristic 수신기응답특성곡선의 아래면적)의 평균이다. 이 자료모임과 또 다른 페장X-ray화상자료 모임인 mimic-cxr의 화상들을 합쳐 새로운 자료모임을 구성한다. 이 자료모임의 표식자료 는 전문가들이 진행한 진단에 기초하고있다. 새 자료모임은 정확도가 97%, 재현률이 95%로서 F1점수가 0.96이며 이 자료모임에서도 성능평가를 진행하였다.(표 2) 표 ２．새로 구축한 자료모임에서의 성능평가 훈련화상수 검증화상수 모형 선행연구[3]의 모형 124 273 론문에서 제안한 모형 124 273 54 857 54 857 평균AUROC 0.874 0.887 F1점수 0.402 0.452 새 자료모임에는 62 827명의 환자의 179 130장의 페장X-ray화상을 포함하고있다. 자료모임을 훈련자료 70%, 검증자료 30%로 가르고 훈련 및 검증을 진행한다. 훈련 자료와 검증자료사이에서 환자는 중복되지 않는다. 훈련은 묶음크기는 64개, 전체 반복회수는 100세대로 설정하고 진행하였다. 최량화알 고리듬으로는 적응적모멘트최량화알고리듬(Adam Optimizer)을 리용하였으며 이동평균파라 310− 으 메터는 각각 0.9, 0.999로, 무게감쇠파라메터는 로 정하고 5세대의 훈련동안에 검증자료에서의 손실이 감소하지 않으면 학습률을 1/10로 줄 510− 으로 설정한다. 초기학습률은 － 44 － 종합대학학보 수학 주체110(2021)년 제67권 제2호 표 1, 2로부터 론문에서 제안한 모형이 두가지 평가지표에서 더 좋은 성능을 가진다 이도록 설정하였다. 는것을 알수 있다. 참 고 문 헌 [1] X. Wang et al.; arXiv:1705.02315, 2017. [2] Y. Li et al.; arXiv:1710.10501, 2017. [3] P. Rajpurkar et al.; arXiv:1711.05225, 2017. [4] H. Gao et al.; arXiv:2001.02394, 2020. 주체109(2020)년 12월 5일 원고접수 A Method of Diagnosing Diseases Syndrome on Chest X-ray Images  Using Deep Dense Neural Network Ri Chol Yong, Choe Il Su In this paper, we propose a method of diagnosing diseases on Chest X-ray images using Deep Dense Neural Network and illustrate it through experiments. The results demonstrate that our method is efficient.  Keyword: dense neural network