김일성종합대학학보 수 학 주체108(2019)년 제65권 제4호 Phong모형에서 개선된 쌍방향반사률함수에 의한 영상생성의 한가지 방법 리정로, 한성 경애하는 최고령도자 동지께서는 다음과 같이 말씀하시였다. 《첨단돌파전을 힘있게 벌려야 나라의 과학기술전반을 빨리 발전시키고 지식경제의 토대를 구축해나갈수 있습니다.》 3차원영상생성은 과학, 기술, 의학, 교육, 예술, 모의훈련과 같은 여러 분야에 광범히 리용되고있으며 특히 가상현실, 오락제작분야에서 많이 리용되고있다. 3차원영상생성은 오락제작분야에서 처음으로 출현하였다. 초기의 3차원오락에서는 렌더링에 중심을 두고 빠른 속도로 3차원화면을 생성하였으 며 현시기 보다 현실에 가까운 내용을 가진 오락들이 출현하였다. 이와 관련하여 물리모형에 기초한 엔진에 대한 요구가 개발자들에게 제기되였으 며 현실과 류사하게 표현할수 있는 엔진을 개발하기 위한 연구가 심화되였다. 이 과 정에 많은 성과가 이룩되여 엔진개발은 대체로 두가지 방향 즉 현실과 류사한 영상을 얻어내는것과 현실에 구애되지 않는 보다 자유로운 영상을 얻어내는 방향으로 발전하 였다. 최근시기에는 물리모형에 기초하여 영상의 품질과 속도를 개선하기 위한 연구가 활 발히 진행되고있다. 대표적인 물리모형에 기초한 엔진들로서는 pbrt, render man, mitsuba, lux render, Arnold 등이 있다. 물리모형에 기초한 엔진이라고 할 때에는 물리현상들과 물리법칙에 따라 움직 이고 표현되는 물체들을 생성해내는 엔진이다. 실례로 바람이 불 때 바람의 방향과 속도 에 따라 나무가지나 머리칼이 흩날리는 세기와 방향을 조절하고 뽈을 찰 때 어느 방향으 로 어떤 힘으로 어떤 회전방향으로 찼는가에 따라 그 세기와 방향, 회전을 정확히 표현할 수 있는것 등을 들수 있다. 광원, 면, 관찰자가 주어졌을 때 반사빛의 흐 름에 대하여 고찰하자. 반사빛의 복사세기는 광원의 복사비침도와 크기, 면의 반사능력과 재질적특성에 의해 결정 되는데 면의 점 x 에서의 광원방향, 관찰자방향, 법선방향은 그림과 같다. 그림．면의 점 x 에서의 광원방향, 관찰자방향, 법선방향 그림에서 L 은 점 x 에서 점광원쪽으로 향하 는 단위벡토르, V 는 점 x 에서 관찰자의 눈으로 향하는 단위벡토르, R 는 점 x 에서의 리상적인 거울반사방향의 단위벡토르, N 은 점 x 에서의 면의 법선벡토르, H 는 L 과 V 사이의 중 간단위벡토르, β는 L 과 V 사이의 각, φ는 R 와 V 사이의 각이다. Phong모형에서 개선된 쌍방향반사률함수에 의한 영상생성의 한가지 방법 － 93 － 3차원렌더링에서는 렌더링방정식[1] ∫ V =→ V +→ ( xL e ( xL ) ) f r Ω x ,( Lx → () xLV ← L ) cos( dLN ω) L , 을 풀어야 한다. 그런데 이 방정식을 해석적으로 계산하는것은 불가능한 일이므로 몽떼－ 까를로적분을 써서 다음과 같이 계산한다.[1] f ,( Lx , LN cos( → L ) ) xL ( V =→ ) xL ( e V +→ ) r 1 n ∑ i () xLV ( p ω i ← ) 여기서 ) ( xLe → 는 면의 점 x 에서 V 방향으로 방출되는 빛흐름을 나타낸다. V V xL → 는 V 방향으로 향하는 빛흐름을 나타내고 V ) ( 총적으로 V L xE ← 는 점 x 에서 L 방향에서 입사하는 빛에 대한 비침도이다. ( xdL dE ( x V =→ → ← ω) L ,( Lx ( xL ← ) ) L = ) ) ( f r ) → 는 쌍방향 f r Lx ,( ( ) xdL V → cos( dLN ) L , 과 같이 반사률함수(BRDF)라고 부르며 정의된다.[1] 여기서 BRDF는 재질마다 고유한 척도로서 얻어낸 영상이 현실과 류사하도록 조절통제하는 수단이다. 이 함수를 실제한 재질과 가깝게 정할수록 질이 높아지게 된다. BRDF를 근사화한 여러가지 모형들이 제안되였는데 대표적인 모형으로서는 Phong모 형[2]을 들수 있는데 이 모형은 거울반사범위를 계산하는 경험적인 모형으로서 거울반사 cos φn 에 비례하도록 설정한다. 이 모형은 완전확산면이 아닌 면들의 특성을 의 세기를 )( 잘 반영하는것으로 하여 제일 광범히 리용되고있는 모형이다. 이 모형의 BRDF는 Lx ,( LN , 반사률, sk 는 거울반사률이며 n 은 거울반사파라메터이다. Phong모형을 약간 변형시킨 변형된 Phong모형 ,( Lx V =↔ cos( cos / φ + k k ) f f d r s n ) 와 같다. 여기서 dk 는 확산 r V =↔ ) k + k s d cos φn 도 있다.[2] 거울반사파라메터 n 에 할당되는 값은 현시하려는 면의 류형에 의하여 결정된다. n 은 고광택면들에서 큰 값(100 또는 그 이상)으로 모형화되며 보다 무광택인 면들에 서는 더 작은 값(1아래)으로 모형화된다. 완전한 반사면에 대하여 n 은 무한대이다. 다음으로 거울반사파라메터 n 의 여러가지 값에 대한 cos 곡선에 대하여 보자. φn Phong모형을 리용하면 고광택면재질에서 거울반사방향으로부터 멀어지게 될 때 급격 히 어두워지게 되는데 이것은 화상의 질을 떨구는 하나의 요인으로 된다. 론문에서는 이 문제를 해결하기 위하여 고광택면재질에서 보다 천천히 어두워지는 BRDF모형을 제안하고 그것을 Phong모형과 비교해보기로 한다. cos φ n )1 − 우리가 제안한 BRDF모형은 V =↔ Lx ,( + − n k k ) ( f d s r cos φ 와 같다. 여기서 dk 는 확산반사률, sk 는 거울반사률, n 은 거울반사파라메터로서 매질에만 관계된다. 즉 n 은 매질이 거친가 매끈한가를 나타내는 척도로서 매끈한 면에 대해서는 n 이 크며(리상적인 면에 대해서는 무한대) 거친 면에 대해서는 n 이 0에 가깝다. 완전확산면에서는 n 이 0이다. 이 모형에 의하면 거울반사벡토르 R 와 반사벡토르 V 사이의 각 φ가 클수록 거울반 사의 량이 작아지게 된다. 즉 cos n ( − φ가 클수록 φcos 가 작아지고 − n φ )1 = 1 − cos φ n 1 − ( n )1 − − ⎞ ⎟⎟ 1 ⎠ 이다. φ cos n 가 작아지게 된다. 또한 n 이 클수 ⎛ ⎜⎜ ⎝ cos n /[ φ 록(보다 매끈할수록) 주어진 반사벡토르방향으로 방출되는 빛이 적어지게 된다. − n ( cos ] φ )1 − n － 94 － 종합대학학보 수학 주체108(2019)년 제65권 제4호 거울반사면에서는 거울반사각에서만 빛을 볼수 있고 나머지방향에서는 빛이 전혀 전 달되지 않는다. 즉 cos n − φ )1 = cos φ ) + φ cos n − ( cos φ n 1( − cos φ 이다. 이 모형을 리용하여 다른 모형들과 속도와 질을 비교해보기로 한다. 우리의 모형을 리용하여 BRDF를 계산하는 알고리듬은 다음과 같다. ① 입사광선벡토르와 반사광선벡토르를 입력한다. ② 법선벡토르에 대한 거울반사벡토르를 계산한다. ③ 거울반사벡토르와 반사광선벡토르사이의 각의 코시누스값을 계산한다. ④ BRDF를 계산한다. Spectrum f (const Vector3f &wo, const Vector3f &wi) {   Vector3f wR =wo;   Vector3f wS = reflect(wR, n);   Float cosalpha = AbsDot(wR, wS);   Float fraction=cosalpha/(nPow - (nPow-1) * cosalpha);   Spectrum L = kd + ks* fraction;   return L; } 표．계산결과 제안모형 Phong모형 변형된 Phong모형 시간/s 297.3 오차 1.493 7 297.5 3.500 9 299.2 1.768 0 제안모형과 Phong모형, 변형된 Phong모형 을 가지고 killeroo-simple장면에 대한 렌더링 을 진행한 계산결과는 표와 같다. 제안모형에 대한 실험은 Core(TM) i5-4 590 pixel이고 광원표본화와 CPU @3.30GHz(4 CPUs)에서 진행하였으며 화상의 크기는 BRDF표본화를 진행하였다. 또한 매 화소의 밝기를 계산하는데 8개의 표본을 리용하였으 며 10번의 실험을 진행하여 시간과 오차의 평균값을 계산하였다. 700 × 700 같은 시간에서 진행한 실험결과를 보면 오차는 Phong모형에 비하여 42.67%, 변형된 Phong모형에 비하여 84.48%로 감소되였다. 1997. [1] E. Veach; Robust Monte Carlo Methods for Light Transport Simulation, Stanford University, 5～9, 참 고 문 헌 [2] R. M. Soldado et al.; An Overview of BRDF Models, University of Granada, 67～101, 2012. 주체108(2019)년 6월 10일 원고접수 A Rendering Method using a Better BRDF of Phong Model Ri Jong Ro, Han Song We propose one BRDF model for reducing of error in the scene containing glossy materials.  Key words: BRDF Model, glossy material