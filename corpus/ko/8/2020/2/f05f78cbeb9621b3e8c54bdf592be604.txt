김일성종합대학학보 물리학 주체109(2020)년 제66권  제2호 ４원수에 기초한 확장칼만려파기를 리용한  한가지 자세결정방법 김주혁, 장재식 위대한 령도자 동지께서는 다음과 같이 교시하시였다. 《최신과학기술에 기초하여 나라의 경제를 현대화, 정보화하기 위한 투쟁을 힘있게 벌려야 합니다.》(《선집》 증보판 제22권 22페지) 저가격 관성수감부(3축가속도계, 3축각속도계, 3축자력계 포함)를 리용한 자세결정에서는 정확도를 높이기 위하여 오일러각에 기초한 확장칼만려파알고리듬(EKF), 방향코시누스행렬에 기초한 확장칼만려파알고리듬, 4원수에 기초한 확장칼만려파알고리듬 등을 리용한다.[1－4] 우리는 4원수에 기초한 새로운 확장칼만려파알고리듬을 제기하고 실수감부자료에 의 한 모의를 통하여 그 성능을 검증하였다. １．４원수를 리용한 자세표현과 ４원수미분방정식 １）4원수를 리용한 자세표현 이동체의 자세는 일반적으로 오일러각 즉 방위각(ψ ), 종요각( θ )과 횡요각( φ )으로 표현된다. 지구에 고정시킨 기준계로부터 동체계에로의 자리표변환행렬은 오일러각에 의 하여 다음과 같은 회전행렬 eC 로 표시된다.[5] b cos cos θψ sin sin − sin cos θψ sin cos + b eC = cos sin sin φψφθψφψφθψ cos − ψφψθφ φθψφψ cos cos cos cos cos sin sin sin sin sin sin + sin ⎛ ⎜ ⎜ ⎜ ⎝ − cos cos sin θ ⎞ ⎟ sin φθ ⎟ ⎟ cos φθ ⎠ (1) 이동체의 자세는 또한 4원수 ] 에 의해서도 표현될수 있는데 이때 자 세를 표현하는 4원수는 1 = 구에 고정시킨 기준계사이의 자리표변환행렬은 4원수에 의하여 표시될수도 있다.[5] 을 만족시킬것을 요구한다. 이때 동체계와 지 + + + q q q 2 0 2 q 1 q = 2 2 [ 2 0 qqqq 1 2 3 3 C b e = q 21 − qq (2 21 qq (2 31 2 2 q 2 − 3 2 qq − 30 qq + 20 ⎡ ⎢ ⎢ ⎢ ⎣ qq qq qq (2 (2) − + 21 30 31 2 2 q q qq 21 ) 2 (2 − − + 1 3 32 2 qq qq q (2) 21 − − − 32 1 10 qq ) 20 qq ) 10 2 q 2 2 ) ⎤ ⎥ ⎥ ⎥ ⎦ (2) 식 (1), (2)로부터 자세각들은 4원수에 의하여 다음과 같이 구할수 있다. ⎧ φ ⎪ ⎪ ⎪ θ ⎨ ⎪ ⎪ ψ ⎪ ⎩ = arctan = arcsin[ = arctan qq 32 2 q 1 − − q (2 2 0 (2 − qq 20 qq 21 2 q 1 (2 2 0 + q 2 3 + ) q qq 10 2 q + 2 qq 31 qq 30 2 q − 2 )] q ) + − 2 3 (3) 4원수에 기초한 확장칼만려파기를 리용한 한가지 자세결정방법 － 47 － ２）4원수미분방정식 자세를 표현하는 4원수의 시간에 관한 미분방정식은 다음과 같다.[5] 식 (4)에서 4원수는 렬벡토르로 표시된다. qˆ 은 표준화된 4원수렬벡토르이며 bΩ 는 다음과 같다. 1 Ω=(cid:5) q 2 b ˆ q (4) =Ω b x − ωωω z y 0 ω y − − 0 − ⎡ ⎢ ω ⎢ x ⎢ ωω z ⎢ ωω ⎢ ⎣ y − y z ω z 0 − ω x ⎤ ⎥ ⎥ ⎥ ⎥ ⎥ ⎦ ω x 0 (5) x ωωωω= z [ y ] 는 지구에 고정시킨 기준계에서 표시된 동체계의 각속도이다. 여기서 ωωω z y x , , 는 각각 3축각속도수감부에 의하여 측정되는 량이다. 4원수미분방정식을 리산모형으로 넘기면 다음의 식이 얻어진다. kq )( = (ˆ kq ( k − (ˆ])1 kq T Ω+− 2 )1 [ b I ⎧ ⎨ ⎩ )1 =− T [ Ω+ 2 )(kq 는 시각 ⎫ )]1 ⎬ ⎭ t = 에서의 4원수, (ˆ kq )1 − − k k ( b (6) (ˆ −kq )1 은 여기서 T 는 체계의 표본화간격을 의미하며 시각 에서의 4원수를 나타낸다. 1−= k t ２．４원수에 기초한 확장칼만려파알고리듬 １）상태벡토르와 상태방정식 자세를 표현하는 4원수와 3개의 각속도수감부의 표류오차가 상태변수로 선택되므로 상태벡토르는 다음과 같다. kx )( = [ kq )( 0 kq )( 1 kq )( 2 kq )( 3 b x ω k )( b y ω k )( b z ω ( k T )] (7) 여기서 kq ( 0 ), kq ( 1 ), kq ( 2 ), kq )( 3 는 4원수의 매 성분들이며 b x ω k ,)( b y ω ( k ), b z ω k )( 는 각속 도수감부의 우연표류오차벡토르의 3축성분들이다. 일반적으로 우연표류오차벡토르가 시간에 따라 천천히 변하는 량이라고 가정하면 다 음의 식이 성립된다. ( ( k k − − )1 )1 ( k − )1 ⎤ ⎥ ⎥ ⎥ ⎦ = ⎤ ⎥ ⎥ ⎥ ⎦ )( k )( k b ⎡ x ω ⎢ b ⎢ y ω ⎢ b ⎣ z ω b ⎡ x ω ⎢ b ⎢ y ω ⎢ b ⎣ z ω 결과 상태방정식은 다음의 식으로 표시된다. ⎞ =⎟⎟ ⎠ ),1 − ⎛ ⎜⎜ )( kb ⎝ ω (( )1 kxf +− )(kx 는 k시각의 상태벡토르, (ˆ)]1 ( k kq −Ω b ( )1 kb − ω ( kW − ( −kW )1 )1 )( kq )( kx 은 )2/ )( k ⎛ ⎜⎜ ⎝ ( T = = + k I [ 여기서 이다. (8) − )1 ⎞ +⎟⎟ ⎠ ( kW q ( kW ω ⎛ ⎜⎜ ⎝ − )1 − )1 ⎞ =⎟⎟ ⎠ (9) 1−k 시각의 백색잡음, f 는 비선형함수 이로부터 EKF알고리듬에 필요한 비선형함수 f 의 야꼬비행렬 Φ kk ,( − )1 은 다음과 종합대학학보 물리학 주체109(2020)년 제66권 제2호 － 48 － 같다. Φ ,( kk − )1 = − (( kxf ∂ − ( kx ∂ 2/~ T ω x 1 2/~ T − ω z 2/~ T ω y 0 0 − )1 ),1 − k )1 ( kx 2/~ T − ω y 2/~ T ω z 1 2/~ T ω x 0 0 − = )1 =− − (ˆ )1 kx − 2/~ T ω z 2/~ T − ω y 2/~ T ω x 1 0 0 0 0 0 0 = 1 2/~ T ω x 2/~ T ω y 2/~ T ω z 0 0 ⎛ ⎜ ⎜ ⎜ ⎜ ⎜ ⎜ ⎜ ⎜ ⎜⎜ ⎝ ( Tq 1 Tq 0 Tq 3 ( − − Tq 2 k ( ( − k k k 2/)1 2/)1 2/)1 − − 2/)1 Tq 2 Tq 3 Tq − 0 Tq 1 − ( k − 2/)1 ( 2/)1 k − ( 2/)1 k − ( k − 2/)1 Tq 3 Tq − Tq 1 Tq − ( 2 ( 0 k 2/)1 − ( 2/)1 k − 2/)1 k − k 2/)1 − ( − 1 0 0 0 1 0 ⎞ ⎟ ⎟ ⎟ ⎟ ⎟ ⎟ ⎟ ⎟ ⎟⎟ ⎠ 0 0 1 (10) 여기서 이고 ~[ ~ ]~ T ωωω x z y 는 각속도수감부의 측정값이다. , ωωω z y [ ωωω z y b [ b z ωωω T ] − = b , x x y x T ] 이다. ~,~,~ ωωω x z y 는 실지 각속도값 ２) 측정벡토르와 측정방정식 지구에 고정시킨 기준계의 x축은 지자기북극방향으로, z축은 지면에 수직인 아래방향 으로 정하면 이때 가속도계와 자력계의 측정값들은 다음과 같다. 여기서 eaˆ 와 emˆ 는 각각 지구에 고정시킨 기준계에서 표준화된 측정값벡토르들이다. e ˆ m = [ m e x 0 m T] e z , =ea ˆ 00[ T]1 − 동체계에서 가속도계와 자력계의 표준화된 출력량들은 b z b aaa y mmm T ,] ˆ m = = ˆ a b z b x b y b x [ [ b b T ] 이다. 따라서 b ˆ a = eb ,ˆ ˆ maC e b = e b ˆ mC e 이며 다음의 식들이 얻어진다. ⎡ ⎢ ⎢ ⎢ ⎣ a a a b x b y b z ⎤ ⎥ ⎥ ⎥ ⎦ = C b e ⎡ ⎢ ⎢ ⎢ ⎣ 0 ⎤ ⎥ 0 ⎥ ⎥ 1 ⎦ − = ) − − (2 qq 31 qq (2 + 32 2 q 21( − 1 − −− qq 20 qq ) 10 2 q 2 ) 2 ⎡ ⎢ ⎢ ⎢ ⎣ ⎤ ⎥ ⎥ ⎥ ⎦ m m m b x b y b z ⎡ ⎢ ⎢ ⎢ ⎣ ⎤ ⎥ ⎥ ⎥ ⎦ = C b e m e x 0 e m z ⎡ ⎢ ⎢ ⎢ ⎣ ⎤ ⎥ ⎥ ⎥ ⎦ = q m e 21( − x e 2 ( qqm 21 x e ( 2 qqm x 31 2 2 − + ⎡ ⎢ ⎢ ⎢ ⎣ − 2 q ) + 2 2 3 qq 30 qq 20 ) ) + + 2 m − e ( qqm 31 z e ( qqm + 32 z e 2 21( q − − z 1 qq 20 qq 10 2 2 q 2 ) ) ) ⎤ ⎥ ⎥ ⎥ ⎦ 그러므로 측정변수들로서 동체계에서의 가속도측정량과 자기마당측정량들을 리용할 수 있다. 즉 측정벡토르는 다음과 같이 표시된다. b z b [ x= kz )( )( )( b y kmkmkmkakaka ( )( )( )( (11) b x b y b z T)] 는 동체계에서 가속도계측정량, b kmkmkm )( y ), ), b z b x ( ( 는 동체계 b ka ( x 여기서 b ka ( y 에서의 자기마당측정량들이다. b ka )( z ), ), 이때 측정방정식은 다음과 같다. － 49 － 4원수에 기초한 확장칼만려파기를 리용한 한가지 자세결정방법  (2 (2 ) ) − − qq qq − 31 20 qq qq + 32 10 2 2 q q 2 − 2 1 e 2) ( qqm + z 31 e qqm ( + z 32 2 e 21( q − − z 1 2) + m ) + 21( −− 2 q 2 − 3 qq 30 qq 20 − ) 2 2 − + qq 20 qq 10 2 2 q 2 ) ) ) ⎤ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎦ q m e 21( − x e qqm 2 ( x 21 e ( qqm 2 x 31 + kV )( = (12) + kV )( ), )(kV 는 시각 k에서 백색잡음이다. 이로부터 EKF알고리듬에 필 )(kH 는 다음과 같다. = = kz )( b ⎡ ka )( x ⎢ b ka )( ⎢ y ⎢ b ka )( z ⎢ b km )( ⎢ x ⎢ b km )( ⎢ y b ⎢ km )( ⎣ z kxh (( 여기서 h 는 비선형함수, 요한 비선형함수 h 의 야꼬비행렬 ⎤ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎦ k ⎡ ⎢ ⎢ ⎢ ⎢ ⎢ ⎢ ⎢ ⎢ ⎣ = ) kxH (( )) = k ) kxh (( ), ∂ kx )( ∂ )( kx = ,(ˆ kkx )1 − 2 q − 2 2 q 1 0 = ⎡ ⎢ ⎢ ⎢ ⎢ ⎢ ⎢ ⎢ ⎢ ⎣ 0 q 3 2 q 2 − 4 q − 2 q 1 − 2 q 2 0 − 2 2 − e qm x 2 e qm z + 3 e qm x 2 2 e qm 2 z 1 e qm 2 x 2 e qm 2 x 3 3 e qm 2 z e qm 4 z 1 0 4 e qm − x e qm 2 x 1 e qm 2 x 0 0 2 2 e qm − z e qm 2 z 3 e qm 4 z 2 2 + − − 4 − 2 e qm x e qm x 2 + 2 3 2 + 0 e qm x 1 e qm z 1 e qm z 2 000 000 000 000 000 000 ⎤ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎥ ⎦ = 3 0 − 2 q 2 2 q − 4 q 1 e qm z + − ３) 알고리듬 4원수에 기초한 확장칼만려파알고리듬은 다음과 같다. ① 초기값 초기상태의 초기값들과 잡음공분산의 초기값들을 규정한다. ② 시간갱신 상태이행함수에 의하여 상태벡토르를 갱신한다. (ˆ( ),1 kxf )1 을 계산한다. )1 ,(ˆ kkx 측정갱신전의 오차공분산행렬 )1 =− −kkP ,( − − k (13) kkP ,( Φ=− )1 kk ,( − )1 kP ( )1 Φ− kk ,( )1 +− kQ ( − )1 (14) T ③ 측정갱신 칼만리득 )(kK 를 계산한다. kK )( kkP ,( = 측정갱신후의 오차공분산행렬을 계산한다. kkPkHkKI ( kkPkHkH kP )( )] 로 하고 우의 단계들을 반복한다. 1+= k ④ )( )( ,( ,( )1 )[ − = − k [ ( T − )1 T kH )( + kR ( )] − 1 (15) − )1 (16) 여기서 Q 와 R 는 각각 적분된 과정잡음공분산행렬, 측정잡음공분산행렬들이다. ３．４원수에 기초한 EKF알고리듬의 모의결과 모의분석을 위하여 MEMS형관성측정단의 실지 측정자료를 리용하였다. 우선 수감부 들의 오차를 고려함이 없이 관성측정단의 가속도계, 각속도계, 자력계의 측정값들에 의한 － 50 － 종합대학학보 물리학 주체109(2020)년 제66권 제2호  자세각들(횡요각과 종요각)을 결정하였다.(그림 1) 또한 오일러각에 기초한 EKF알고리듬 과 제안된 알고리듬(4원수에 기초한 확장칼만려파알고리듬)을 리용하여 자세각들을 각각 결정하였다.(그림 2, 3) 그림 1. 수감부자료를 리용하여 얻어진 횡요각(ㄱ))과 종요각(ㄴ)) 그림 2. 오일러각에 기초한 EKF를 리용하여 얻어진 횡요각(ㄱ))과 종요각(ㄴ)) 그림 3. 제안된 알고리듬을 리용하여 얻어진 횡요각(ㄱ))과 종요각(ㄴ)) 그림 1－3에서 보는바와 같이 4원수에 기초한 EKF가 충분한 정확도로 자세각들을 결정한다. 맺 는 말 정확한 자세결정을 위하여 4원수에 기초한 새로운 확장칼만려파알고리듬(EKF)을 제 기하고 실수감부자료를 리용한 모의들을 통하여 그 성능을 검증하였다. 제안된 방법으로는 백색잡음을 억제하고 정확한 자세정보를 얻을수 있다. 4원수에 기초한 확장칼만려파기를 리용한 한가지 자세결정방법 － 51 － 참 고 문 헌 [1] W. Li et al.; The Journal of Navigation, 66, 99, 2013. [2] H. Sheng et al.; Measurement, 59, 63, 2015. [3] X. Tong et al.; IEEE Sensors Journal, 18, 8, 3299, 2018. [4] R. W. Beard et al.; Small Unmanned Aircraft, Princeton University Press, 144～163, 2011. [5] E. Bekir; Introduction to Modern Navigation Systems, World Scientific Publishing, 35～57, 2007. 주체108(2019)년 12월 5일 원고접수 An Attitude Determination Method Using  Quaternion-Based Extended Kalman Filter Kim Ju Hyok, Jang Jae Sik In order to determine the accurate attitude, we proposed a new quaternion-based extended Kalman filter and verified its performance through simulations using real sensor data. The results show that the proposed method can suppress the white noise and obtain the accurate attitude information.  Keywords: attitude determination, extended Kalman filter, quaternion