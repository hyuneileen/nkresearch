김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체104(2015)년 제61권 제4호 Vol. 61 No. 4  JUCHE104(2015). CY7C68013을 리용한 진폭－시간２차원다통로 스펙트르분석기의 USB 2.0직렬자료통신 송용혁, 강호 과학기술이 발전하는데 따라 수자식집적회로는 광범히 응용되고있으며 자료수집의 속 도, 정확도, 실시간특성 등에 대한 요구가 끊임없이 높아지고있다. 직렬모선 USB는 콤퓨터 와 외부설비를 서로 련결시키는 표준결합방법들중의 하나이다.[1, 2] USB 2.0규약은 통신속도가 매우 빠르고 확장하기 쉬우며 즉시 련결하고 즉시 리용할수 있는 우점을 가지고있는것으로 하여 외부설비와의 결합표준으로 이미 광범히 리용되고있다. 자료통신속도와 전체 체계의 동작속도는 이음부회로의 설계에 크게 관계된다. 체계의 요구 를 만족시키는 이음부소편을 선택하여야 자기의 우월성을 충분히 발휘할수 있다. 이외에 개 발의 난도, 개발도구의 숙련정도, 원가, 자원리용률도 소편선택의 중요한 요인으로 된다. 우리는 EZ－USB FX2계렬 CY7C68013－56소편을 리용하여 2차원스펙트르분석기와 콤 퓨터사이에 USB 2.0직렬자료통신을 실현하였다. CY7C68013[3, 4]을 리용한 2차원분석기와 콤퓨터사이의 자료송수신회로는 그림 1과 같다. １．장 치 설 계 그림 1. CY7C68013의 조종 및 자료송수신회로도 PA0은 새치기단자, PA5～PA7은 조종신호로 리용(PA5는 시간자료읽기, PA6은 분석기에 자 료쓰기, PA7은 진폭자료읽기)하며 FD0～FD15로 스펙트르분석기의 16bit자료를 접수한다. 분석기는 DPLUS와 DMINUS단자로 콤퓨터와 USB자료통신을 진행한다. CY7C68013의 전원은 콤퓨터의 ＋5V 전원을 ＋3.3V로 변환하여 보장하였다. － 68 － CY7C68013을 리용한 진폭－시간2차원다통로스펙트르분석기의 USB 2.0직렬자료통신 ２．펌웨어설계 먼저 장치초기화를 진행하고 분석기로 측정시작 및 쓰기신호가 들어가면서 측정을 시 작한다. 분석기에서 AD변환이 끝난 후 새치기신호가 발생하는데 CY7C68013은 이 신호를 접 수하면 진폭자료읽기, 시간자료읽기를 하고 순서대로 콤퓨터에 전송한다. 새치기신호가 발생하지 않으면(분석기입구에 신호가 들어오지 않았거나 AD변환이 끝 나지 않은 경우) 발생할 때까지 대기한다. 다음 콤퓨터로부터 측정정지신호를 접수하지 않으 면 측정을 반복하여 계속 진행하며 측정정지신호를 접수하면 체계의 전체 동작을 완료한다. 펌웨어설계는 Keil C51을 리용하여 진행하였는데 원천프로그람은 DSCR.A51, USBJmpTB.OBJ, Ezusb.lib, isr.c, framework.c, DeviceCTL.c, gpif.c로 구성되여있다. GPIF를 프 로그람화하려면 GPIF Designer를 리용하여 Waveform Descriptor를 작성한 후에 gpif.c화일을 만들어 프로젝트에 포함시키고 TD_Init()에서 GPIF_Init()함수를 호출하면 된다. DR_VendorCmnd()은 Default Control Endpoint(Endpoint 0)를 통해 호스트로부터 오는 명 령중에서 우리가 처리해야 할 함수이다. ３．대면부프로그람설계 조종은 Control전송방식을, 자료수집은 Bulk전송방식을 리용하였다.[1, 4] 프로그람을 실 행하면 먼저 펌웨어를 적재하고 장치설정을 하며 Control전송방식((*pControlTrans)(dummybuf, VX_START, m_bspt, m_MesByte), (*pControlTrans)(dummybuf, VX_STOP, m_bspt, m_MesByte)) 으로 분석기의 측정시작과 정지, 통로설정, 계수기지우기 등 해당한 조종신호들이 나간다. 다 음 분석기의 진폭자료, 시간자료들을 Bulk전송방식(pBulkTrans(dummybuf, 0, 8192))으로 8KByte 씩 차례로 전송하며 화면에는 1s에 한번씩 연시한다. 대면부프로그람에서는 측정자료의 보 관과 적재, 측정시작과 정지, 화면지우기, 진폭측정 혹은 진폭과 시간동시측정설정을 할수 있 으며 분석부분에서 스펙트르원활화, 봉우리탐색, 봉우리면적계산, 눈금새김(에네르기, 시간) 등 을 진행한다. Visual C++응용프로그람으로 개발한 측정체계대면부는 그림 2 와 같다. 그림 2에서 보는바와 같이 섬광 검출기 NaI(Tl)를 리용하여 표준원천 60Co의 γ선스펙트르를 측정한 결과는 선행연구결과[3]와 잘 일치한다. 스펙트르의 마지막에 있는 2 개의 큰 봉우리(1.17, 1.33MeV)는 빛전자흡수와 다중산란 즉 γ선의 에 네르기가 완전히 흡수된 결과로 생 기는것인데 이 완전흡수봉우리의 그림 2. 측정체계대면부 － 69 － 종합대학학보(자연과학)   주체104(2015)년  제61권  제4호 S σ 2 2 ) ⎛ ⎜ exp ⎜ ⎝ ( nn − 0 2 2 σ ⎞ ⎟ ⎟ ⎠ 모양은 nN )( = 에 의하여 표시된다. 여기서 n은 통로번호, S는 봉우리의 면적, n0은 봉우리의 위치에 해당한 통로번호, σ는 n의 분산도이다. 완전흡수봉우리에서 빛전자흡수와 다중산란이 차지하는 상대적인 몫은 섬광체의 크기, 원자번호, 밀도에 관계되며 γ선의 에네르기와 평행묶음화된 정도에 관계된다. 스펙트르에 는 각이한 진폭을 가진 련속분포가 나타나는데 이것은 섬광체속에서 γ선이 콤프톤산란될 때 생기는 반충전자에 의한것이다. 콤프톤산란분포에서 전자의 최대에네르기는 0cm 을 단위로 표시한 전자와 γ선의 에 이다. 여기서 0E , γE 는 각각 21/( + 2 E γ E γ max E = 2 ) ) ( 2 0 네르기이다. 반충전자의 수가 급격히 많아진다. 반충전자의 에네르기는 0부터 (E 0 ) max 까지 분포되여있으며 최대에네르기경계근방에서 스펙트르에 완전흡수봉우리외에 비대칭모양을 가진 봉우리가 제일 앞부분에 나타나는 데 이것은 빛전자증배관(주로 유리창)과 보호벽 그리고 섬광체를 포장한 유리덮개에서 산 란된 γ선이 부분적으로 기록된것이다. 이 역산란봉우리에 대한 γ선의 에네르기는 Es = 1 + E γ 1( − θ /) cm 0 2 E γ cos 에 의하여 결정된다. 식에서 보는바와 같이 γ선이 90～180°각으로 산란될 때 산란선의 에네르기는 거의 변하지 않는다. 대부분의 동위원소에 대하여 역산란 봉우리에 해당하는 에네르기는 70～400keV사이에 놓인다. 이밖에 전자의 루실현상과 X선 이 스펙트르모양에 보충적인 영향을 준다.(경계효과) 경계효과는 γ선의 에네르기가 클수록 그리고 섬광체가 작을수록 더욱 심하게 나타난다. EZ－USB FX2소편 CY7C68013을 리용하여 2차원분석기와 콤퓨터사이의 결합회로를 설 계제작하였다. 또한 Keil C51을 리용하여 CY7C68013의 펌웨어를 개발하였다. Visual C++를 리용하여 콤퓨터대면부프로그람을 개발하고 섬광검출기 NaI(Tl)를 리용 하여 표준원천 60Co의 γ선에네르기스펙트르를 측정하였다. [1] Wang Rongbo et al.; Chinese Journal of Scientific Instrument, 30, 10, 272, 2009. [2] L. Gabriela et al.; IEEE Transactions on Nuclear Science, 56, 5, 2586, 2009. [3] Sun Jian; Nuclear Electronics and Detection Technology, 32, 1, 41, 2012. [4] EZ－USB FX2 Technical Reference Manual 2.1, Cypress, 11～112, 2001. 주체103(2014)년 12월 5일 원고접수 맺 는 말 참 고 문 헌 － 70 － CY7C68013을 리용한 진폭－시간2차원다통로스펙트르분석기의 USB 2.0직렬자료통신 USB 2.0 Serial Data Communication of A-T Two-Dimensional Multichannel Spectrometer using CY7C68013 Chip Song Yong Hyok, Kang Ho The data acquisition system of A-T two-dimensional multichannel spectrometer based on the technology of USB 2.0 and Visual C++ was designed. Firstly, USB interface circuit for the GPIF mode including EZ-USB FX2 CY7C68013 chip was designed. Secondly, according to the requirements of the system, the software of system was developed including the design of firmware and the design of the application program. Finally, the hardware and the software of the system were used for measuring γ-ray(60Co radioactive resource) with NaI(Tl) detector. Key words: USB 2.0, FX2, VC, GPIF, multichannel spectrometer － 71 －