김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체104(2015)년 제61권 제7호 Vol. 61 No. 7  JUCHE104(2015). GoogleMap에 기초한 공간자료정합에 대한 연구 리금수, 김성민, 박정호 GoogleMap는 WebGIS를 실현한 체계이며 망에서 GoogleMap를 내장한 각종 응용프로 그람들을 볼수 있다. 그러나 GoogleMap의 지도는 대부분의 지역에 대하여 자료가 매우 빈약하다. 우리는 GoogleMap의 투영 및 구조원리를 분석하고 지도봉사기(WMS: Web Map Server)에서 이 원리에 따라 타일구분을 진행하고 다시 화상정합을 진행하여 GoogleMap의 지도자료를 보충하는 방법에 대하여 연구하였다. １．GoogleMap의 특징 GoogleMap는 WebGIS리론을 받아들여 새로운 대중용WebGIS구조를 형성하였다. 기존 WebGIS의 대부분은 CGI/SERVER API의 방법을 리용[1]하였으며 봉사기는 의뢰기의 요청 을 직접 GIS응용프로그람에 보내고 응답을 기다린 후 다시 결과를 의뢰기에 반환한다. 봉사기는 모든 과정에서 중개자로서 요구와 응답결과를 전달하며 모든 처리는 의뢰기의 응용프로그람에 맡긴다. GoogleMap는 타일에 기초한 자료기지구축 및 봉사를 진행한다. 봉사기는 GIS응용프 로그람을 요구하지 않으며 단지 요청을 해석하고 해당한 타일을 찾아 그 타일을 보내기 만 한다. GoogleMap는 장기간 변하지 않는 자료는 화상으로 보존하고 자주 변동하는 자료는 의뢰기script로 조작을 진행한다. GoogleMap의 일부 지역의 자료는 완전하지 못하며 이것 은 사람들의 정확한 지리적위치에 대한 요구를 만족시킬수 없다. ２．GoogleMap의 분석 GoogleMap는 모든 봉사를 Javascript로 진행하며 코드도 의뢰기에서 실행되므로 봉사 기의 부담을 덜어준다. GoogleMap에서 리용되는 자료는 자리표변환을 통하여 매 화상이 지리적의미를 가진다. １）메카토르투영 GoogleMap가 리용한 투영은 EPSG：900913표준의 메카토르투영이며 등각원추투영이 다. 메카토르투영은 남북 량극의 변형이 심하므로 GoogleMap는 량극 85˚이상의 부분은 없애버리고 동, 서, 남, 북이 서로 같은 정방형을 만들고 4분수계산을 진행한다. 메카토르 투영공식은 다음과 같다. Ry ×= ln tan ⎛ ⎜⎜ ⎝ ⎛ ⎜ ⎝ ϕπ ⎞ + ⎟ 4 2 ⎠ ⎞ ⎟⎟ ⎠ － 124 － GoogleMap에 기초한 공간자료정합에 대한 연구  θ×= Rx y π= 이면 투영후의 그림은 정방형이며 위도는 85.051 13˚이다. 그러므로 GoogleMap R 의 최대위도값은 ± 85.051 13˚，최대경도값은 ± 180˚, 투영후의 최대 x, y자리표값은 서로 같다. 지구반경이 6 378 137m라면 공식에 따라 메카토르투영의 최대경계값은 ± 20 037 508.342 789 244m이다. ２）타일피라미드 GoogleMap는 분해능크기가 256×256fixel인 화상으로 틈이 없이 련결시켜 만든것인데 이때 이것을 타일이라고 부른다. 초기수준에서는 지구전체를 한장의 256×256fixel크기의 화상에 투영한다. 다시말하여 256개의 화소는 40 075 016.685 578 488m이다. GoogleMap에 서 정의한 축척은 기존의미에서 정의한 축척과 다르며 정의한 단위화소가 대표하는 거리 값이다. 초기수준의 척도는 1개 화소당 156 543.033 928 041m이다. 매 화상을 한 수준 확대하면 4장으로 나누어지며 축척은 원래의 절반으로 줄어든다.  마지막으로 확대축소수준의 증대에 따라서 타일은 피라미드를 형성한다.(표) 표. 타일피라미드형성 수준 0 1 2 ⋮ n 타일 1×1 2×2 4×4 ⋮ 2n×2n 화소 256×256 512×512 1 024×1 024 ⋮ 256×2n×256×2n 분해능 156 543.033 928 040 62 78 271.516 964 020 309 39 135.758 482 010 155 ⋮ 156 543.033 928 040 62/2n ３）자리표체계 GoogleMap는 여러가지 자리표계를 정의하였는데 여기에는 측지자리표계, 투영자리표 계, 화소자리표계, 타일자리표계가 있다. 매 자리표계사이에는 호상 전환할수 있다. GoogleMap의 자리표계는 WGS84타원체에 기초하며 위도, 경도를 단위로 한다. 메카토르 투영으로 투영자리표계를 생성하며 단위는 m이다. 두 자리표계는 모두 자오선과 적도선 의 사귐점을 원점으로, 동쪽은 X축정방향, 북쪽은 Y축정방향으로 하여 메카토르투영공식 으로 변환한다. GoogleMap는 타일자리표계를 정의하며 자리표계의 원점은 W: 180˚, N: 85.051 13˚인데 원래의 메카토르투영자리표계의 왼쪽 웃모서리이다. 자리표계의 가로축은 동쪽으로 정방 향, 세로축은 남쪽으로 정방향이다. 타일의 최소값은 척도에 관계되며 매 수준 타일의 최 대값은 다음의 공식으로부터 계산된다. Tilemax = 2n GoogleMap는 또한 화소자리표계를 정의하는데 경위도자리표계와 화소자리표는 1：1 대응된다. 화소자리표는 타일자리표에 따르며 매 타일을 256개의 화소점으로 분할한다. 그러므로 화소자리표계의 최대값은 타일자리표계 최대값의 256배이다. 투영자리표계는 다 음의 공식으로 화소자리표계로 전환하며 mx, my는 투영자리표계의 자리표를, px, py는 화 소자리표계의 자리표를, res는 현재 수준 N의 척도를 표시하며 초기수준은 0이다. res = 156 543.033 928 040 62/2n px = (mx + 20 037 508.342 789 244)/res － 125 － 종합대학학보(자연과학)   주체104(2015)년  제61권  제7호  py = (20 037 508.342 789 244 － my)/res 화소자리표계는 쉽게 타일자리표계로 전환할수 있는데 화소자리표를 256으로 나누고 얻은 값이 이 점의 타일자리표이다. ４）타일 URL주소 GoogleMap는 여러가지 형식으로 벡토르지도, 위성지도, 혼합지도 및 지형도를 선택리 용할수 있다. 론문에서 정합한것은 벡토르지도인데 벡토르지도가 제일 빈약한 자료이기때 문이다. GoogleMap는 ajax를 리용하여 먼저 지역타일의 자리표를 계산하고 URL을 통하여 직접 이 그림을 요청한다. 매 그림의 요청URL의 실례는 아래와 같다. http://mt0.google.en/mt?v=en1.5&hl=zh-EN&x=4&y=2&z=3. 여기서 mt0은 봉사기의 이름인데 GoogleMap의 벡토르지도는 mt0 ~ mt3까지 4개의 봉사 기가 봉사한다. v는 판번호를 의미하며 현재의 판번호는 en1.5이다. hl은 지역언어이다. x, y, z는 타일의 x자리표, y자리표 및 확대축소수준이다. 사실 타일의 x, y자리표와 현재 수준을 알면 직접 이 그림을 얻을수 있으며 이 방법 으로 GoogleMap를 보면 매우 간단하다. ３．자 료 정 합 GoogleMap자료는 쉽게 얻을수 있으나 리용자료를 GoogleMap와 서로 일치시켜야 한 다. 그러므로 GoogleMap와 같은 방법으로 지도를 분할하여야 한다. 지도봉사기(WMS)는 OGC가 제정한 표준이며 분산지도봉사기로 구성된 망으로부터 구축할수 있다. 의뢰기는 그것을 리용하여 다른 봉사기에 Layer를 요청하고 자기의 요구에 부합되는 지도를 만들 어낼수 있다. 사용자는 자기의 자료를 WMS지도봉사나 직접 WMS원천을 리용하여 발포 할수 있다. 또한 서로 다른 요청을 발송하여 타일을 내리적재할수 있다. 자기의 자료를 GoogleMap의 자료와 1：1 대응시킨다. 자료를 요청할 때 변수를 입력하여 자료의 범위를 조종하여야 한다. 이때 병합하려는 자료는 WMS를 접수한다. 원래의 자료가 Shape화일이 면 ArcGIS Server나 MapServer를 리용하여 WMS로 발포한다. WMS가 URL뒤에 일부 변수 를 추가하면 원하는 그림이 반환된다. WMS의 URL은 아래와 같다. http://192.168.1.1:8080/geoserver/wms?bbox=－20037508.342789244, 20037508.342789244, 2003 7508.342789244, 20037508.342789244&request=GetMap&version=1.1.1&layers=topo:road&width= 256&height=256&srs=EPSG:900913. 여기서 WMS는 GeoServer로 발포한것이며 bbox는 지도의 테두리범위, GetMap는 귀환값의 류형이다. Layers는 층모임이며 width, height는 그림의 크기, srs는 자리표계이다. GoogleMap와 병합하려면 자리표계는 반드시 EPSG:900913이여야 하며 그림의 크기는 256×256 pixel이여야 한다. 먼저 지도의 경계범위와 수준범위를 매 수준의 타일자리표모 임으로 변환하고 타일의 자리표값 및 타일이 속하는 수준의 척도에 따라 이 타일경계값 의 투영자리표(좌하, 우상의 자리표값)를 생성하고 이 경계투영자리표에 기초하여 봉사기 에 그림을 요청한다. － 126 － GoogleMap에 기초한 공간자료정합에 대한 연구 맺 는 말 사용자의 자료를 WMS로 발포하고 메카토르투영에 따라 화상을 나눈 다음 GoogleMap 와 정합하는 방식을 제기하였다. GoogleMap와 정합할뿐아니라 이 분할방식은 GoogleMap 에 의존하지 않고 의뢰기에 의하여 직접 자체의 지도봉사를 할수 있다. [1] 종합대학학보(자연과학), 54, 6, 146, 주체97(2008). 참 고 문 헌 주체104(2015)년 3월 5일 원고접수 GoogleMap-based Spatial Data Integration Ri Kum Su, Kim Song Min and Pak Jong Ho We presented the method to integrate the WMS and GoogleMap. According to the analysis of the projection and architecture of GoogleMap, this method tiled the WMS, and then merged the two correspondent tiles between GoogleMap and WMS. Key words: WebGIS, Google Map － 127 －