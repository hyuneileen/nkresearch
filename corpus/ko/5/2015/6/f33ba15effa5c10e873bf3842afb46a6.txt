김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체104(2015)년 제61권 제6호 Vol. 61 No. 6  JUCHE104(2015). 분산형조종체계에서 다중Siemens PLC들과의 동시통신실현의 한가지 방법 김명일, 김남혁, 배 혁 개별적인 PLC들로 구성되는 큰 규모의 분산형조종체계에서 PLC들과의 통신을 실시간 적으로 보장하는것은 감시조종체계실현에서 필수적인 문제로 나선다.[1, 2] 이를 위하여 각종 PLC에는 전용통신엔진들이 제공된다. 공정감시조종체계에서 많이 리 용되고있는 PLC의 한가지 류형인 Siemens PLC도 OPCSiemensDAAutomation라고 부르는 COM 형식의 Ethernet통신엔진을 제공하고있다. 그러나 이 통신엔진은 통신선로들에 지연이 거의 없다는 가정하에서 개발된것으로 하 여 무선망과 같이 통신에 지연이 있으며 동시통신하는 PLC의 수가 수십개로 늘어나는 경 우에 성능이 대단히 떨어져 전반적인 통신이 거의 불가능하게 된다. 그러므로 이러한 경우에 PLC들과의 동시통신을 원만히 보장할수 있는 새로운 통신엔 진개발요구가 필수적으로 제기된다. １．Siemens PLC의 Ethernet통신규약해석 통신엔진을 개발하는데서 선차적으로 나서는 문제는 Siemens PLC의 Ethernet통신규약 을 정확히 해석하는것인데 이것은 EtherReal과 같은 파케트해석프로그람들로 기존통신엔진 에 의한 PLC와의 통신파케트들을 분석하여 진행한다. PLC와의 통신은 PLC를 봉사기로 하고 접속프로그람을 의뢰기로 하는 봉사기－의뢰기 형 TCP통신으로서 접속프로그람이 먼저 PLC에 접속요청을 보내고 그 이후 3차례에 걸치 는 접속정보교환을 통하여 접속을 확립한다. 접속이 성공하면 의뢰기에서 봉사기에 자료요청통보문을 보내는데 여기에는 등록기읽 기요청과 등록기쓰기요청통보가 있다. 봉사기는 읽기요청통보문을 받으면 통보문을 해석하고 해당 주소의 등록기값을 얻어 서 대응하는 읽기응답통보문을 만들어 의뢰기에 전송한다. 만일 쓰기요청통보문을 받으면 해당 등록기에 요청한 값을 쓰고 쓰기응답통보문을 만 들어 의뢰기에 전송한다. Siemens PLC의 VB100등록기자료읽기요청통보문 실례는 그림 1과 같다. 그림 1. Siemens PLC의 VB100등록기자료읽기요청통보문 실례 － 34 － 분산형조종체계에서 다중Siemens PLC들과의 동시통신실현의 한가지 방법 ①은 2Byte크기의 통보문표식자로서 PLC의 TCP통신자료부 머리부에 항상 놓인다. ②는 2Byte크기의 자료부길이마당으로서 전체 길이가 31Byte임을 나타낸다. ③은 머리부식별자로서 값이 02 f0 80 32로 고정되여있는 마당이다. ④는 요청/응답을 나타내는 마당으로서 01은 요청을, 03은 응답을 가리킨다. ⑤는 4Byte크기의 전송식별자이다. 이 식별자는 의뢰기의 새로운 자료요청에 의하여 1씩 증가하는데 의뢰기와 봉사기사 이의 자료송수신의 동기화를 위하여 리용된다. ⑥은 요청자료에서 실제 등록기자료의 크기를 나타내는데 마당⑧부터 마지막 마당까 지의 바이트크기를 나타낸다. ⑦은 자료읽기파케트로서 언제나 00 00을 가리킨다. ⑧은 자료읽기인가 쓰기인가를 나타내는 마당으로서 04이면 읽기를, 05이면 쓰기를 가 리킨다. ⑨는 읽으려는 등록기개수를 나타낸다. 이 마당의 값(현재는 1)에 따라 다음에 놓이는 등록기정보항목의 수가 결정된다. ⑩－⑬까지의 4개마당(12Byte)은 읽으려는 등록기의 정 보마당들로서 ⑨의 값만큼 반복되여 놓인다. ⑩, ⑫는 등록기정보식별자로서 등록기형(현재 VB)에 따라 차이난다. ⑪은 해당 등록기의 자료크기를 바이트수(현재 1Byte)로 나타낸다. ⑬은 해당 등록기의 주소(현재 100)에 8을 곱한값이다. 이러한 읽기요청에 대응하여 PLC가 보내는 응답통보문은 그림 2와 같다. 그림 2. Siemens PLC의 VB100등록기자료읽기응답통보문의 실례 ①－⑤는 요청통보문의 경우와 같다. ⑥은 응답통보문에서 언제나 00 02이다. ⑦은 실제 등록기값정보의 크기로서 마당 ⑪부터 마지막 마당까지의 자료크기를 바이 트수로 나타낸다. ⑧은 응답통보문에서 언제나 00 00이다. ⑨는 자료읽기인가 쓰기인가를 나타낸다. ⑩은 응답하는 등록기값의 개수(현재 1개)를 나타낸다. ⑪은 등록기값정보식별자이다. ⑫는 등록기값의 자료형을 의미하는데 08인 경우 VB, 10인 경우 VW, 20인 경우 VD 를 의미하며 05인 경우 T등록기값들임을 각각 의미한다. ⑬은 해당 등록기의 값을 나타내는데 ⑫의 값에 의하여 길이가 결정된다. 자료쓰기요청 및 응답통보문도 자료읽기통보문과 비슷하지만 요청통보문에서 등록기 정보에 쓰려는 값정보를 추가한다는 점과 응답통보문에서는 쓰기결과(성공 혹은 실패)가  있다는 점에서 차이난다. － 35 － 종합대학학보(자연과학)   주체104(2015)년  제61권  제6호 진다. ２．새로운 Ethernet통신엔진을 리용한 다중PLC들과의 동시통신실현 우와 같이 자료읽기/쓰기통보문의 구조를 해석한데 기초하여 Siemens PLC와의 Ethernet 통신을 실현하기 위한 통신엔진클라스(CSEtherComEngine)를 개발하였다. 클라스에는 엔진을 초기화하기 위한 InitEngine, PLC에로의 접속을 위한 ConnectPLC, 통 신하려는 등록기들을 추가 및 삭제하기 위한 AddItem과 RemoveItem, 자료의 읽기/쓰기요청 통보문을 해당한 형식으로 만들어 전송하기 위한 ReadItems와 WriteItems 그리고 PLC에서 전 송하는 응답통보문을 해석하여 처리하기 위한 DisposeReceive 등 여러 함수들을 정의하 였다. 이렇게 구성된 통신엔진클라스를 리용한 상위의 종합감시조종봉사기프로그람은 60대 의 전해로조종반의 Siemens PLC들과 실시간적인 Ethernet통신을 진행하면서 동작한다. 조종실로부터 현장으로의 배선조건이 불리한것으로 하여 이러한 Ethernet통신은 무선 중계기들에 의하여 진행되는데 여러가지 요인으로부터 이 무선망에는 순간적인 지연이 생 기게 된다. 매 PLC에는 이러한 통신을 위하여 Ethernet통신모듈이 추가되여 해당한 IP주소를 가 봉사기는 PLC에서 로전압, 로양극전동기회전정보 등을 읽고 계렬전류, 로온도추정값, 로 상태진단결과와 같은 정보들을 쓰게 된다. 통신부는 2개의 스레드가 호상협동하면서 실현된다. 첫 스레드는 PLC접속스레드이고 두번째 스레드는 자료송수신스레드이다. PLC접속스레드는 60대의 PLC들중 비접속상태인 PLC들에 차례로 ping지령을 보내여 접 속가능성을 확인한다. 만일 ping지령이 성공하면 해당 PLC의 접속가능성을 설정한다. ping 지령이 실패하면 해당 PLC와의 접속을 일정한 시간 보류한다. 자료송수신스레드에서 통신엔진객체들이 접속스레드의 검사에 의하여 접속가능하게 된 PLC들과의 접속을 진행하고 자료송수신을 시작한다. 만일 접속이나 자료송수신에서 일정한 시간동안 응답이 없으면 PLC의 상태를 비접속 상태로 설정하고 PLC접속스레드의 처리에 맡긴다. 이렇게 통신부를 다중스레드화함으로써 일부 PLC들과의 접속중단으로 생기던 통신지 연을 줄이고 많은 PLC들과의 통신에서 실시간성을 보장할수 있게 되였다. CPU 3GHz, RAM 2GB인 콤퓨터에서 이전의 OPCSiemensDAAutomation부분품을 리용하 여 60대의 PLC들과 동시통신할 때 평균 10s정도의 통신지연이 생겼다. 한편 새로운 통신부를 리용하여 동시통신을 진행한 결과 평균 100ms, 최대 500ms의 통 이처럼 새로운 통신엔진을 리용한 통신부는 높은 통신성능을 담보함으로써 많은 PLC 들과의 동시통신에서 공정의 실시간감시조종을 위한 요구를 원만히 만족시키도록 하 신지연이 나타났다. 였다. － 36 － 분산형조종체계에서 다중Siemens PLC들과의 동시통신실현의 한가지 방법 맺 는 말 Siemens PLC의 Ethernet통신규약을 해석한데 기초하여 새로운 통신엔진을 작성하고 다 중스레드화에 의한 통신부를 새롭게 실현함으로써 알루미니움전해공정 조종체계에서 생기 던 종래의 통신지연문제를 원만히 해결하였다. [1] 종합대학학보(자연과학), 55, 6, 66, 주체98(2009). 참 고 문 헌 [2] S. Tarbouriech et al.; Advances in Communication Control Networks, Springer, 295～310, 2004. 주체104(2015)년 2월 5일 원고접수 A Method to Implement a Concurrent Communication to Multiple Siemens PLCs in Distributed Control System Kim Myong Il, Kim Nam Hyok and Pae Hyok We described that we analyzed the ethernet communication protocol of Siemens PLCs, made a new communication engine on the basis of it, newly implemented the communication module by multiple threading and satisfactorily solved the previous communication delay problem in control system of the aluminium electrolysis process. Key words: concurrent communication, aluminium electrolusis process, multiple threading － 37 －