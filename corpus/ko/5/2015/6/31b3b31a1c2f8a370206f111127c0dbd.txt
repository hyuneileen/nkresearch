김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체104(2015)년 제61권 제6호 Vol. 61 No. 6  JUCHE104(2015). FPGA를 리용한 Nios II체계구축의 한가지 방법 김 운 봉 매몰형체계는 고정된 하드웨어와 쏘프트웨어를 결합하여 특정한 기능과 임무를 완성 하도록 구성된 전문적인 콤퓨터체계로서 지난 시기 ARM처리기를 비롯하여 규정된 성능의 처리기를 리용하여 매몰형체계를 구축[1, 2]하였는데 이것은 유연성이 결핍되는 치명적인 약 점을 가지고있다. 현재 FPGA의 발전과 함께 유연성이 풍부한 쏘프트처리기를 리용한 매몰형체계를 FPGA 로 실현하기 위한 연구가 활발히 진행되고있다. 론문에서는 Cyclon II FPGA를 리용하여 Nios II하드웨어와 쏘프트웨어를 구축하는 한 가지 방법을 제안하고 해결하였다. 먼저 Nios II체계를 구축하기 위한 장치구성에 대하여 보자. 장치구성에서 중요한 문제는 실현될 Nios II체계의 성능을 규정하는것인데 이러한 체 계성능은 체계요구에 의하여 규정된다. 여기서는 RS-232결합장치와 입력장치, 표시출력장 치를 가지는 매몰형체계를 FPGA로 실현한다. 이를 위해 Nios II체계를 구축할수 있는 FPGA 로서 Cyclon II를, 기억기로서 8MB SDRAM과 16Mb FLASH를 선택한다. 입력장치는 5개의 건반으로 구성되며 표시장치는 6개의 쪼각표시소자로 구성된다. 그리고 LCD현시장치는 128 ×64 LCD로 구성된다. 이에 기초하여 구성된 Nios II체계를 구축하기 위한 장치체계구성도는 그림 1과 같다. 다음으로 FPGA로 실현할 Nios II체계의 하 드웨어와 쏘프트웨어에 대하여 보자. 먼저 Nios II체계의 하드웨어는 SOPC Builder 를 리용하여 구축하는데 이때 Nios II체계의 매 구 성성분들에 대한 요구를 명백히 설정하여야 한다. Nios II체계에서 가장 중요한 구성성분은 쏘 프트처리기인데 이것은 32bit의 자료처리폭과 4kB 의 명령캐쉬 및 자료캐쉬, JTAG검사대면부를 가 진 RISC형 Nios II처리기로서 Avalon마스터포구 로 구성한다. 그림 1. 장치체계구성도 다음 구성성분은 FLASH기억기와 SDRAM대면부이다.  FLASH기억기는 Nios II체계가 FPGA에 련결되는 EPCS직렬구성장치를 호출할수 있 는 EPCS직렬흘래쉬조종기포구로서 Avalon슬레브포구로 구성한다. SDRAM은 동적기 억기로서 정적기억기와는 달리 기억재생을 비롯하여 보다 복잡한 기억기조종이 필요 － 22 － FPGA를 리용한 Nios II체계구축의 한가지 방법 된다. 따라서 SDRAM대면부는 12bit의 주소선과 행 및 렬선택주소선, 16bit의 자료선과 기타 기억재생조종신호선들을 가진 Avalon슬레브포구로 구성한다. 다음 UART대면부는 8bit의 자료비트수와 115 200보드속도를 가진 UART포구로서 Avalon 슬레브포구로 구성한다. 다음 LED대면부는 4bit출력PIO포구로, LCD대면부는 4bit출력PIO포구로, 건반대면부는 5bit입력PIO포구로서 Avalon슬레브포구로 구성한다. 이에 기초하여 SOPC Builder에 의하여 구축된 Nios II체계의 하드웨어구성도는 그림 2 와 같다. 그림 2에서 매 구성성분들은 Avalon호상련결대면 부를 통하여 접속된다. 그리고 Nios II체계는 기억기 와 주변장치의 주소공간이 단일하므로 Nios II하드웨 어체계를 구축할 때 마지막에 매 성분에 기억주소를 할 당한다. 다음으로 구축된 Nios II하드웨어기반에서 실행 될 Nios II프로그람에 대하여 보자. Nios II프로그람은 장치구동프로그람, 머리부화일, Main함수로 이루어진다. 그림 2. Nios II하드웨어구성도 장치구동프로그람은 UART조종프로그람 uart.c, LCD구동프로그람 lcd.c로 구성된다. UART조종프로그람은 초기화함수, 새치기함수, 자료송신함수, 보드속도설정함수로 구 성된다. 초기화함수 Uart_init()는 보드속도의 설정, 상태 및 조종등록기의 초기화를 진행하 며 새치기를 설정한다. 새치기함수 Uart_ISR()는 호스트로부터 COM포구에로의 자료전송이 있는 경우 즉 수신때 실행되는 함수로서 ‘\n’문자를 입력받을 때까지 모든 문자를 완충기 에 보관한다. 이때 uart상태등록기의 TRDY기발이 1로 설정되면 1Byte의 자료가 전송되였 다는것을 의미하며 이를 리용하여 1Byte씩 완충기에 추가한다. 자료송신함수 Send_byte(), Send_string()는 uart포구의 송신완충기에 자료를 넣는것으로 자료전송을 진행한다. 전송여부는 상태등록기의 TRDY기발로서 검사한다. 보드속도설정함수 Set_baudrate()는 uart포구의 divisor등록기의 내용을 변경시키는 방법으로 보드속도의 재설정을 진행한다. 한편 LCD구동프로그람 lcd.c는 초기화함수, 자료쓰기함수, 명령쓰기함수, 자료전송함 수, LCD현시함수 등으로 구성된다. 초기화함수 Initialize_lcd()는 LCD에 대한 각종 정보들을 설정하는 함수이다. 그리고 자 료쓰기함수 Write_data()는 LCD_A0포구로 1을 전송하여 전송된 자료가 자료바이트임을 통 지하고 data_send()함수로 자료를 전송한다. 명령쓰기함수 Write_command()는 LCD_A0포구 로 0을 전송하여 전송된 자료가 명령임을 통지하고 data_send()함수로 명령을 전송한다. 자료전송함수 Data_send()는 LCD_CS포구에 0을 내보내여 LCD를 선택하고 LCD_SCL 로 박자를 내보내여 오름면에서 1bit씩 자료를 전송한다. 이때 매 웃비트는 LCD_SI로 전 － 23 － 종합대학학보(자연과학)   주체104(2015)년  제61권  제6호 송한다. LCD현시함수 Draw_Item()는 USB로부터 읽은 화일 및 등록부이름을 LCD에  현시하는 기능을 수행한다. 머리부화일들은 uart조종대면선언부화일 uart.h, lcd조종대면선언부화일 lcd.h, SOPC정보 머리부화일 sopc.h로 구성된다. 장치구동프로그람과 머리부화일이 결합되여 장치와의 대면을 이룬다. Main함수는 Application main()함수를 포함하는 main.c로 구성되여있다. 이 main()함수에 서 모든 조작 즉 건반새치기처리, LCD현시처리, COM포구와의 자료전송 등을 진행한다. 기본응용프로그람부분인 main.c에는 LCD를 리용한 현시, 건반을 통한 화일 및 자료들 의 선택, 선택된 자료들의 UART포구를 통한 PC에로의 전송, PC로부터 전송되는 화일을 보 관하는 기능을 수행하는 함수들로 구성되여있다. 한편 다음의 부분함수들의 실행에 의해 건반, LCD, UART포구에 대한 초기화를 진행 하고 자료송신 및 수신지령에 맞게 자료의 송수신을 진행한다. Update_screen()함수는 읽은 화일 및 등록부자료를 LCD화면에 현시하는 기능을 수행 한다. 관하는 기능을 수행한다. 에 전송하는 기능을 수행한다. 행하는 함수이다. Host()함수는 지적된 경로안의 화일 및 등록부들의 이름을 읽어서 pFilePath_Dis안에 보 File_write()함수는 PC로부터 보내여진 화일을 보관하는 함수이다. ISR_OK()함수는 ok건반을 눌렀을 때의 처리 다시말하여 선택된 화일을 COM포구로 PC ISR_UP(), ISR_DOWN()함수는 down, up건반을 눌렀을 때 화일 및 등록부의 선택을 진 Init_key()함수는 건반새치기에 대한 초기화를 진행하는 함수이다. Nios II프로그람은 C로 작성하여 개발환경 eclipse에서 기계번역하였으며 Nios II하드웨 어2진정보화일을 FPGA에 내리적재하여 하드웨어가 구축된 기반에서 실행하였다. Cyclon II FPGA를 리용하여 Nios II 매몰형체계를 구축하고 외부장치들인 건반, LCD, SEG 와 RS-232결합장치와의 대면을 실현하여 상위콤퓨터와의 직렬통신을 실현하였다. 맺 는 말 참 고 문 헌 [1] 李和平; 吉首大学学报，7，66, 2012. [2] 台述鹏 等; Microcontrollers & Embedded System, 8, 30, 2012. 주체104(2015)년 2월 5일 원고접수 － 24 － FPGA를 리용한 Nios II체계구축의 한가지 방법 A Method Building Nios II System using FPGA Kim Un Bong Last time the embedded system which carried out function for special use has been built using hardware fixed processor including ARM processor. Such system has a mortal weak point lacked softness because of building embedded system by selecting processor with the object. In this paper, we proposed and solved a method building softprocessor system with Nios II system by using Cyclon II FPGA. Key words: FPGA, embedded system － 25 －