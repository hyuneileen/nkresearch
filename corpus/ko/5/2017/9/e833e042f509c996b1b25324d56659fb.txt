김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체106(2017)년 제63권 제9호 Vol. 63 No. 9  JUCHE106(2017). SIP를 리용한 화일전송용 대화확립실현의 한가지 방법 승철범, 최혁철 경애하는 최고령도자 동지께서는 다음과 같이 말씀하시였다. 《정보기술, 나노기술, 생물공학을 비롯한 핵심기초기술과 새 재료기술, 새 에네르기기술, 우주기술, 핵기술과 같은 중심적이고 견인력이 강한 과학기술분야를 주타격방향으로 정하고 힘을 집중하여야 합니다.》(《조선로동당 제7차대회에서 한 중앙위원회사업총화보고》 단행본 39페지) SIP(Session Initiation Protocol)는 하나 또는 그 이상의 대상을 포함하는 대화를 창조하 고 변경하며 종결하는 응용층조종규약이다.[1] IP다매체통신에서 광범하게 리용되는 SIP는 음성과 영상, 문자형식의 매체통신을 위한 대화를 확립하고 조종하기 위한 많은 요청과 응답, 본체형식들을 정의하고있다. SIP는 SDP(Session Description Protocol)로 서술된 대화정보를 INVITE요청과 200 OK응 답의 본체에 담아 전송함으로써 매체의 형태와 리용가능성, 매체파케트들이 송신되여야 할 주소를 교환하여 음성 및 영상대화를 확립한다.[2, 3] 음성 및 영상대화확립을 위한 INVITE요청통보문의 실례는 다음과 같다. INVITE sip:bob@biloxi.com SIP/2.0 Via: SIP/2.0/UDP pc33.atlanta.com;branch=z9hG4bKnashds8 To: Bob <bob@biloxi.com> From: Alice <alice@atlanta.com>;tag=1928301774 Call-ID: a84b4c76e66710 CSeq: 314159 INVITE Max-Forwards: 70 Date: Thu, 21 Feb 2002 13:02:03 GMT Contact: <sip:alice@pc33.atlanta.com> Content-Type: application/sdp Content-Length: 147  v=0 o=UserA 2890844526 2890844526 IN IP4 here.com s=Session SDP c=IN IP4 pc33.atlanta.com t=0  m=audio 49172 RTP/AVP 0 a=rtpmap:0 PCMU/8000 m=video 23422 RTP/AVP 31 a=rtpmap:31 H264/90000 한편 SIP는 MESSAGE요청을 리용하여 사용자들사이의 IM통신을 진행할수 있게 한다. SIP를 리용한 화일전송용 대화확립실현의 한가지 방법 － 37 － MESSAGE요청통보문의 실례는 다음과 같다. MESSAGE sip:editor@rcs.org SIP/2.0 Via: SIP/2.0/UDP lab.chemistry.org:5060;branch=z9hG4Bk3 Max-Forwards:70 To: <editor@rcs.org> From: “Chemistry”<periodic@chemistry.org>;tag=1865 Call-ID: 933759394753 CSeq: 3432 MESSAGE Contact:<sip:periodic@lab.chemistry.org> Content-Type: text/plain Content-Length: 6  Hello! SIP는 매우 간단한 본문기반의 응용층호출조종규약으로서 말단(사용자)들사이에 대화 를 확립하고 그 조종을 진행하기 위해 제안되였으며 VoIP봉사뿐만아니라 다른 봉사형태들 에서도 리용할수 있으며 전송층규약에는 의존하지 않는다. 우의 분석으로부터 다음과 같은 결론을 얻게 되였다. 음성과 영상, 본문자료들을 통신하기 위한 점대점(P2P)실시간통신체계들에서 대화를 확 립하기 위한 규약으로서 SIP를 리용하는것이 보편화되고있지만 FTP와 같은 표준화일전송 규약들은 이와는 독립으로 의뢰기－봉사기모형(CS)에 기초하여 제안되였으므로 P2P통신에 서 화일전송을 진행하려면 화일전송대화확립을 위한 규약을 새롭게 구현하여야 한다. SIP를 리용한 통신체계에서 새로운 규약을 정의하고 삽입하는것은 체계설계와 프로그 람작성의 복잡성을 증대시킨다. 이로부터 론문에서는 SIP를 리용하여 말단들사이에 화일전송을 위한 대화확립과 조종 을 진행하기 위한 한가지 방법을 제안하려고 한다. １．SIP를 리용한 실시간화일전송대화확립 두 말단사이의 화일전송대화확립을 위한 SIP의 동작과정은 본질상 음성통신을 위한 대 화확립과정과 같다. 말단1은 말단2를 호출하기 위하여 SIP INVITE통보문을 전송한다. 이때 SIP통보문본체 는 화일전송대화확립에 필요한 대화정보를 서술한다. 말단2에서는 INVITE통보문을 접수한 다음 통보문에 서술되여있는 대화정보를 분석하 고 통신에 필요한 준비를 갖춘 다음 화일전송에 리용할 자기의 IP주소와 포구번호를 반영 하여 200 OK응답을 대리봉사기2에 보낸다. 말단1은 200 OK응답을 받으면 수신자가 화일전 송대화를 확립할 준비가 되였음을 알게 되며 따라서 대화가 확립되여 화일전송을 시작한다. ２．실시간화일전송대화확립을 위한 SIP통보문의 문법설계 SIP통보문은 본문형식에 기초하고있으며 시작행과 하나 또는 그 이상의 머리부마당, 머 리부의 끝을 표시하는 하나의 빈행, 하나의 선택적인 통보문본체로 구성한다. ① 머리부 실시간화일전송대화확립에 적용되는 SIP통보문을 다음의 실례를 통하여 보기로 한다. － 38 － 종합대학학보(자연과학)   주체106(2017)년  제63권  제9호 화일전송대화확립요청통보문 INVITE sip:user1@proxy1.com SIP/2.0  Via: SIP/2.0/UDP user1.com;branch=z9hG4bK776asdhds  To: User2 <sip:user2@proxy2.com>  From: User1 <sip:user1@proxy1.com>;tag=1928301774  Call-ID: a84b4c76e66710@user1.com  CSeq: 314159 INVITE  Contact: sip:user1@user1.com Max-Forwards: 70 Content-Type: text/plain Content-Length: 142 (본체)  요청통보문에 대응하는 최종적인 응답통보문 SIP/2.0 200 OK  Via: SIP/2.0/UDP proxy2.com;branch=z9hG4bKnashds8;received=192.0.2.3  Via: SIP/2.0/UDP proxy1.com;branch=z9hG4bK77ef4c2312983.1;received=192.0.2.2  Via: SIP/2.0/UDP user1.com;branch=z9hG4bK776asdhds;received=192.0.2.1 To: User2 <sip:user2@proxy2.com>;tag=a6c85cf  From: User1 <sip:user1@proxy1.com>;tag=1928301774  Call-ID: a84b4c76e66710@user1.com  CSeq: 314159 INVITE  Contact: <sip:user2@192.0.2.4>  Content-Type: text/plain  Content-Length: 131 (본체)  우에서 보는바와 같은 화일전송대화확립에 리용되는 요청통보문과 응답통보문은 음성 대화확립을 위한 통보문과 기본상 구조가 같으며 Content-Type로서 text/plain을 리용한다. ② 본체 화일전송대화를 확립하기 위하여 필요한 송신측의 대화정보를 INVITE통보문의 본체 에 담아 전송한다. 우선 송신측 본체정보는 다음과 같다. fname=화일이름 fsize=화일크기 local_tcp=국부주소:국부포구 (TCP통신에서 리용) local_udp=국부주소:국부포구 (UDP통신에서 리용) public_udp=대역주소:대역포구 (UDP통신에서 리용)  local_tcp는 화일송신에 쓰이는 TCP접속을 위한 국부IP주소와 포구번호이다. 송신자는 대 화가 확립되면 먼저 이 주소로부터 수신자에게로의 접속을 시도하며 접속이 성공하면 화 일송신을 진행한다. local_udp는 TCP접속이 실패한 경우 리용할 UDP통신을 위한 국부IP주소와 포구번호이 다. 송신자는 local_tcp를 리용한 접속이 실패하면 이 주소를 리용하여 수신자의 local_udp 로 자료송신을 시도한다. SIP를 리용한 화일전송용 대화확립실현의 한가지 방법 － 39 － public_udp는 말단이 NAT뒤에 있는 경우 local_udp와 mapping된 대역주소이다. public_udp 는 STUN 등을 리용하여 알아낼수 있으며 말단이 NAT뒤에 있지 않는 경우 local_udp와 같다. 말단이 NAT뒤에 있다고 판정되고 local_udp를 리용한 자료송신이 실패하는 경우에는 수 신자의 public_udp로 자료송신을 시도한다. 만일 public_udp를 리용한 자료송신까지 실패하는 경우 화일전송은 실패하며 대화는 해 제된다. 다음 수신측 본체정보는 다음과 같다. 수신측은 INVITE요청을 수신한 후 화일송수신을 위한 자기의 주소정보들을 200 OK 응답통보문에 담아 전송한다. local_tcp=국부주소:국부포구 (TCP통신에서 리용) local_udp=국부주소:국부포구 (UDP통신에서 리용) public_udp=대역주소:대역포구 (UDP통신에서 리용) local_tcp, local_udp, public_udp의 의미는 송신측과 같다. 수신자는 INVITE통보문을 받으면 STUN 등을 리용하여 public_udp를 알아내며 local_tcp 로 bind하여 접속을 대기하고 local_udp로 자료가 수신되기를 대기한다. local_tcp와 local_udp중 어느 하나로 자료를 접수하면 다른 주소에서의 대기를 해제하 며 자료를 접수한 주소에서 통신을 진행한다. 맺 는 말 SIP규약을 리용하는 P2P통신에서 실시간적인 화일전송을 실현하기 위하여 두 말단사 이 화일전송대화를 확립하고 조종하기 위한 규약을 정의하고 실현알고리듬을 제안함으로 써 SIP기반의 통신체계에서 화일전송을 실현할수 있게 하였다. 참 고 문 헌 [1] 문일남 등; 인터네트다매체통신규약 SIP, 공업출판사, 50～75, 주체103(2014). [2] J. Rosenberg et al.; RFC 3261, 2002. [3] J. Reynolds; RFC 959, 1985. 주체106(2017)년 5월 5일 원고접수 A Method for Establishing File Transfer Session using SIP Protocol Sung Chol Bom, Choe Hyok Chol We defined real-time file transfer protocol of Peer-to-Peer communication based on SIP protocol and proposed an algorithm for its implementation. Key words: SIP, FTP, P2P