김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체106(2017)년 제63권 제6호 Vol. 63 No. 6  JUCHE106(2017). FPGA를 리용한 수자식핵스펙트르측정방법 강호, 송용혁 핵정보를 얻고 처리하는것은 기초과학연구와 응용과학연구에서 중요한 의의를 가진다. 핵스펙트르메터는 방사선의 에네르기정보를 얻는 기본장치이다. 지난 시기에는 A/D변환기 와 수자신호처리장치에서 제한을 받는것으로 하여 핵스펙트르메터가 상사임풀스신호봉우 리값을 검출하고 상사수자변환하는 상사식핵스펙트르메터였다. 최근 A/D변환기의 속도가 높 아지고 수자신호처리기술이 비약적으로 발전하는데 따라 앞단의 임풀스신호를 직접 받아 수 자신호처리를 하여 임풀스진폭측정 및 분석을 진행하는 수자화된 핵스펙트르메터들이 개 발되였다. 우리는 광대역고속집적회로연산증폭기와 흐름관식A/D변환기, 론리조종 및 자료처리가 일체화된 FPGA를 리용하여 수자식핵스펙트르를 측정하는 방법을 고찰하였다. １．수자식핵스펙트르측정원리와 요구 방사선은 검출기속에서 자기 에네르기의 전부 또는 일부를 잃는다. 검출기와 련결된 예 비증폭기에서 생긴 전압 또는 전류임풀스는 A/D변환기에 공급되기 전에 적당히 증폭, 성 형된다. 그다음 A/D변환기수자화표본점자료들을 FPGA가 읽어들인 후 매개 임풀스표본점 들을 곡선맞추기하여 곡선의 극대값이 대응하는 임풀스의 진폭으로 되게 한다. FPGA는 각 이한 에네르기에 대응하는 각이한 임풀스진폭들에 대해 통계분석을 진행하여 미분기구선 스펙트르를 얻으며 다시 직렬포구를 거쳐 콤퓨터에 보내여 처리를 더 진행한다. 통계오차를 감소시키려면 매개의 임풀스에 대한 표본점이 많을수록 좋다. 매개의 임풀 스에 대한 표본점개수를 증가시키기 위하여서는 A/D변환기의 동작속도가 높아야 한다. 또 한 스펙트르자료의 통로수가 많을수록 한번에 분석하는 원소의 종류가 많아지므로 다원소 분석을 하기 위해서는 A/D변환기분해능이 높을수록 좋다.[1] 수자식핵스펙트르메터는 수μs 의 좁은 임풀스신호를 처리할 능력을 가져야 하므로 A/D변환기표본채취속도가 최대한 커 야 하고 동특성대역이 최대한 넓은 집적회로연산증폭기를 선택하여야 하며 A/D변환기입구 에 차동입구형연산증폭기를 리용하는것이 좋다.[2] 우리는 연산증폭기 AD8004, 차동증폭기 AD8138, A/D변환기 AD9244, FPGA CycloneII계렬을 리용하여 우의 조건을 충분히 만족시 키는 회로를 구성하였다. ２．출구임풀스의 곡선맞추기방법 곡선맞추기방법은 임풀스진폭을 얻는 한가지 방법이며 본질상 통계자료속에서 평균값 을 찾는 과정이다. 전압임풀스 u의 하강면곡선방정식은 다음과 같다. y ⋅= btea (1) － 86 － 종합대학학보(자연과학)   주체106(2017)년  제63권  제6호 여기서 y는 임풀스의 진폭, t는 표본점시간, a와 b는 임풀스의 모양을 결정하는 곁수들이다. 곁수 a와 b의 값은 회귀분석방법과 표본점자료의 곡선맞추기에 의하여 구할수 있다. 수 자화한 후의 전압임풀스 u의 표본점진폭값들을 각각 y = y0, y1, y2, …, ym－1이라고 하고 여 기에 표본점시간렬 t = 0, 1, 2,…, m－1을 대응시킨다. 식 (1)의 량변에 로그를 취하면 ln y = ln a + bt .              (2) 식 (2)에 곡선맞추기한 b와 a는 다음과 같다. ⎡ ⎢ ⎢ ⎣ m 1 1 m m − − ∑ ∑ i ln 0 0 i i 1 m − ∑ im 0 i = ⎞ ⎟ ⎟ ⎠ ⎛ ⎜ ⎜ ⎝ ln − = b y y m = = i i 1 m − ∑ im 0 i = 2 − ⎛ ⎜ ⎜ ⎝ 1 m − ∑ i 0 i = ⎞ ⎟ ⎟ ⎠ 2 ⎤ ⎥ ⎥ ⎦ a = ⎛ ⎜ exp ⎜ ⎝ 1 m 1 − ln ∑ i = 0 y i − b m 1 − i ∑ i = 0 ⎞ ⎟ ⎟ ⎠ (3) (4) FPGA의 내부CPU의 연산능력이 제한되여있으므로 연산시간을 감소시키기 위하여 표 검사법에 의한 계산을 적용하였다.[3] 자료는 표와 같다. 주어진 임풀스에 대하여 곡선맞추기를 하였을 때와 하지 않았을 때의 측정값의 대비 표．곡선맞추기에 의한 측정값대비자료 No. 통로번호 1 2 3 4 5 6 7 평균값 1 000 1 000 1 000 1 000 1 000 1 000 1 000 곡선맞추기를 한 자료 곡선맞추기를 하지 않은 자료 측정값 1 008 999 1 007 1 012 1 011 1 000 1 020 1 009 측정값 933 967 1000 997 1006 953 991 975 오차 1.0 10.0 2.0 3.2 1.7 0 11.0 4.2 오차 42 8 0 22 31 22 16 20.1 곡선맞추기를 하였을 때와 하지 않았을 때 측정값의 상대편차는 각각 0.42, 2.1%로서 정 확도가 5배 개선되였다. ３．수자식핵스펙트르메터를 리용한 55Fe원천의 에네르기스펙트르측정 수자식핵스펙트르메터에서는 상사식핵스펙트르메터에서 회로적으로 진행하는 성형려파, 실시간기록, 봉우리검출, 임풀스겹침제거, 기준선회복 등의 기능을 FPGA가 수행한다.[3, 4] QuartusII응용프로그람을 리용하여 설계한 검출기신호의 실시간기록론리도는 그림 1과 같다. Pipe부분블로크는 자료지연통로이고 Pipe의 Q단자출구자료는 Da단자입구자료보다 수 십ns정도 지연되며 이것은 Pipe의 DelayTime단자의 자료에 의하여 결정된다. Pipe의 RdEn 단자가 1일 때 Q단자출구가 유효로 된다. Pipe의 RdEn단자와 WriteEnable 부분블로크가 결 합되여 검출기신호를 기록한다. Pipe의 En단자는 Pipe부분블로크의 조종단자로서 En이 0일 때 동작을 시작한다. FPGA를 리용한 수자식핵스펙트르측정방법 － 87 － 그림 1. 검출기신호의 실시간기록론리도 WriteEnable부분블로크는 임풀스채취기능을 수행한다. WriteEnable의 wEn출구와 Pipe부 분블로크가 결합되여 임풀스를 실시간기록한다. LengthCounter부분블로크는 매개 임풀스의 표 본점길이를 기록하는 기능을 수행한다. LengthCounter의 wEn단자가 0일 때 LengthCounter 부분블로크의 내부계수기가 령으로 된다. wEn단자 출구신호의 내림면에서 LengthCounter 부 분블로크의 내부계수기의 계수값이 Lpm_FIFO1에 기억된다. CPU의 임풀스처리속도가 실시 간요구에 도달하지 못하면 Lpm_FIFO1과 Lpm_FIFO2 둘중의 하나에 쓰기충만중단이 일어 나며 중단처리프로그람은 우선 wFIFOen을 0으로 설정하여 자료쓰기를 중지시킨다. 다시 En_not를 1로 설정하여 임풀스기 록기능을 림시 중지시킨다. CPU 가 FIFO의 자료를 다 처리한 다 음 임풀스기록기능을 다시 수행 한다. 그림 2에서 수자식핵스펙트 르메터를 리용하여 55Fe원천의 에 네르기스펙트르를 측정한 자료를 보여주었는데 이 자료는 선행연 구들과 잘 일치한다. 그림 2. 55Fe에네르기스펙트르 － 88 － 종합대학학보(자연과학)   주체106(2017)년  제63권  제6호 1) 고속집적회로연산증폭기와 흐름관식A/D변환기, 론리조종 및 자료처리가 일체화된 FPGA를 리용하여 지난 시기 핵물리측정분야에서 리용하던 상사식핵스펙트르측정방법과 다 른 수자식핵스펙트르를 측정하는 한가지 방법을 실현하였다. 2) 곡선맞추기를 하였을 때의 측정자료는 곡선맞추기를 하지 않았을 때보다 정확도에 서 5배 개선되였다. 맺 는 말 참 고 문 헌 [1] A. Pullia et al.; IEEE Transactions on Nuclear Science, 57, 2, 732, 2010. [2] L. Abbene et al.; Nuclear Instrument and Methods in Physics Research, A 621, 447, 2010. [3] L. Abbene et al.; Nuclear Instrument and Methods in Physics Research, A 654, 340, 2011. [4] Huang Shan Shan; Nuclear Electronics and Detection Technology, 32, 1, 36, 2012. Method for Measuring Digital Nuclear Spectrum based on FPGA 주체106(2017)년 2월 5일 원고접수 Kang Ho, Song Yong Hyok There has been accomplished a method for measuring digital nuclear spectrum by utilizing ultra-wideband high speed integrated circuit amplifier, pipelined ADC(A/D converter) and FPGA with the function of both logic control and data processes in this paper. The accuracy extracted by curve fitting method is improved 5 times than that of curve non-fitting method. Key words: FPGA, digital nuclear spectrum, curve fitting method