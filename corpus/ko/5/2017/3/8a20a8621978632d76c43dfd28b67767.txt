김일성종합대학학보 (자연과학) JOURNAL OF KIM IL SUNG UNIVERSITY (NATURAL SCIENCE) 주체106(2017)년 제63권 제3호 Vol. 63 No. 3  JUCHE106(2017). 시간대행체에 의한 전자처방체계설계의 한가지 방법 김훈, 최명철 위대한 령도자 동지께서는 다음과 같이 교시하시였다. 《우리는 정보기술, 나노기술, 생물공학을 발전시키는데 선차적으로 힘을 넣어야 하며 그중에서도 정보기술 특히 프로그람기술을 빨리 발전시켜야 합니다.》(《선집》 증보판 제22권 21페지) 지난 시기 병원에서의 처방업무의 정보화는 환자치료에 접근하지 못하고 약무부에서의 처방자료통계분석만을 하는데 국한되였다.[1－3] 론문에서는 대행체체계로서 전자처방체계를 실현하기 위한 시간대행체에 의한 체계설 계방법을 서술하였다. １．처방작성에서 대행체들의 시간적인 동작의 형식화 전자처방체계의 기본대상은 전자처방전으로서 약무업무에서는 전자처방전의 작성과 비 준, 전자처방전을 리용한 조제업무를 통하여 전반적인 체계가 운영된다. 전자처방전의 구조를 계층적으로 구성하고 전자처방전 EP를 다음과 같이 정의한다. EP::= (pi, di, pcont) 여기서 pi∈PI, di∈DI, pcont∈PCONT로서 매 모임들의 의미는 다음과 같다. 우선 PI는 다 음과 같다. 이 모임은 환자정보들의 모임으로서 매 환자의 이름, 나이, 병력서번호, 기타 정보로 구 PI::= {(Name, Age, PID, Pinfo)} 성되는 쌍들의 모임이다. 다음 DI는 병에 대한 코드들의 모임으로서 다음과 같이 표시된다. 끝으로 PCONT모임은 처방전에 포함되는 처방약들에 대한 정보들의 모임으로서 다음 DI::= {D_Code} 과 같이 표시된다. PCONT::= Prs(prs1, prs2, … , prsN) 대부분의 현실세계에서 동작들은 시간적인 지속성을 가지며 이러한 시간적인 동작들을 정의하기 위해서는 먼저 동작들이 완성되는데 필요한 전체적인 시간평가를 정의해야 하며 다 음으로 동작이 실행되는 동안 대행체의 상태가 어떻게 변하는가를 정확히 서술해야 한다. 조제업무는 처방의뢰, 처방비준, 처방조제와 같은 동작들로 이루어지는데 이때 요구들 에 맞지 않는 처방전들은 부결하여 퇴송하여야 한다. 그리고 퇴송된 처방전들에 대해서는 해 당 의뢰과들에서 삭제되고 다시 의뢰를 진행할수 있어야 한다. － 30 － 종합대학학보(자연과학)   주체106(2017)년  제63권  제3호 조제업무의 이러한 요구들을 반영하여 론문에서는 체계에서 수행되는 시간적인 동작 들을 다음과 같이 정의한다. 우선 처방작성동작은 다음과 같이 정의된다. Name : CreatePrs(PID, D_CODE, M_Count) Schema : (String, String, Integer) Pre : {in(<PID, D_CODE>, msgbox : gather_other_req(EPRA) & in(Client, EPA : location()) &  in(φ, DB : sql(“Select Ep_No From Ep_DB Where pid = PID and d_code = D_CODE”))} Dur : { T | in( T, math : compute(M_Count * ΔT))} Tet : < abs : { T | in( T, clock : Time()) &  in(true, EPA : AddMedicine())}, { in(NewEpContent, EPA : Content(Xnow), ( in(MakeComplete, EPA : State(Xnow)) & in(NewEpContent.Count = M_Count)))}, { in(OldEpContent, EPA : Content(Xnow － ΔT))}> 처방작성동작은 전자병력서의 요청에 따라 처방전을 완성하는 기능을 수행한다. 이 동작은 3개의 인수를 가지는데 그것은 환자번호(PID), 병명(D_CODE), 처방약의 개 수(M_Count)이다. 처방작성동작의 전제조건(Pre)을 보면 처방작성은 의뢰과에서만 진행되여야 하며 그 환 자에 대한 처방은 이미 작성된것이 없어야 한다는것이다. 동작의 지속(Dur)은 처방에 포함되는 약품의 개수에 따르는데 여기서 ΔT는 1개 약품 을 선택하여 추가하는데 걸리는 시간으로서 이 값은 체계의 장치조건과 의사의 숙련정도 에 관계되는 량이다. 동작이 진행되는 기간 검사점들은 처방전에 1개 약품이 추가될 때마다 설정되는 시점 들이다. 이때 낡은 처방의 내용을 지우고 새로운 처방의 내용들로 갱신하며 제기된 약품을 다 등록했으면 처방상태를 MakeComplete로 갱신한다. 즉 처방전의 작성이 완성된 상태로 된다. 다음 보내기(SendPrs)동작은 다음과 같이 정의한다. Name : SendPrs(From, To) Schema : (String, String) Pre : {in(From, EPA:location())} Dur : {ΔT} Tet : <{}, {in(NewPosition, EPA:location(Xnow))}, {in(OldPosition, EPA:location(Xnow-ΔT))}> 보내기동작은 처방전의 위치를 갱신한다. 즉 처방전을 관리하기 위해 그것을 조종할 대 행체가 있는 위치로 처방전을 전송하는 기능을 수행한다. 비준(SignPrs)동작은 다음과 같다. 시간대행체에 의한 전자처방체계설계의 한가지 방법 － 31 － 여기서는 우선 과장비준단계가 있는데 다음과 같이 정의한다. {in(GsignComplete, EPA:State(Xnow))}, {in(OldState, EPA:State(Xnow-ΔT))}> 다음 부원장비준단계가 있는데 이것은 다음과 같이 정의한다. Name : GsignPrs() Schema : () Pre : {in(Gsign, EPA:location())} Dur : {ΔT} Tet : <{}, Name : BsignPrs() Schema : () Pre : {in(Bsign, EPA:location())} Dur : {ΔT} Tet : <{}, {in(BsignComplete, EPA:location(Xnow))}, {in(OldState, EPA:State(Xnow-ΔT))}> 조제동작은 다음과 같다. 조제과에서 수행되는 동작에는 접수와 부결이 있다. 우선 접수는 다음과 같이 정의한다. Name : ReceiptPrs() Schema : () Pre : {in(Prepare, EPA:location())} Dur : {ΔT} Tet : <{},    다음 부결은 다음과 같이 정의한다. {in(Receipt, EPA:location(Xnow))}, {in(OldState, EPA:State(Xnow-ΔT))}> Name : RejectPrs() Schema : () Pre : {in(Prepare, EPA:location())} Dur : {ΔT} Tet : <{},    다음 삭제는 다음과 같이 정의한다. {in(Reject, EPA:location(Xnow))}, {in(OldState, EPA:State(Xnow -ΔT))}> Name : RemovePrs(PID, D_CODE) Schema : () Pre : {in(Client, EPA:location())} Dur : {ΔT} － 32 － 종합대학학보(자연과학)   주체106(2017)년  제63권  제3호 Tet : <{}, 행할수 있다. {}, {in(OldEp, DB:sql(“Select Ep_No From Ep_DB Where pid = PID and d_code = D_CODE”))}> 한편 필요없는 처방은 자원소모를 막기 위해 없앤다. 처방삭제동작은 의뢰과에서만 진 처방삭제동작이 끝나면 자료기지에서 그 처방을 지우게 된다. ２．시간대행체의 규칙 여기서는 시간대행체프로그람을 서술하기 위해 체계의 동작들에 대한 제한과 상태조 건들사이의 관계를 표현하는 시간대행체규칙들을 규정하고 실현한다. 규칙 １ FCreatePrs(PID, D_CODE, M_Count) : [Xnow, Xnow] ← in(No, msgbox : gather_other_req(EPRA)) : [Xnow, Xnow] 이 규칙은 전자병력서로부터의 처방작성요구가 없으면 CreatePrs동작을 금지시키는 규 칙이다. gather_other_req(EPRA)함수에 의해 전자병력서로부터의 처방작성요구를 조사한다. 규칙 ２ OCreatePrs(PID, D_CODE, M_Count) : [Xnow, Xnow] ← in(<PID, D_CODE, M_Count>, msgbox:gather_other_req(E PRA)) : [Xnow, Xnow] 이 규칙은 전자병력서대행체로부터 처방작성요구가 있으면 CreatePrs동작을 반드시 수 행해야 한다는 규칙이다. 규칙 ３ FSendPrs(Client, Sign) : [Xnow, Xnow] ← OCreatePrs(PID, D_CODE, M_Count) : [Xnow, Xnow] 이 규칙은 처방작성동작을 수행하면서 동시에 처방을 의뢰과로부터 비준위치로 전송 할수 없게 하는 규칙이다. 여기서 Sign은 과장비준과 부원장비준위치를 가리킨다. 이와 같이 규칙 17가지를 규정하였다. ３．가능한 시간상태모임과 시간대행체프로그람의 수행 대행체프로그람은 규칙들에 기초하여 과거상태로부터 새로운 가능한 시간상태모임을 발 견해나가면서 실행된다. 시간대행체규칙들에 기초하여 닫기는 가능한 시간상태모임들이 발견되면 그에 따라 해 당한 시간적인 동작들을 수행하며 그에 맞게 다시 가능한 시간상태모임을 찾아 체계를 계 속 실행시켜나가는데 이러한 체계가 구동되자면 초기상태모임이 주어져야 한다. 우선 시간적인 상태모임은 다음과 같이 정의한다. nowtTS (0) = {OCreatePrs(PID, D_CODE, M_Count), DoCreatePrs(PID, D_CODE, M_Count), PCreatePrs(PID, D_CODE, M_Count)} 이것은 초기상태모임이 해당 환자에 대한 처방작성과 그에 대한 동작을 수행할것을 요 구한다는것을 의미한다. 다음 리력의 초기상태는 다음과 같이 정의한다. 시간대행체에 의한 전자처방체계설계의 한가지 방법 － 33 － hist nowt (0) = {in{<PID, D_CODE, M_Count> , msgbox : gather_other_req(EPRA)}} 이것은 초기리력이 전자병력서로부터 해당 환자에 대한 처방을 작성할것을 요구하는 상 태라는것을 보여준다. 우에서 정의된 초기시간상태모임 nowtTS 와 리력 모임을 얻기 위한 알고리듬에 의해 그러한 시간상태모임들이 발견되여나가며 그에 따라 체 계가 동작하게 된다. hist 에 기초하여 가능한 시간상태 nowt 가능한 시간상태모임은 그 시각에 수행이 가능한 시간적인 동작들의 모임으로 구성된 다. 그러므로 가능한 시간상태모임을 얻게 되면 그 모임에 들어있는 동작들의 수행이 그 시 각에 허가되므로 동작들의 수행을 통하여 체계가 운영될수 있다. 그러나 그러한 모임을 찾을수 없다면 그 시각에 체계상태가 모순된 행동에 빠지거나 오 유가 발생되는 경우를 막기 위해 체계가동이 중지되게 된다. 체계상태가 해당 상태리력과 동작리력들에 관하여 가능상태모임을 찾을수 있을 때 체 계는 다시 가동하게 된다. 시간대행체체계의 수행과정은 다음과 같다. 시간대행체프로그람이 가동하면 우선 초기상태모임과 리력, 조건들을 조사한다. 다음 그 시점에서의 가능한 시간상태모임들을 찾는다. 가능한 시간상태모임을 발견하면 그 상태모임에 있는 동작들을 수행한다. 동작을 수행한 후에 시간효과 triple의 추가, 삭제목록에 의해 체계의 상태와 리력정보 들을 갱신한다. 을 중지한다. 다음 다시 갱신된 상태에서의 가능한 시간상태모임을 찾는다. 이러한 처리를 가능한 시간상태모임을 찾을수 없을 때까지 계속해나간다. 만약 그러한 모임을 찾을수 없으면 체계는 더 이상 동작들을 수행할수 없으므로 가동 시간대행체프로그람의 실행순서에 따라 전자처방체계구성을 보면 우선 전자병력서로 부터 처방작성요구가 제기되고 필요한 환자정보가 넘어오면 의뢰측 사용자는 대면부대행 체를 통해 처방작성동작을 수행한다. 이때 대면부대행체는 사용자의 정보요구를 입력받아 학습엔진에 넘겨주고 선택된 처 방들을 순위대로 사용자에게 보여주는 역할을 수행한다. 또한 선택된 처방에 대한 사용자의 직접적인 평가를 받아 그 정형을 학습엔진에 귀환 한다. 선행한 방법과 비교하였다.(표) 제안한 방법의 효과성을 검증하기 위하여 체계를 가동시켜 3달동안의 처방작성과정을 표．1개 처방에 대한 조제기다림시간 구분 입력시간/s 비준시간/s 조제시간/s 선행한 방법[2] 75～120 제안한 방법 5～15 30～60 20～30 120 70～85 표로부터 알수 있는바와 같이 제안한 방법이 선행한 방법보다 더 효과적이라는것을 알수 있다. － 34 － 종합대학학보(자연과학)   주체106(2017)년  제63권  제3호 시간대행체프로그람으로 전자처방체계를 설계하였다.  설계된 체계는 매 시각 주어진 환경에 따르는 가능한 상태들을 탐색하면서 안정한 동 작을 할수 있다. 맺 는 말 참 고 문 헌 [1] Christine L. Brooks et al.; Teaching and Learning in Nursing, 7, 129, 2012. [2] V. S. Subrahmanian et al.; Temporal Agent Programs, Aritificial Intelligence, 131, 87, 2007. 주체105(2016)년 11월 5일 원고접수 The Design of Electronic-Prescription System by the Temporal Agent Program Kim Hun, Choe Myong Chol In order to design the electronic- prescription system by the temporal agent program, we define the temporal actions and rules. We also define the set of initial states for the system running. Key words: electronic-prescription system, temporal agent program