김일성종합대학학보 지구환경과학 및 지질학 주체110(2021)년 제67권 제1호 3차원망지리정보체계에서 GeoServer에 의한 대규모지형자료봉사방법 박남혁, 강룡철 경애하는 동지께서는 다음과 같이 말씀하시였다. 《우리는 현대과학기술을 원동력으로 하고 첨단산업을 기둥으로 하는 지식경제의 토 대를 구축하며 인민경제의 주체화, 현대화, 과학화, 정보화를 높은 수준에서 실현하여야 합니다.》 최근년간 3차원망지리정보체계는 교육과 보건, 관광과 도시경영 등 인민경제의 여러 부문에 널리 도입되여 리용되고있다. 자연의 기본요소인 지형은 3차원망지리정보체계에서 첫째가는 현시대상으로 되고있다. 오늘 나라와 지역 나아가서 전세계적범위의 대규모지형을 실시간적으로 유연하게 시 각화하는것은 3차원망지리정보체계개발분야에서 중요한 문제로 제기되며 이를 해결하기 위한 연구가 활발히 진행되고있다. 론문에서는 GeoServer에 의하여 대규모지형자료를 봉사받아 3차원망지리정보체계에 서 지형을 묘사하기 위한 방법에 대하여 서술하였다. １．선행연구정형 대규모지형자료의 묘사부하를 줄이는것은 체계의 효률성을 높이는데서 아주 중요 한 문제로 나선다. 지형묘사는 잘 알려진 콤퓨터도형처리분야로서 많은 분야에 적용되 고있다. 매 점의 밝음도로 지형높이를 표시하는 DEM자료들은 용량이 너무 커서 직접 묘사 하기가 힘들므로 일반적으로 3차원망지리정보체계들에서는 대규모지형자료를 준위별로 타일화하여 자료기지로 구축하고있으면서 타일지도봉사(TMS: Tiled Map Service)를 통하여 지형자료를 봉사한다. 현재의 3차원망지리정보체계에서 리용하는 지형봉사체계는 성능개선을 제한하는 일 련의 부족점을 가지고있다. 다시말하여 의뢰기측에서는 대규모자료의 세부준위(LOD)알고 리듬을 비롯한 여러가지 알고리듬들을 리용하여 대규모지형의 묘사속도문제를 비교적 원 만히 해결할수 있지만 봉사기측에서는 지형타일자료봉사부하를 줄이지 못하고있는것이다. 그것은 인터네트사용이 광범히 진행됨에 따라 의뢰기들에서 많은 요청들이 동시적으로 발생하며 발생한 요청들을 봉사기가 다 처리하자면 힘들기때문이다. 만일 사용자수가 늘어나고 또 서로 다른 사용자들이 동시에 동일한 지역에 대한 열 람을 진행한다면 의뢰기들이 보내는 지형타일자료에 대한 요청들은 중복되게 된다. 불필 요한 반복요청들은 봉사기부하를 커지게 하여 처리시간을 지연시키고 체계의 성능을 떨 어뜨린다. 봉사기부하를 줄이기 위하여서는 지형자료봉사에서 타일자료에 대한 완충기술을 리 용하여야 한다. － 42 － 종합대학학보 지구환경과학 및 지질학 주체110(2021)년 제67권 제1호 망지리정보체계개발에 널리 리용되는 GeoServer는 대규모의 라스터자료를 효과적으 로 관리할수 있는 화상피라미드주제층관리기능을 가지고있으며 GWC(GeoWebCache)와 통합되여있어 타일완충봉사도 할수 있다. GWC는 의뢰기와 봉사기사이에서 대리봉사기로 동작하는 타일봉사기로서 요청한 타일 들을 저장하고 불필요한 요청처리들을 무시함으로써 처리시간을 많이 절약한다.[1](그림 1) GWC 의뢰기 WMS 봉사기 그림 1. GWC에 의한 타일봉사 의뢰기에서 새로운 지도타일들에 대한 요청이 들어오면 GWC는 이 요청들을 도중에 서 접수하여 타일들에 대한 미리묘사를 진행한다. 즉 요청한 타일이 완충기에 저장되여 있으면 이 타일들을 의뢰기에 직접 돌려보내며 요청한 타일들이 완충기에 없으면 표준적 인 WMS요청을 구성하여 WMS봉사기에 전송하고 그 결과화상들을 받아서 고속완충기에 저장한 다음 의뢰기에 보낸다.(그림 2) 그러므로 타일들이 한번 완충기에 저장되면 요청 처리속도와 지도묘사속도가 배로 빨라질수 있다. HTTP 규약 의뢰기 HTTP 규약 고속완충기 관리자 타일객체 봉사 WMS WMTS TMS KML 기억기 메타자료 타일자료 자료원천 WMS1 WMS2 … 그림 2. GWC의 타일지도요청처리 만일 대규모지형자료를 GeoServer가 지원하는 피라미드주제층으로 관리한다면 GWC 에서 지형타일완충봉사를 받을수 있으며 따라서 봉사기의 부하를 크게 줄이고 요청응답 속도를 높여 체계의 성능을 향상시킬수 있다. 3차원망지리정보체계에서 GeoServer에 의한 대규모지형자료봉사방법 － 43 － ２．대규모지형자료봉사의 실현방법 １）대규모지형자료의 전처리 종전에는 원천DEM자료를 TMS의 프로화일구조에 따라 HeightMap자료형식의 개별적 인 화일들로 타일화한 다음 지형자료기지에 저장하였다. 론문에서는 대규모지형자료를 피라미드주제층으로 관리하기 위하여 원천지형자료를 이전의 지형자료형식과는 달리 화상형식으로 변환하여 원천DEM자료의 지형정보를 반영 하도록 하였다. 원천DEM자료의 맨 웃자리비트정보는 변환된 화상의 붉은색대역(R)에 반영하고 맨 아래자리비트정보는 풀색대역(G)에 반영하였다. 푸른색대역(B)은 원천DEM자료의 해당 화소가 NODATA값인가를 나타내게 하였다. 또한 R, G값이 언제나 정의 값을 가지도록 32 768m의 편차값을 주었다. 원천DEM자료인 부호있는 16bit옹근수형자료를 부호없는 8bitRGB색화상으로 변환하 는 식을 다음과 같이 정의하였다.  R ij = O ( ij + 32 2/)768 8 G ij = O ij + 32 768 − R ij 8 × 2 ,255 ,0 ⎧ ⎨ ⎩ 255 B ij = A = O ij O ij = ≠ NODATA   NODATA 여기서 ijO 는 원천DEM자료의 (i, j)화소의 밝음도값이고 ijR , Gij, Bij, A는 각각 변환된 화 상의 (i, j)화소의 R, G, B, Alpha값이다. R G B A R G B A DEM 자료 그림 3. RGB색화상생성 변환된 화상은 지형타일피라미드를 구성하기 위한 원천화상으로 리용된다. ２）지형타일피라미드자료구축 및 피라미드주제층창조 타일피라미드모형은 일종의 다중분해능계층모형이다. 피라미드계층구조는 대규모의 라스터자료를 봉사해야 할 때 처리성능을 높이는데 아주 유용하다.[2] 피라미드의 아래층 으로부터 우로 올라가면서 분해능은 높아진다. 타일피라미드모형구축알고리듬은 다음과 같다. 피라미드의 층수 N과 타일의 크기(X×X화소)를 결정한다. 피라미드의 맨 아래준위에 전체 화상을 놓고 0층으로 한다. － 44 － 종합대학학보 지구환경과학 및 지질학 주체110(2021)년 제67권 제1호 화상의 왼쪽상단으로부터 시작하여 왼쪽에서 오른쪽으로, 우에서 아래로 내려가면서 X×X화소크기의 정방형타일들로 잘라 0층의 4각형타일들을 만들고 행번호와 렬번호를 리 용하여 이름을 붙인다. 타일이름은 공간색인으로 리용된다. 0층의 2×2화소를 1개의 화소로 만드는 방법으로 1층의 화상을 생성한다.(그림 4) 이 처리는 최근방법, 쌍일차법, 3차다항식법 등 라스터재표본화방법에 의하여 진행된다. 다음 이 화상을 X×X화소크기의 정방형타일들로 분할하여 1층의 타일행렬을 구성한다. 이와 같은 방법으로 2층, 3층, …, N－1층의 타일행렬을 구성한다. 2 층 1 층 0 층 그림 4. 타일피라미드모형 생성된 타일피라미드모형에 기초하여 GeoServer에서 지형자료에 대한 봉사를 진행할 수 있도록 피라미드주제층을 창조한다. ３）완충타일의 생성 완충타일은 두가지 방법으로 생성한다. 첫번째 방법은 일반적인 지도열람과정에 생성하는것이다. 이 경우 타일들은 오직 의뢰기들에서 지도를 열람하거나 수동적인 WMS타일요청이 들어올 때에만 완충기에 저장된다. 지도열람요청이 처음으로 들어오면 지도묘사는 표준적인 WMS요청속도와 거의 같은 속도로 진행된다. 그 이후부터는 타일들이 이미 생성되였기때문에 지도묘사속도가 가속 화된다. 이 방법의 주요한 우점은 전처리를 필요로 하지 않으며 한번 요청되였던 자료만 완 충기에 저장되기때문에 기억공간도 절약된다는것이다. 이 방법의 부족점은 지도묘사가 련속적이지 못하고 묘사의 질을 보장할수 없는것이다. 두번째 방법은 미리 타일들을 생성하여 완충기에 저장하는것이다. 완충타일들이 미리 생성되여있다면 사용자들은 타일이 생성되기를 기다리지 않아도 되기때문에 지도열람에 대한 실시간성을 보장할수 있다. 이 방법의 부족점은 시간이 매 우 많이 들고 기억공간도 많이 소비될수 있다는것이다. 3차원망지리정보체계에서 GeoServer에 의한 대규모지형자료봉사방법 － 45 － 실천에서는 우의 두 방법을 결합하여 리용한다. 즉 주민지역이나 관광지역과 같은 사용자들이 많이 방문하는 특정한 령역들에 대해서는 미리 완충타일을 생성하여놓고 기 타 지역들에 대해서는 지도열람과정에 생성한다. ４）지형묘사 론문에서는 GWC로부터 WMS, TMS, WMTS를 통하여 지형타일을 봉사받아 지형을 묘사할수 있도록 의뢰기측 지형처리프로그람을 설계하고 실현하였다. 의뢰기가 지형타일을 요청하면 봉사기는 요청구문을 해석하고 지형타일자료로서 PNG형식의 화상을 생성하여 보낸다. WMTS를 받기 위한 URL은 다음과 같다. http://localhost:8080/geoserver/gwc/service/wmts?service=WMTS&request=GetTile&version =1.0.0&layer=elevation:terrain_pyramid&style=raster&format=image/png&TileMatrixSet=My_EPSG: 4326&TileMatrix=My_EPSG:4326:10&TileRow=567&TileCol=3489 의뢰기측에서 지형을 묘사하려면 봉사기에서 내리적재받은 화상으로부터 높이값정보 를 얻어야 한다. 지형자료변환식으로부터 화상의 매 화소에 해당하는 높이값들을 쉽게 얻을수 있다. 화상으로부터 높이값을 얻는 코드는 다음과 같다.  var dataPixels = getImagePixels(image, size.width, size.height);         var buffer = new Int16Array(dataPixels.length / 4);         for (var i = 0; i < dataPixels.length; i += 4) {             var msb = dataPixels[i];             var lsb = dataPixels[i + 1];             var isNotNodataValue = dataPixels[i + 2] > 128;             var height_value= (msb << 8 | lsb) - 32768;             if(isNotNodataValue)                   buffer[i / 4] = height_value;             else                   buffer[i / 4] = 0;         } 얻어진 높이값들을 지형묘사엔진의 지형자료구조에 맞게 변환하여 지형묘사를 진행 한다.(그림 5) 그림 5. 지형묘사결과 － 46 － 종합대학학보 지구환경과학 및 지질학 주체110(2021)년 제67권 제1호 ３．효과성분석 실험에서 봉사기로 리용된 콤퓨터의 하드웨어조건은 다음과 같다. CPU: Intel(R) Core(TM) i7-8750H CPU @2.20GHz (12 CPUs) GPU: NVIDIA GeForce GTX 1060, 6GB RAM: 16GB 실험에서는 동일한 지역의 지형타일들에 대하여 종전의 TMS방법과 론문에서 제기 한 GWC에 의한 방법의 평균요청응답시간을 측정대비하는 방법으로 효과성을 분석하였 다. GWC에 의한 방법에서는 지형완충타일들을 미리 생성하지 않고 지형열람과정에 생성 하였다. 그림 6은 TMS방법과 GWC에 의한 방법의 평균응답시간비교결과를 보여주고있다. 그림 6에서의 측정값들은 웨브열람기의 완충기억기에 저장되지 않은 타일들에 대한 요청 응답시간이다. / s m 간 시 답 응 균 평 400 350 300 250 200 150 100 50 0 TMS GWC 5 10 15 의뢰기수/대 20 25 30 그림 6. TMS방법과 GWC에 의한 방법의 평균응답시간비교결과 그림 6에서 보는바와 같이 TMS방법에 비해 GWC에 의한 방법에서는 의뢰기수가 늘 어나도 지형타일자료에 대한 응답시간이 크게 늘어나지 않는다는것을 알수 있다. 지형타 일들을 미리 생성하고 완충기에 저장하여놓는다면 더 좋은 결과를 얻을수 있다. 맺 는 말 3차원지리정보체계의 대규모지형자료를 종전과 다른 새로운 자료구조로 저장관리하 고 GWC에 의한 지형봉사를 실현하면 지형자료의 응답속도를 높이고 체계의 정보봉사성 능을 개선할수 있다. 참 고 문 헌 [1] Lisheng Sun et al.; Asian Journal of Applied Sciences, 8, 3, 185, 2015. [2] Stefano Iacovella; GeoServer Cookbook, Packt Publishing, 79～81, 2014. 주체109(2020)년 10월 5일 원고접수 3차원망지리정보체계에서 GeoServer에 의한 대규모지형자료봉사방법 － 47 － A Method for Serving Large-Scale Terrain Data Based On GeoServer in 3D Web GIS Pak Nam Hyok, Kang Ryong Chol In this paper, we described a method to provide large-scale terrain data by GeoServer and visualize the terrain in 3D Web GIS. Keywords: 3D Web GIS, large-scale terrain data